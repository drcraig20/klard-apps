# PasswordInput Component Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create a production-ready PasswordInput component with visibility toggle and optional strength indicator for both Web (Next.js/shadcn) and Mobile (React Native/Expo).

**Architecture:** Compose existing `InputField` patterns with password-specific features. The component includes: (1) Password input with visibility toggle, (2) Optional strength indicator bar, (3) Optional requirements checklist. Each sub-component follows SRP - single responsibility for rendering its specific piece.

**Tech Stack:**
- Web: React 19, TypeScript, Tailwind CSS 4, shadcn/ui Input patterns, Vitest, React Testing Library
- Mobile: React Native 0.81, Expo SDK 54, TypeScript, `@expo/vector-icons` Ionicons, Jest, React Native Testing Library

---

## Library Documentation Reference (Verified via Context7 MCP)

### shadcn/ui Input Component
```tsx
// Import pattern
import { Input } from "@/components/ui/input"

// Basic usage with label
import { Label } from "@/components/ui/label"

<div className="grid w-full max-w-sm items-center gap-3">
  <Label htmlFor="password">Password</Label>
  <Input type="password" id="password" placeholder="Enter password" />
</div>
```

### React Native TextInput for Passwords
```tsx
// From React Native documentation - password input pattern
<TextInput
  style={styles.input}
  value={password}
  onChangeText={setPassword}
  placeholder="Enter password"
  secureTextEntry={true}      // KEY: Hides password text
  autoCapitalize="none"       // KEY: No auto-capitalization
  autoCorrect={false}         // KEY: No autocorrect for passwords
/>
```

### Expo Vector Icons (Ionicons)
```tsx
// Import from @expo/vector-icons
import { Ionicons } from '@expo/vector-icons';

// Eye icons for toggle
<Ionicons name="eye-outline" size={20} color="#64748B" />      // Show password
<Ionicons name="eye-off-outline" size={20} color="#64748B" />  // Hide password
```

### React Testing Library
```tsx
import { render, screen, fireEvent } from '@testing-library/react';

// Render component
render(<PasswordInput />);

// Query elements
const input = screen.getByPlaceholderText('Enter password');
const button = screen.getByRole('button', { name: /show password/i });

// Fire events
fireEvent.click(button);
fireEvent.change(input, { target: { value: 'newpassword' } });
```

### React Native Testing Library
```tsx
import { render, screen, fireEvent } from '@testing-library/react-native';

// Render component
render(<PasswordInput testID="password-input" />);

// Query elements
const input = screen.getByTestId('password-input');
const button = screen.getByLabelText('Show password');

// Fire events
fireEvent.press(button);
fireEvent.changeText(input, 'newpassword');
```

---

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| PasswordInput | Composes password input with optional features | Extensible via props (showStrength, requirements) | Accepts all standard input props | Minimal focused interface | Depends on InputFieldProps abstraction |
| PasswordStrengthBar | Displays strength bar only | Add strength levels via config | N/A | Single password prop | Depends on calculatePasswordStrength from commons |
| PasswordRequirementsList | Displays requirement checklist only | Add requirements via config | N/A | Single requirements prop | Depends on requirements type |

---

## Existing Codebase Patterns

**Web InputField** (`klard-web/src/components/ui/input-field.tsx`):
- Already has password toggle built-in when `type="password"`
- Uses `Eye`, `EyeOff` from `lucide-react`
- Has label, error, helperText support
- Uses `cn()` for class merging

**Mobile InputField** (`klard-mobile/src/components/ui/InputField.tsx`):
- Already has password toggle built-in when `type="password"`
- Uses `Ionicons` from `@expo/vector-icons`
- Has label, error, helperText support
- Uses `StyleSheet.create()` for styles

**PasswordStrengthIndicator** (exists separately):
- Web: `klard-web/src/components/ui/password-strength-indicator.tsx`
- Mobile: `klard-mobile/src/components/auth/password-strength-indicator/`
- Uses `calculatePasswordStrength` from `@klard-apps/commons`

---

## Task 1: Write Failing Tests for Web PasswordInput

**Files:**
- Create: `klard-web/src/__tests__/components/ui/password-input.test.tsx`

**Step 1: Create test file with failing tests**

```tsx
/**
 * Tests for PasswordInput Component
 *
 * These tests verify:
 * 1. Renders password input with visibility toggle
 * 2. Toggles password visibility on button click
 * 3. Shows strength indicator when showStrength is true
 * 4. Shows requirements checklist when requirements prop provided
 * 5. Passes through standard input props correctly
 * 6. Accessibility attributes are correct
 */

import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { PasswordInput } from '@/components/ui/password-input';

describe('PasswordInput', () => {
  describe('Rendering', () => {
    it('should render a password input field', () => {
      render(<PasswordInput placeholder="Enter password" />);

      const input = screen.getByPlaceholderText('Enter password');
      expect(input).toBeTruthy();
      expect(input.getAttribute('type')).toBe('password');
    });

    it('should render with label when provided', () => {
      render(<PasswordInput label="Password" placeholder="Enter password" />);

      expect(screen.getByText('Password')).toBeTruthy();
    });

    it('should render visibility toggle button', () => {
      render(<PasswordInput placeholder="Enter password" />);

      const toggleButton = screen.getByRole('button', { name: /show password/i });
      expect(toggleButton).toBeTruthy();
    });
  });

  describe('Password Visibility Toggle', () => {
    it('should start with password hidden (type=password)', () => {
      render(<PasswordInput placeholder="Enter password" />);

      const input = screen.getByPlaceholderText('Enter password');
      expect(input.getAttribute('type')).toBe('password');
    });

    it('should show password when toggle is clicked', () => {
      render(<PasswordInput placeholder="Enter password" />);

      const toggleButton = screen.getByRole('button', { name: /show password/i });
      fireEvent.click(toggleButton);

      const input = screen.getByPlaceholderText('Enter password');
      expect(input.getAttribute('type')).toBe('text');
    });

    it('should hide password when toggle is clicked twice', () => {
      render(<PasswordInput placeholder="Enter password" />);

      const toggleButton = screen.getByRole('button', { name: /show password/i });
      fireEvent.click(toggleButton);

      const hideButton = screen.getByRole('button', { name: /hide password/i });
      fireEvent.click(hideButton);

      const input = screen.getByPlaceholderText('Enter password');
      expect(input.getAttribute('type')).toBe('password');
    });

    it('should update aria-label on toggle', () => {
      render(<PasswordInput placeholder="Enter password" />);

      const toggleButton = screen.getByRole('button', { name: /show password/i });
      expect(toggleButton.getAttribute('aria-label')).toBe('Show password');

      fireEvent.click(toggleButton);

      const hideButton = screen.getByRole('button', { name: /hide password/i });
      expect(hideButton.getAttribute('aria-label')).toBe('Hide password');
    });
  });

  describe('Strength Indicator', () => {
    it('should not show strength indicator by default', () => {
      render(<PasswordInput value="test123" onChange={() => {}} />);

      expect(screen.queryByTestId('password-strength-indicator')).toBeNull();
    });

    it('should show strength indicator when showStrength is true', () => {
      render(<PasswordInput value="test123" onChange={() => {}} showStrength />);

      expect(screen.getByTestId('password-strength-indicator')).toBeTruthy();
    });

    it('should not show strength indicator when password is empty', () => {
      render(<PasswordInput value="" onChange={() => {}} showStrength />);

      expect(screen.queryByTestId('password-strength-indicator')).toBeNull();
    });
  });

  describe('Password Requirements', () => {
    const requirements = {
      minLength: true,
      hasUppercase: false,
      hasLowercase: true,
      hasNumber: true,
      hasSpecial: false,
    };

    it('should not show requirements by default', () => {
      render(<PasswordInput />);

      expect(screen.queryByTestId('password-requirements')).toBeNull();
    });

    it('should show requirements when provided', () => {
      render(<PasswordInput requirements={requirements} />);

      expect(screen.getByTestId('password-requirements')).toBeTruthy();
    });

    it('should display all requirement items', () => {
      render(<PasswordInput requirements={requirements} />);

      const requirementsList = screen.getByTestId('password-requirements');
      expect(requirementsList.querySelectorAll('[data-requirement]').length).toBe(5);
    });
  });

  describe('Props Passthrough', () => {
    it('should pass error prop and display error message', () => {
      render(<PasswordInput error="Password is required" />);

      expect(screen.getByText('Password is required')).toBeTruthy();
      expect(screen.getByRole('alert')).toBeTruthy();
    });

    it('should pass disabled prop correctly', () => {
      render(<PasswordInput disabled placeholder="Disabled" />);

      const input = screen.getByPlaceholderText('Disabled');
      expect(input).toBeDisabled();
    });

    it('should call onChange when typing', () => {
      const handleChange = vi.fn();
      render(<PasswordInput onChange={handleChange} placeholder="Type here" />);

      const input = screen.getByPlaceholderText('Type here');
      fireEvent.change(input, { target: { value: 'newpassword' } });

      expect(handleChange).toHaveBeenCalled();
    });

    it('should display helper text when no error', () => {
      render(<PasswordInput helperText="Must be 8+ characters" />);

      expect(screen.getByText('Must be 8+ characters')).toBeTruthy();
    });

    it('should hide helper text when error is present', () => {
      render(<PasswordInput helperText="Must be 8+ characters" error="Invalid password" />);

      expect(screen.queryByText('Must be 8+ characters')).toBeNull();
      expect(screen.getByText('Invalid password')).toBeTruthy();
    });
  });

  describe('Accessibility', () => {
    it('should have proper aria-label on toggle button', () => {
      render(<PasswordInput />);

      const toggleButton = screen.getByRole('button');
      expect(toggleButton.getAttribute('aria-label')).toBeTruthy();
    });

    it('should connect label to input via htmlFor', () => {
      render(<PasswordInput label="Password" id="password-field" />);

      const label = screen.getByText('Password');
      expect(label.getAttribute('for')).toBe('password-field');
    });

    it('should have aria-invalid when error is present', () => {
      render(<PasswordInput error="Invalid" placeholder="Password" />);

      const input = screen.getByPlaceholderText('Password');
      expect(input.getAttribute('aria-invalid')).toBe('true');
    });

    it('should have aria-describedby pointing to error message', () => {
      render(<PasswordInput error="Invalid" id="pwd" placeholder="Password" />);

      const input = screen.getByPlaceholderText('Password');
      expect(input.getAttribute('aria-describedby')).toContain('pwd-error');
    });
  });
});
```

**Step 2: Run test to verify it fails**

```bash
cd klard-web && pnpm test src/__tests__/components/ui/password-input.test.tsx
```

Expected: FAIL with "Cannot find module '@/components/ui/password-input'"

---

## Task 2: Create Web PasswordInput Component

**Files:**
- Create: `klard-web/src/components/ui/password-input.tsx`
- Modify: `klard-web/src/components/ui/index.ts`

**Step 3: Create the PasswordInput component**

```tsx
'use client';

import { forwardRef, useState, useId } from 'react';
import { Eye, EyeOff, Check, X } from 'lucide-react';
import { cn } from '@/lib/utils';
import { calculatePasswordStrength } from '@klard-apps/commons';

// ============================================================================
// Types
// ============================================================================

interface PasswordRequirementsState {
  minLength: boolean;
  hasUppercase: boolean;
  hasLowercase: boolean;
  hasNumber: boolean;
  hasSpecial: boolean;
}

export interface PasswordInputProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'type'> {
  /** Label text displayed above the input */
  label?: string;
  /** Error message - displays in red below input */
  error?: string;
  /** Helper text - displays below input when no error */
  helperText?: string;
  /** Shows required asterisk after label */
  required?: boolean;
  /** Show password strength indicator */
  showStrength?: boolean;
  /** Password requirements checklist state */
  requirements?: PasswordRequirementsState;
}

// ============================================================================
// Sub-components (SRP: Each has single responsibility)
// ============================================================================

interface PasswordStrengthBarProps {
  password: string;
}

function PasswordStrengthBar({ password }: PasswordStrengthBarProps) {
  const strength = calculatePasswordStrength(password);

  if (!password) return null;

  const levelColors: Record<string, string> = {
    weak: 'bg-red-500',
    fair: 'bg-amber-500',
    good: 'bg-emerald-500',
    strong: 'bg-primary',
  };

  const levelWidths: Record<string, string> = {
    weak: 'w-1/4',
    fair: 'w-1/2',
    good: 'w-3/4',
    strong: 'w-full',
  };

  const levelLabels: Record<string, string> = {
    weak: 'Weak',
    fair: 'Fair',
    good: 'Good',
    strong: 'Strong',
  };

  return (
    <div className="mt-2 space-y-1" data-testid="password-strength-indicator">
      <div className="h-1.5 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
        <div
          className={cn(
            'h-full transition-all duration-300 rounded-full',
            levelColors[strength.level],
            levelWidths[strength.level]
          )}
        />
      </div>
      <div className="flex justify-between items-center">
        <span className="text-xs text-slate-500 dark:text-slate-400">
          {levelLabels[strength.level]}
        </span>
        {strength.feedback.length > 0 && (
          <span className="text-xs text-slate-400 dark:text-slate-500">
            {strength.feedback[0]}
          </span>
        )}
      </div>
    </div>
  );
}

interface PasswordRequirementsListProps {
  requirements: PasswordRequirementsState;
}

function PasswordRequirementsList({ requirements }: PasswordRequirementsListProps) {
  const requirementLabels: Record<keyof PasswordRequirementsState, string> = {
    minLength: 'At least 8 characters',
    hasUppercase: 'One uppercase letter',
    hasLowercase: 'One lowercase letter',
    hasNumber: 'One number',
    hasSpecial: 'One special character',
  };

  return (
    <div className="mt-3 space-y-1.5" data-testid="password-requirements">
      {(Object.entries(requirements) as [keyof PasswordRequirementsState, boolean][]).map(
        ([key, isMet]) => (
          <div
            key={key}
            data-requirement={key}
            className={cn(
              'flex items-center gap-2 text-sm transition-colors',
              isMet ? 'text-emerald-600 dark:text-emerald-400' : 'text-slate-500 dark:text-slate-400'
            )}
          >
            {isMet ? (
              <Check size={14} className="text-emerald-500 flex-shrink-0" />
            ) : (
              <X size={14} className="text-slate-400 flex-shrink-0" />
            )}
            <span>{requirementLabels[key]}</span>
          </div>
        )
      )}
    </div>
  );
}

// ============================================================================
// Main Component
// ============================================================================

export const PasswordInput = forwardRef<HTMLInputElement, PasswordInputProps>(
  function PasswordInput(
    {
      label,
      error,
      helperText,
      required,
      showStrength,
      requirements,
      value,
      onChange,
      className,
      disabled,
      id: providedId,
      ...props
    },
    ref
  ) {
    const generatedId = useId();
    const id = providedId ?? generatedId;
    const [showPassword, setShowPassword] = useState(false);

    // Build aria-describedby for accessibility
    const describedBy = [
      error ? `${id}-error` : null,
      helperText && !error ? `${id}-helper` : null,
    ].filter(Boolean).join(' ') || undefined;

    return (
      <div className="w-full">
        {/* Label */}
        {label && (
          <label
            htmlFor={id}
            className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
          >
            {label}
            {required && <span className="text-red-500 ml-1" aria-hidden="true">*</span>}
          </label>
        )}

        {/* Input with toggle */}
        <div className="relative">
          <input
            ref={ref}
            id={id}
            type={showPassword ? 'text' : 'password'}
            value={value}
            onChange={onChange}
            disabled={disabled}
            required={required}
            aria-invalid={!!error}
            aria-required={required}
            aria-describedby={describedBy}
            autoComplete="current-password"
            className={cn(
              // Base styles
              'w-full h-12 px-4 pr-12 text-base',
              'bg-white dark:bg-slate-900',
              'text-slate-900 dark:text-slate-100',
              'border rounded-xl',
              'placeholder:text-slate-400 dark:placeholder:text-slate-500',
              'transition-all duration-150',
              // Focus styles
              'focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary',
              // Default border
              !error && 'border-slate-300 dark:border-slate-700 hover:border-slate-400 dark:hover:border-slate-600',
              // Error styles
              error && 'border-red-500 focus:ring-red-500/30 focus:border-red-500',
              // Disabled styles
              disabled && 'opacity-50 cursor-not-allowed bg-slate-50 dark:bg-slate-800',
              className
            )}
            {...props}
          />

          {/* Visibility toggle button */}
          <button
            type="button"
            onClick={() => setShowPassword(!showPassword)}
            disabled={disabled}
            className={cn(
              'absolute right-3 top-1/2 -translate-y-1/2',
              'text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-slate-300',
              'transition-colors p-1 rounded',
              'focus:outline-none focus:ring-2 focus:ring-primary/30',
              disabled && 'pointer-events-none'
            )}
            aria-label={showPassword ? 'Hide password' : 'Show password'}
          >
            {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
          </button>
        </div>

        {/* Error message */}
        {error && (
          <p
            id={`${id}-error`}
            className="mt-2 text-sm text-red-500"
            role="alert"
          >
            {error}
          </p>
        )}

        {/* Helper text */}
        {helperText && !error && (
          <p
            id={`${id}-helper`}
            className="mt-2 text-sm text-slate-500 dark:text-slate-400"
          >
            {helperText}
          </p>
        )}

        {/* Strength indicator */}
        {showStrength && typeof value === 'string' && (
          <PasswordStrengthBar password={value} />
        )}

        {/* Requirements checklist */}
        {requirements && (
          <PasswordRequirementsList requirements={requirements} />
        )}
      </div>
    );
  }
);
```

**Step 4: Export from index.ts**

Add to `klard-web/src/components/ui/index.ts`:
```tsx
export { PasswordInput, type PasswordInputProps } from './password-input';
```

**Step 5: Run tests to verify they pass**

```bash
cd klard-web && pnpm test src/__tests__/components/ui/password-input.test.tsx
```

Expected: PASS (all tests green)

**Step 6: Run TypeScript check**

```bash
cd klard-web && pnpm build
```

Expected: No TypeScript errors

**Step 7: Commit Web implementation**

```bash
git add klard-web/src/components/ui/password-input.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/password-input.test.tsx
git commit -m "feat(ui): add PasswordInput component with strength indicator and requirements"
```

---

## Task 3: Write Failing Tests for Mobile PasswordInput

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/PasswordInput.test.tsx`

**Step 8: Create mobile test file with failing tests**

```tsx
/**
 * Tests for Mobile PasswordInput Component
 *
 * These tests verify:
 * 1. Renders password input with visibility toggle
 * 2. Toggles password visibility on press
 * 3. Shows strength indicator when showStrength is true
 * 4. Shows requirements checklist when requirements prop provided
 * 5. Passes through InputField props correctly
 * 6. Accessibility labels are correct
 */

import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react-native';
import { PasswordInput } from '@/components/ui/PasswordInput';

// Mock i18n
jest.mock('@/lib/i18n', () => ({
  t: (key: string, fallback?: string) => fallback || key,
}));

// Mock theme hook
jest.mock('@/hooks', () => ({
  useThemeColors: () => ({
    primary: '#0D7C7A',
    accentError: '#DC2626',
    accentWarning: '#D97706',
    accentSuccess: '#059669',
    muted: '#E2E8F0',
    textSecondary: '#64748B',
    textTertiary: '#94A3B8',
  }),
}));

// Mock calculatePasswordStrength
jest.mock('@klard-apps/commons', () => ({
  calculatePasswordStrength: (password: string) => {
    if (!password) return { level: 'weak', feedback: [] };
    if (password.length < 6) return { level: 'weak', feedback: ['Too short'] };
    if (password.length < 10) return { level: 'fair', feedback: [] };
    if (password.length < 14) return { level: 'good', feedback: [] };
    return { level: 'strong', feedback: [] };
  },
}));

describe('PasswordInput', () => {
  describe('Rendering', () => {
    it('should render a password input field', () => {
      render(<PasswordInput testID="password-input" />);

      const input = screen.getByTestId('password-input');
      expect(input).toBeTruthy();
    });

    it('should render with label when provided', () => {
      render(<PasswordInput label="Password" testID="password-input" />);

      expect(screen.getByText('Password')).toBeTruthy();
    });

    it('should render visibility toggle button', () => {
      render(<PasswordInput testID="password-input" />);

      const toggleButton = screen.getByLabelText('Show password');
      expect(toggleButton).toBeTruthy();
    });
  });

  describe('Password Visibility Toggle', () => {
    it('should start with password hidden (secureTextEntry=true)', () => {
      render(<PasswordInput testID="password-input" />);

      const input = screen.getByTestId('password-input');
      expect(input.props.secureTextEntry).toBe(true);
    });

    it('should show password when toggle is pressed', () => {
      render(<PasswordInput testID="password-input" />);

      const toggleButton = screen.getByLabelText('Show password');
      fireEvent.press(toggleButton);

      const input = screen.getByTestId('password-input');
      expect(input.props.secureTextEntry).toBe(false);
    });

    it('should hide password when toggle is pressed twice', () => {
      render(<PasswordInput testID="password-input" />);

      const showButton = screen.getByLabelText('Show password');
      fireEvent.press(showButton);

      const hideButton = screen.getByLabelText('Hide password');
      fireEvent.press(hideButton);

      const input = screen.getByTestId('password-input');
      expect(input.props.secureTextEntry).toBe(true);
    });
  });

  describe('Strength Indicator', () => {
    it('should not show strength indicator by default', () => {
      render(<PasswordInput value="test123" onChangeText={() => {}} testID="password-input" />);

      expect(screen.queryByTestId('password-strength-indicator')).toBeNull();
    });

    it('should show strength indicator when showStrength is true', () => {
      render(<PasswordInput value="test123" onChangeText={() => {}} showStrength testID="password-input" />);

      expect(screen.getByTestId('password-strength-indicator')).toBeTruthy();
    });

    it('should not show strength indicator when password is empty', () => {
      render(<PasswordInput value="" onChangeText={() => {}} showStrength testID="password-input" />);

      expect(screen.queryByTestId('password-strength-indicator')).toBeNull();
    });
  });

  describe('Password Requirements', () => {
    const requirements = {
      minLength: true,
      hasUppercase: false,
      hasLowercase: true,
      hasNumber: true,
      hasSpecial: false,
    };

    it('should not show requirements by default', () => {
      render(<PasswordInput testID="password-input" />);

      expect(screen.queryByTestId('password-requirements')).toBeNull();
    });

    it('should show requirements when provided', () => {
      render(<PasswordInput requirements={requirements} testID="password-input" />);

      expect(screen.getByTestId('password-requirements')).toBeTruthy();
    });
  });

  describe('Props Passthrough', () => {
    it('should pass error prop and display error message', () => {
      render(<PasswordInput error="Password is required" testID="password-input" />);

      expect(screen.getByText('Password is required')).toBeTruthy();
    });

    it('should pass editable=false when disabled', () => {
      render(<PasswordInput editable={false} testID="password-input" />);

      const input = screen.getByTestId('password-input');
      expect(input.props.editable).toBe(false);
    });

    it('should call onChangeText when typing', () => {
      const handleChange = jest.fn();
      render(<PasswordInput onChangeText={handleChange} testID="password-input" />);

      const input = screen.getByTestId('password-input');
      fireEvent.changeText(input, 'newpassword');

      expect(handleChange).toHaveBeenCalledWith('newpassword');
    });

    it('should display helper text when no error', () => {
      render(<PasswordInput helperText="Must be 8+ characters" testID="password-input" />);

      expect(screen.getByText('Must be 8+ characters')).toBeTruthy();
    });
  });

  describe('Accessibility', () => {
    it('should have proper accessibilityLabel on toggle button', () => {
      render(<PasswordInput testID="password-input" />);

      const toggleButton = screen.getByLabelText('Show password');
      expect(toggleButton).toBeTruthy();
    });

    it('should have accessibilityRole button on toggle', () => {
      render(<PasswordInput testID="password-input" />);

      const toggleButton = screen.getByRole('button');
      expect(toggleButton).toBeTruthy();
    });
  });
});
```

**Step 9: Run test to verify it fails**

```bash
cd klard-mobile && pnpm test src/__tests__/components/ui/PasswordInput.test.tsx
```

Expected: FAIL with "Cannot find module '@/components/ui/PasswordInput'"

---

## Task 4: Create Mobile PasswordInput Component

**Files:**
- Create: `klard-mobile/src/components/ui/PasswordInput.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 10: Create the Mobile PasswordInput component**

```tsx
import React, { useState } from 'react';
import {
  View,
  Text,
  TextInput,
  Pressable,
  StyleSheet,
  type TextInputProps,
  type StyleProp,
  type ViewStyle,
  type DimensionValue,
} from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { calculatePasswordStrength, type PasswordStrength } from '@klard-apps/commons';
import { useThemeColors } from '@/hooks';

// ============================================================================
// Types
// ============================================================================

interface PasswordRequirementsState {
  minLength: boolean;
  hasUppercase: boolean;
  hasLowercase: boolean;
  hasNumber: boolean;
  hasSpecial: boolean;
}

export interface PasswordInputProps extends Omit<TextInputProps, 'secureTextEntry'> {
  /** Label text displayed above the input */
  label?: string;
  /** Error message - displays in red below input */
  error?: string;
  /** Helper text - displays below input when no error */
  helperText?: string;
  /** Shows required asterisk after label */
  required?: boolean;
  /** Show password strength indicator */
  showStrength?: boolean;
  /** Password requirements checklist state */
  requirements?: PasswordRequirementsState;
  /** Container style override */
  containerStyle?: StyleProp<ViewStyle>;
}

// ============================================================================
// Sub-components (SRP: Each has single responsibility)
// ============================================================================

interface PasswordStrengthBarProps {
  password: string;
  colors: ReturnType<typeof useThemeColors>;
}

const LEVEL_WIDTHS: Record<PasswordStrength['level'], DimensionValue> = {
  weak: '25%',
  fair: '50%',
  good: '75%',
  strong: '100%',
};

const LEVEL_LABELS: Record<PasswordStrength['level'], string> = {
  weak: 'Weak',
  fair: 'Fair',
  good: 'Good',
  strong: 'Strong',
};

function PasswordStrengthBar({ password, colors }: PasswordStrengthBarProps) {
  const strength = calculatePasswordStrength(password);

  if (!password) return null;

  const levelColors: Record<PasswordStrength['level'], string> = {
    weak: colors.accentError,
    fair: colors.accentWarning,
    good: colors.accentSuccess,
    strong: colors.primary,
  };

  return (
    <View style={strengthStyles.container} testID="password-strength-indicator">
      <View style={[strengthStyles.track, { backgroundColor: colors.muted }]}>
        <View
          style={[
            strengthStyles.bar,
            {
              width: LEVEL_WIDTHS[strength.level],
              backgroundColor: levelColors[strength.level],
            },
          ]}
        />
      </View>
      <View style={strengthStyles.labelContainer}>
        <Text style={[strengthStyles.label, { color: colors.textSecondary }]}>
          {LEVEL_LABELS[strength.level]}
        </Text>
        {strength.feedback.length > 0 && (
          <Text style={[strengthStyles.feedback, { color: colors.textTertiary }]}>
            {strength.feedback[0]}
          </Text>
        )}
      </View>
    </View>
  );
}

interface PasswordRequirementsListProps {
  requirements: PasswordRequirementsState;
  colors: ReturnType<typeof useThemeColors>;
}

function PasswordRequirementsList({ requirements, colors }: PasswordRequirementsListProps) {
  const requirementLabels: Record<keyof PasswordRequirementsState, string> = {
    minLength: 'At least 8 characters',
    hasUppercase: 'One uppercase letter',
    hasLowercase: 'One lowercase letter',
    hasNumber: 'One number',
    hasSpecial: 'One special character',
  };

  return (
    <View style={reqStyles.container} testID="password-requirements">
      {(Object.entries(requirements) as [keyof PasswordRequirementsState, boolean][]).map(
        ([key, isMet]) => (
          <View key={key} style={reqStyles.item} testID={`requirement-${key}`}>
            <Ionicons
              name={isMet ? 'checkmark-circle' : 'close-circle'}
              size={16}
              color={isMet ? colors.accentSuccess : colors.textTertiary}
            />
            <Text
              style={[
                reqStyles.label,
                { color: isMet ? colors.accentSuccess : colors.textSecondary },
              ]}
            >
              {requirementLabels[key]}
            </Text>
          </View>
        )
      )}
    </View>
  );
}

// ============================================================================
// Main Component
// ============================================================================

export function PasswordInput({
  label,
  error,
  helperText,
  required,
  showStrength,
  requirements,
  value,
  onChangeText,
  containerStyle,
  editable = true,
  testID = 'password-input',
  ...props
}: PasswordInputProps) {
  const colors = useThemeColors();
  const [showPassword, setShowPassword] = useState(false);
  const [isFocused, setIsFocused] = useState(false);

  const disabled = !editable;

  const getBorderColor = () => {
    if (error) return inputColors.error;
    if (isFocused) return inputColors.primary;
    return inputColors.border;
  };

  return (
    <View style={[inputStyles.container, containerStyle]}>
      {/* Label */}
      {label && (
        <Text style={[inputStyles.label, disabled && inputStyles.labelDisabled]}>
          {label}
          {required && <Text style={inputStyles.required}> *</Text>}
        </Text>
      )}

      {/* Input container */}
      <View
        style={[
          inputStyles.inputContainer,
          {
            borderColor: getBorderColor(),
            borderWidth: isFocused ? 2 : 1,
          },
          disabled && inputStyles.inputContainerDisabled,
        ]}
      >
        {/* TextInput */}
        <TextInput
          testID={testID}
          value={value}
          onChangeText={onChangeText}
          onFocus={() => setIsFocused(true)}
          onBlur={() => setIsFocused(false)}
          editable={editable}
          secureTextEntry={!showPassword}
          autoCapitalize="none"
          autoCorrect={false}
          placeholderTextColor={inputColors.placeholder}
          style={[
            inputStyles.input,
            inputStyles.inputWithRightIcon,
            disabled && inputStyles.inputDisabled,
          ]}
          accessibilityLabel={label || 'Password'}
          accessibilityHint={helperText}
          {...props}
        />

        {/* Visibility toggle */}
        <Pressable
          onPress={() => setShowPassword(!showPassword)}
          disabled={disabled}
          style={inputStyles.toggleButton}
          accessibilityLabel={showPassword ? 'Hide password' : 'Show password'}
          accessibilityRole="button"
        >
          <Ionicons
            name={showPassword ? 'eye-off-outline' : 'eye-outline'}
            size={20}
            color={inputColors.icon}
          />
        </Pressable>
      </View>

      {/* Error message */}
      {error && (
        <Text style={inputStyles.error} accessibilityRole="alert">
          {error}
        </Text>
      )}

      {/* Helper text */}
      {helperText && !error && (
        <Text style={inputStyles.helperText}>{helperText}</Text>
      )}

      {/* Strength indicator */}
      {showStrength && typeof value === 'string' && (
        <PasswordStrengthBar password={value} colors={colors} />
      )}

      {/* Requirements checklist */}
      {requirements && (
        <PasswordRequirementsList requirements={requirements} colors={colors} />
      )}
    </View>
  );
}

// ============================================================================
// Styles
// ============================================================================

const inputColors = {
  primary: '#0D7C7A',
  error: '#DC2626',
  border: '#CBD5E1',
  placeholder: '#94A3B8',
  icon: '#64748B',
  text: '#0F172A',
  textSecondary: '#475569',
  background: '#FFFFFF',
  backgroundDisabled: '#F1F5F9',
};

const inputStyles = StyleSheet.create({
  container: {
    width: '100%',
  },
  label: {
    fontSize: 14,
    fontWeight: '500',
    color: inputColors.textSecondary,
    marginBottom: 8,
  },
  labelDisabled: {
    opacity: 0.5,
  },
  required: {
    color: inputColors.error,
  },
  inputContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: inputColors.background,
    borderRadius: 12,
    height: 48,
  },
  inputContainerDisabled: {
    backgroundColor: inputColors.backgroundDisabled,
    opacity: 0.7,
  },
  input: {
    flex: 1,
    height: '100%',
    paddingHorizontal: 16,
    fontSize: 16,
    color: inputColors.text,
  },
  inputWithRightIcon: {
    paddingRight: 48,
  },
  inputDisabled: {
    color: inputColors.icon,
  },
  toggleButton: {
    position: 'absolute',
    right: 0,
    paddingHorizontal: 12,
    paddingVertical: 14,
    justifyContent: 'center',
    alignItems: 'center',
  },
  error: {
    fontSize: 14,
    color: inputColors.error,
    marginTop: 8,
  },
  helperText: {
    fontSize: 14,
    color: inputColors.textSecondary,
    marginTop: 8,
  },
});

const strengthStyles = StyleSheet.create({
  container: {
    marginTop: 8,
    gap: 4,
  },
  track: {
    height: 6,
    borderRadius: 3,
    overflow: 'hidden',
  },
  bar: {
    height: '100%',
    borderRadius: 3,
  },
  labelContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  label: {
    fontSize: 12,
  },
  feedback: {
    fontSize: 12,
  },
});

const reqStyles = StyleSheet.create({
  container: {
    marginTop: 12,
    gap: 6,
  },
  item: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 8,
  },
  label: {
    fontSize: 13,
  },
});
```

**Step 11: Export from index.ts**

Update `klard-mobile/src/components/ui/index.ts`:
```tsx
export { Button, type ButtonProps } from './Button';
export { InputField, type InputFieldProps } from './InputField';
export { PasswordInput, type PasswordInputProps } from './PasswordInput';
```

**Step 12: Run tests to verify they pass**

```bash
cd klard-mobile && pnpm test src/__tests__/components/ui/PasswordInput.test.tsx
```

Expected: PASS (all tests green)

**Step 13: Run TypeScript check**

```bash
cd klard-mobile && pnpm build
```

Expected: No TypeScript errors

**Step 14: Commit Mobile implementation**

```bash
git add klard-mobile/src/components/ui/PasswordInput.tsx klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/PasswordInput.test.tsx
git commit -m "feat(mobile): add PasswordInput component with strength indicator and requirements"
```

---

## Task 5: Run Full Verification

**Step 15: Run all tests**

```bash
pnpm test
```

Expected: All tests pass

**Step 16: Run linter**

```bash
pnpm lint
```

Expected: No lint errors

**Step 17: Run full build**

```bash
pnpm build
```

Expected: No build errors

---

## Task 6: Update Specification Marker

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 18: Mark component as DONE**

Replace `<!-- IN-PROGRESS:1.3-password-input -->` with `<!-- DONE:1.3-password-input -->`

**Step 19: Final commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark PasswordInput component as done"
```

---

## Verification Checklist

Before marking complete, verify ALL items:

- [ ] Web PasswordInput renders without errors
- [ ] Mobile PasswordInput renders without errors
- [ ] All props implemented and typed correctly
- [ ] Password visibility toggle works (Web)
- [ ] Password visibility toggle works (Mobile)
- [ ] Strength indicator shows when `showStrength=true` (Web)
- [ ] Strength indicator shows when `showStrength=true` (Mobile)
- [ ] Strength indicator hidden when password empty
- [ ] Requirements checklist shows when `requirements` provided (Web)
- [ ] Requirements checklist shows when `requirements` provided (Mobile)
- [ ] Error message displays correctly
- [ ] Helper text displays when no error
- [ ] Disabled state works correctly
- [ ] Accessibility: aria-label on toggle button (Web)
- [ ] Accessibility: accessibilityLabel on toggle (Mobile)
- [ ] Accessibility: aria-invalid when error present (Web)
- [ ] TypeScript passes with no errors
- [ ] All Web tests passing
- [ ] All Mobile tests passing
- [ ] Exports added to index.ts files
- [ ] Specification marker updated to DONE

---

## Summary

| Task | Files | TDD Phase |
|------|-------|-----------|
| 1 | Web test file | RED |
| 2 | Web component + export | GREEN |
| 3 | Mobile test file | RED |
| 4 | Mobile component + export | GREEN |
| 5 | Full verification | VERIFY |
| 6 | Spec marker update | DONE |

**Total Steps:** 19
**Estimated Time:** 45-60 minutes