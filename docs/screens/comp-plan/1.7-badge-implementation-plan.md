# 1.7 Badge/Chip Component Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a production-ready Badge/Chip component for both Web (Next.js + shadcn/ui) and Mobile (React Native + Expo) platforms with full TDD coverage.

**Architecture:** CVA-based variant system for Web mirroring existing Button pattern. StyleSheet-based implementation for Mobile with expo-haptics integration. Both platforms support 6 semantic variants, 2 sizes, optional icon, and removable functionality.

**Tech Stack:**
- Web: Next.js 16, React 19, TypeScript strict, Tailwind CSS 4, shadcn/ui, CVA, Radix Slot
- Mobile: React Native, Expo SDK 54, TypeScript strict, expo-haptics, @expo/vector-icons

---

## Pre-Implementation Checklist

Before starting, verify these skills are loaded:
- [ ] `superpowers:test-driven-development` - TDD workflow
- [ ] `superpowers:testing-anti-patterns` - Avoid common test mistakes
- [ ] `solid-design-principles` - SOLID compliance
- [ ] `nextjs-app-router` - Next.js patterns (for web)

---

## Component Specification

### Props Interface

```typescript
// Shared interface for both platforms
interface BadgeProps {
  variant?: 'default' | 'primary' | 'success' | 'warning' | 'error' | 'outline';
  size?: 'sm' | 'md';
  icon?: React.ReactNode;
  removable?: boolean;
  onRemove?: () => void;
  children: React.ReactNode;
}
```

### Visual States

| Variant | Light BG | Light Text | Dark BG | Dark Text |
|---------|----------|------------|---------|-----------|
| default | slate-100 | slate-700 | slate-800 | slate-300 |
| primary | teal-100 | teal-700 | teal-900/50 | teal-300 |
| success | green-100 | green-700 | green-900/50 | green-300 |
| warning | amber-100 | amber-700 | amber-900/50 | amber-300 |
| error | red-100 | red-700 | red-900/50 | red-300 |
| outline | transparent | slate-600 | transparent | slate-400 |

### Size Variants

| Size | Font | Padding | Height |
|------|------|---------|--------|
| sm | text-xs (12px) | px-1.5 py-0.5 | ~20px |
| md | text-sm (14px) | px-2.5 py-0.5 | ~22px |

---

## SOLID Compliance

| Principle | Implementation |
|-----------|----------------|
| **SRP** | Badge renders styled content only - no business logic |
| **OCP** | New variants added to CVA config without modifying component |
| **LSP** | All variant values produce valid styled badges |
| **ISP** | Minimal interface with only necessary props |
| **DIP** | Component depends on abstract variant types, not concrete styles |

---

# PART 1: WEB IMPLEMENTATION

## Task 1: Install shadcn/ui Badge Base

**Files:**
- Create: `klard-web/src/components/ui/badge.tsx` (via CLI)

**Step 1: Run shadcn CLI to add badge**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps/klard-web
npx shadcn@latest add badge
```

Expected: Creates `src/components/ui/badge.tsx` with base shadcn badge

**Step 2: Verify file was created**

```bash
ls -la src/components/ui/badge.tsx
```

Expected: File exists

---

## Task 2: Write Failing Tests for Badge Rendering

**Files:**
- Create: `klard-web/src/__tests__/components/ui/badge.test.tsx`

**Step 1: Create test file with rendering tests**

```tsx
/**
 * Tests for Badge Component
 *
 * TDD: Write failing tests first, then implement to pass.
 * Tests verify: rendering, variants, sizes, icons, removable, asChild, accessibility
 */

import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { Badge } from '@/components/ui/badge';

describe('Badge', () => {
  describe('Rendering', () => {
    it('should render with children text', () => {
      render(<Badge>Status</Badge>);

      expect(screen.getByText('Status')).toBeInTheDocument();
    });

    it('should have data-slot attribute', () => {
      render(<Badge>Badge</Badge>);

      const badge = screen.getByText('Badge');
      expect(badge.closest('[data-slot="badge"]')).toBeInTheDocument();
    });

    it('should render as a span element by default', () => {
      render(<Badge>Badge</Badge>);

      const badge = screen.getByText('Badge');
      expect(badge.tagName).toBe('SPAN');
    });
  });
});
```

**Step 2: Run tests to verify they fail**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: FAIL - Badge component doesn't have expected structure yet

---

## Task 3: Write Failing Tests for Variants

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/badge.test.tsx`

**Step 1: Add variant tests**

```tsx
  describe('Variants', () => {
    const variants = [
      'default',
      'primary',
      'success',
      'warning',
      'error',
      'outline',
    ] as const;

    variants.forEach((variant) => {
      it(`should render ${variant} variant without error`, () => {
        render(<Badge variant={variant}>{variant} Badge</Badge>);

        expect(screen.getByText(`${variant} Badge`)).toBeInTheDocument();
      });
    });

    it('should apply default variant when none specified', () => {
      render(<Badge>Default</Badge>);

      const badge = screen.getByText('Default');
      // Default variant has slate background
      expect(badge.className).toMatch(/bg-slate-100|slate/);
    });

    it('should apply primary variant with teal colors', () => {
      render(<Badge variant="primary">Primary</Badge>);

      const badge = screen.getByText('Primary');
      expect(badge.className).toMatch(/bg-teal-100|teal/);
    });

    it('should apply success variant with green colors', () => {
      render(<Badge variant="success">Success</Badge>);

      const badge = screen.getByText('Success');
      expect(badge.className).toMatch(/bg-green-100|green/);
    });

    it('should apply warning variant with amber colors', () => {
      render(<Badge variant="warning">Warning</Badge>);

      const badge = screen.getByText('Warning');
      expect(badge.className).toMatch(/bg-amber-100|amber/);
    });

    it('should apply error variant with red colors', () => {
      render(<Badge variant="error">Error</Badge>);

      const badge = screen.getByText('Error');
      expect(badge.className).toMatch(/bg-red-100|red/);
    });

    it('should apply outline variant with border only', () => {
      render(<Badge variant="outline">Outline</Badge>);

      const badge = screen.getByText('Outline');
      expect(badge.className).toMatch(/border|outline/);
      expect(badge.className).toMatch(/bg-transparent|transparent/);
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: FAIL - Variants not implemented yet

---

## Task 4: Write Failing Tests for Sizes

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/badge.test.tsx`

**Step 1: Add size tests**

```tsx
  describe('Sizes', () => {
    it('should apply md size by default', () => {
      render(<Badge>Medium</Badge>);

      const badge = screen.getByText('Medium');
      expect(badge.className).toMatch(/text-sm|px-2\.5/);
    });

    it('should apply sm size when specified', () => {
      render(<Badge size="sm">Small</Badge>);

      const badge = screen.getByText('Small');
      expect(badge.className).toMatch(/text-xs|px-1\.5/);
    });

    it('should apply md size when specified', () => {
      render(<Badge size="md">Medium</Badge>);

      const badge = screen.getByText('Medium');
      expect(badge.className).toMatch(/text-sm|px-2\.5/);
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: FAIL - Size variants not implemented

---

## Task 5: Write Failing Tests for Icon Support

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/badge.test.tsx`

**Step 1: Add icon tests**

```tsx
  describe('Icon Support', () => {
    it('should render icon when provided', () => {
      const icon = <span data-testid="test-icon">★</span>;
      render(<Badge icon={icon}>With Icon</Badge>);

      expect(screen.getByTestId('test-icon')).toBeInTheDocument();
    });

    it('should render icon before children', () => {
      const icon = <span data-testid="badge-icon">I</span>;
      render(<Badge icon={icon}>Text</Badge>);

      const badge = screen.getByText('Text').closest('[data-slot="badge"]');
      const children = Array.from(badge?.childNodes || []);

      const iconIndex = children.findIndex((child) =>
        (child as Element).querySelector?.('[data-testid="badge-icon"]') ||
        (child as Element).getAttribute?.('data-testid') === 'badge-icon'
      );
      const textIndex = children.findIndex((child) =>
        child.textContent?.includes('Text')
      );

      expect(iconIndex).toBeLessThan(textIndex);
    });

    it('should not render icon wrapper when icon not provided', () => {
      render(<Badge>No Icon</Badge>);

      const badge = screen.getByText('No Icon').closest('[data-slot="badge"]');
      // Should only have the text, no empty icon container
      expect(badge?.children.length).toBeLessThanOrEqual(1);
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: FAIL - Icon prop not implemented

---

## Task 6: Write Failing Tests for Removable

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/badge.test.tsx`

**Step 1: Add removable tests**

```tsx
  describe('Removable', () => {
    it('should show remove button when removable is true', () => {
      render(<Badge removable>Removable</Badge>);

      expect(screen.getByRole('button', { name: /remove/i })).toBeInTheDocument();
    });

    it('should not show remove button by default', () => {
      render(<Badge>Not Removable</Badge>);

      expect(screen.queryByRole('button')).not.toBeInTheDocument();
    });

    it('should call onRemove when remove button is clicked', () => {
      const handleRemove = vi.fn();
      render(<Badge removable onRemove={handleRemove}>Removable</Badge>);

      fireEvent.click(screen.getByRole('button', { name: /remove/i }));

      expect(handleRemove).toHaveBeenCalledTimes(1);
    });

    it('should not call onRemove when badge itself is clicked', () => {
      const handleRemove = vi.fn();
      render(<Badge removable onRemove={handleRemove}>Removable</Badge>);

      fireEvent.click(screen.getByText('Removable'));

      // Only the button click should trigger, not badge click
      expect(handleRemove).not.toHaveBeenCalled();
    });

    it('should have accessible label on remove button', () => {
      render(<Badge removable>Tag</Badge>);

      const button = screen.getByRole('button');
      expect(button).toHaveAccessibleName(/remove/i);
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: FAIL - Removable functionality not implemented

---

## Task 7: Write Failing Tests for asChild and Accessibility

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/badge.test.tsx`

**Step 1: Add asChild and accessibility tests**

```tsx
  describe('asChild', () => {
    it('should render child element with badge styling when asChild is true', () => {
      render(
        <Badge asChild>
          <a href="/test">Link Badge</a>
        </Badge>
      );

      const link = screen.getByRole('link', { name: 'Link Badge' });
      expect(link).toBeInTheDocument();
      expect(link.tagName).toBe('A');
      expect(link.getAttribute('href')).toBe('/test');
    });

    it('should apply badge classes to child element', () => {
      render(
        <Badge asChild variant="primary">
          <button type="button">Button Badge</button>
        </Badge>
      );

      const button = screen.getByRole('button', { name: 'Button Badge' });
      expect(button.className).toMatch(/teal/);
    });
  });

  describe('Custom className', () => {
    it('should merge custom className with default classes', () => {
      render(<Badge className="custom-class">Custom</Badge>);

      const badge = screen.getByText('Custom');
      expect(badge.className).toContain('custom-class');
      expect(badge.className).toContain('inline-flex'); // Default class
    });
  });

  describe('Edge Cases', () => {
    it('should handle empty children', () => {
      render(<Badge>{''}</Badge>);

      // Should render without crashing
      expect(document.querySelector('[data-slot="badge"]')).toBeInTheDocument();
    });

    it('should handle React node children', () => {
      render(
        <Badge>
          <span>Complex</span> <strong>Children</strong>
        </Badge>
      );

      expect(screen.getByText('Complex')).toBeInTheDocument();
      expect(screen.getByText('Children')).toBeInTheDocument();
    });

    it('should pass through additional props', () => {
      render(<Badge data-custom="value" id="my-badge">Props</Badge>);

      const badge = screen.getByText('Props');
      expect(badge.getAttribute('data-custom')).toBe('value');
      expect(badge.getAttribute('id')).toBe('my-badge');
    });
  });
```

**Step 2: Run all tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: Multiple FAIL - asChild and other features not implemented

---

## Task 8: Implement Badge Component

**Files:**
- Modify: `klard-web/src/components/ui/badge.tsx`

**Step 1: Replace shadcn base with full Klard implementation**

```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center gap-1 rounded-full font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300",
        primary:
          "bg-teal-100 text-teal-700 dark:bg-teal-900/50 dark:text-teal-300",
        success:
          "bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300",
        warning:
          "bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300",
        error:
          "bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300",
        outline:
          "bg-transparent border border-slate-300 text-slate-600 dark:border-slate-600 dark:text-slate-400",
        // shadcn defaults (kept for compatibility)
        secondary:
          "bg-secondary text-secondary-foreground",
        destructive:
          "bg-destructive text-destructive-foreground",
      },
      size: {
        sm: "text-xs px-1.5 py-0.5",
        md: "text-sm px-2.5 py-0.5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "md",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLSpanElement>,
    VariantProps<typeof badgeVariants> {
  asChild?: boolean
  icon?: React.ReactNode
  removable?: boolean
  onRemove?: () => void
}

function Badge({
  className,
  variant,
  size,
  asChild = false,
  icon,
  removable = false,
  onRemove,
  children,
  ...props
}: BadgeProps) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant, size }), className)}
      {...props}
    >
      {icon && <span className="shrink-0">{icon}</span>}
      {children}
      {removable && (
        <button
          type="button"
          onClick={(e) => {
            e.stopPropagation()
            onRemove?.()
          }}
          className="ml-0.5 shrink-0 rounded-full p-0.5 hover:bg-black/10 dark:hover:bg-white/10 focus:outline-none focus:ring-1 focus:ring-current"
          aria-label="Remove"
        >
          <X className="h-3 w-3" aria-hidden="true" />
        </button>
      )}
    </Comp>
  )
}

export { Badge, badgeVariants }
```

**Step 2: Run tests to verify they pass**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/badge.test.tsx --run
```

Expected: All tests PASS

---

## Task 9: Export Badge from Index

**Files:**
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Add Badge export**

Add this line to the exports:

```typescript
export { Badge, badgeVariants, type BadgeProps } from './badge';
```

**Step 2: Verify TypeScript compiles**

```bash
pnpm --filter klard-web exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit Web implementation**

```bash
git add klard-web/src/components/ui/badge.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/badge.test.tsx
git commit -m "feat(web): add Badge component with TDD

- Add Badge component with 6 semantic variants (default, primary, success, warning, error, outline)
- Support sm/md sizes, optional icon, removable functionality
- Full dark mode support following Klard design system
- Includes asChild prop for polymorphic rendering
- Comprehensive test coverage"
```

---

# PART 2: MOBILE IMPLEMENTATION

## Task 10: Write Failing Tests for Mobile Badge Rendering

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/Badge.test.tsx`

**Step 1: Create test file with rendering tests**

```tsx
/**
 * Tests for Badge Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */

import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react-native';
import { Badge } from '@/components/ui/Badge';
import * as Haptics from 'expo-haptics';

// Mock expo-haptics
jest.mock('expo-haptics', () => ({
  impactAsync: jest.fn(),
  ImpactFeedbackStyle: {
    Light: 'light',
    Medium: 'medium',
    Heavy: 'heavy',
  },
}));

describe('Badge', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('Rendering', () => {
    it('should render with children text', () => {
      render(<Badge>Status</Badge>);

      expect(screen.getByText('Status')).toBeTruthy();
    });

    it('should have correct accessibility role', () => {
      render(<Badge>Badge</Badge>);

      // Badge should be accessible as text/label
      expect(screen.getByText('Badge')).toBeTruthy();
    });

    it('should render children as Text component', () => {
      render(<Badge>Text Content</Badge>);

      const textElement = screen.getByText('Text Content');
      expect(textElement).toBeTruthy();
    });
  });
});
```

**Step 2: Run tests to verify they fail**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps
pnpm --filter klard-mobile test src/__tests__/components/ui/Badge.test.tsx --run
```

Expected: FAIL - Badge component doesn't exist

---

## Task 11: Write Failing Tests for Mobile Variants

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/Badge.test.tsx`

**Step 1: Add variant tests**

```tsx
  describe('Variants', () => {
    const variants = [
      'default',
      'primary',
      'success',
      'warning',
      'error',
      'outline',
    ] as const;

    variants.forEach((variant) => {
      it(`should render ${variant} variant without error`, () => {
        render(<Badge variant={variant}>{variant}</Badge>);

        expect(screen.getByText(variant)).toBeTruthy();
      });
    });

    it('should apply default variant when none specified', () => {
      const { getByTestId } = render(<Badge testID="badge">Default</Badge>);

      const badge = getByTestId('badge');
      // Verify it renders (styles checked visually or via style prop)
      expect(badge).toBeTruthy();
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Badge.test.tsx --run
```

Expected: FAIL - Variants not implemented

---

## Task 12: Write Failing Tests for Mobile Sizes

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/Badge.test.tsx`

**Step 1: Add size tests**

```tsx
  describe('Sizes', () => {
    it('should render with md size by default', () => {
      render(<Badge testID="badge">Medium</Badge>);

      expect(screen.getByText('Medium')).toBeTruthy();
    });

    it('should render with sm size when specified', () => {
      render(<Badge size="sm" testID="badge">Small</Badge>);

      expect(screen.getByText('Small')).toBeTruthy();
    });

    it('should render with md size when specified', () => {
      render(<Badge size="md" testID="badge">Medium</Badge>);

      expect(screen.getByText('Medium')).toBeTruthy();
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Badge.test.tsx --run
```

Expected: FAIL - Size prop not implemented

---

## Task 13: Write Failing Tests for Mobile Icon and Removable

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/Badge.test.tsx`

**Step 1: Add icon and removable tests**

```tsx
  describe('Icon Support', () => {
    it('should render icon when provided', () => {
      const icon = <Text testID="test-icon">★</Text>;
      render(<Badge icon={icon}>With Icon</Badge>);

      expect(screen.getByTestId('test-icon')).toBeTruthy();
    });

    it('should render both icon and text', () => {
      const icon = <Text testID="icon">I</Text>;
      render(<Badge icon={icon}>Text</Badge>);

      expect(screen.getByTestId('icon')).toBeTruthy();
      expect(screen.getByText('Text')).toBeTruthy();
    });
  });

  describe('Removable', () => {
    it('should show remove button when removable is true', () => {
      render(<Badge removable testID="badge">Removable</Badge>);

      // Look for the remove button by testID or accessible name
      expect(screen.getByLabelText(/remove/i)).toBeTruthy();
    });

    it('should not show remove button by default', () => {
      render(<Badge testID="badge">Not Removable</Badge>);

      expect(screen.queryByLabelText(/remove/i)).toBeNull();
    });

    it('should call onRemove when remove button is pressed', async () => {
      const handleRemove = jest.fn();
      render(<Badge removable onRemove={handleRemove}>Removable</Badge>);

      fireEvent.press(screen.getByLabelText(/remove/i));

      await waitFor(() => {
        expect(handleRemove).toHaveBeenCalledTimes(1);
      });
    });

    it('should trigger haptic feedback when remove button is pressed', async () => {
      const handleRemove = jest.fn();
      render(<Badge removable onRemove={handleRemove}>Removable</Badge>);

      fireEvent.press(screen.getByLabelText(/remove/i));

      await waitFor(() => {
        expect(Haptics.impactAsync).toHaveBeenCalledWith(
          Haptics.ImpactFeedbackStyle.Light
        );
      });
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Badge.test.tsx --run
```

Expected: FAIL - Icon and removable not implemented

---

## Task 14: Implement Mobile Badge Component

**Files:**
- Create: `klard-mobile/src/components/ui/Badge.tsx`

**Step 1: Create the Badge component**

```tsx
import React from 'react';
import {
  View,
  Text,
  Pressable,
  StyleSheet,
  type ViewStyle,
  type TextStyle,
  type StyleProp,
} from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import * as Haptics from 'expo-haptics';

export interface BadgeProps {
  variant?: 'default' | 'primary' | 'success' | 'warning' | 'error' | 'outline';
  size?: 'sm' | 'md';
  icon?: React.ReactNode;
  removable?: boolean;
  onRemove?: () => void;
  children?: React.ReactNode;
  style?: StyleProp<ViewStyle>;
  testID?: string;
}

export function Badge({
  variant = 'default',
  size = 'md',
  icon,
  removable = false,
  onRemove,
  children,
  style,
  testID,
}: BadgeProps) {
  const handleRemove = async () => {
    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    onRemove?.();
  };

  return (
    <View
      style={[
        styles.base,
        variantStyles[variant],
        sizeStyles[size],
        style,
      ]}
      testID={testID}
      accessibilityRole="text"
    >
      {icon && <View style={styles.iconContainer}>{icon}</View>}
      <Text style={[styles.text, textStyles[variant], textSizeStyles[size]]}>
        {children}
      </Text>
      {removable && (
        <Pressable
          onPress={handleRemove}
          style={styles.removeButton}
          accessibilityLabel="Remove"
          accessibilityRole="button"
          hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}
        >
          <Ionicons
            name="close"
            size={size === 'sm' ? 10 : 12}
            color={textStyles[variant].color}
          />
        </Pressable>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  base: {
    flexDirection: 'row',
    alignItems: 'center',
    borderRadius: 9999,
    gap: 4,
  },
  iconContainer: {
    flexShrink: 0,
  },
  text: {
    fontWeight: '500',
  },
  removeButton: {
    marginLeft: 2,
    padding: 2,
    borderRadius: 9999,
  },
});

const variantStyles = StyleSheet.create({
  default: {
    backgroundColor: '#F1F5F9', // slate-100
  },
  primary: {
    backgroundColor: '#CCFBF1', // teal-100
  },
  success: {
    backgroundColor: '#DCFCE7', // green-100
  },
  warning: {
    backgroundColor: '#FEF3C7', // amber-100
  },
  error: {
    backgroundColor: '#FEE2E2', // red-100
  },
  outline: {
    backgroundColor: 'transparent',
    borderWidth: 1,
    borderColor: '#CBD5E1', // slate-300
  },
});

const textStyles = StyleSheet.create({
  default: {
    color: '#334155', // slate-700
  },
  primary: {
    color: '#0D7C7A', // teal-700
  },
  success: {
    color: '#15803D', // green-700
  },
  warning: {
    color: '#B45309', // amber-700
  },
  error: {
    color: '#B91C1C', // red-700
  },
  outline: {
    color: '#475569', // slate-600
  },
});

const sizeStyles = StyleSheet.create({
  sm: {
    paddingHorizontal: 6,
    paddingVertical: 2,
  },
  md: {
    paddingHorizontal: 10,
    paddingVertical: 2,
  },
});

const textSizeStyles = StyleSheet.create({
  sm: {
    fontSize: 12,
  },
  md: {
    fontSize: 14,
  },
});
```

**Step 2: Run tests to verify they pass**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Badge.test.tsx --run
```

Expected: All tests PASS

---

## Task 15: Export Mobile Badge from Index

**Files:**
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Add Badge export**

Add this line to the exports:

```typescript
export { Badge, type BadgeProps } from './Badge';
```

**Step 2: Verify TypeScript compiles**

```bash
pnpm --filter klard-mobile exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit Mobile implementation**

```bash
git add klard-mobile/src/components/ui/Badge.tsx klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/Badge.test.tsx
git commit -m "feat(mobile): add Badge component with TDD

- Add Badge component with 6 semantic variants
- Support sm/md sizes, optional icon, removable with haptic feedback
- Follows Klard design system colors
- Comprehensive test coverage with mocked expo-haptics"
```

---

# PART 3: VERIFICATION & COMPLETION

## Task 16: Run Full Test Suite

**Step 1: Run all web tests**

```bash
pnpm --filter klard-web test --run
```

Expected: All tests PASS

**Step 2: Run all mobile tests**

```bash
pnpm --filter klard-mobile test --run
```

Expected: All tests PASS

**Step 3: Run TypeScript check on both**

```bash
pnpm --filter klard-web exec tsc --noEmit && pnpm --filter klard-mobile exec tsc --noEmit
```

Expected: No TypeScript errors

---

## Task 17: Verification Checklist

Complete this checklist before marking component as DONE:

**Web Badge:**
- [ ] Component renders without errors
- [ ] All 6 variants functional (default, primary, success, warning, error, outline)
- [ ] Both sizes functional (sm, md)
- [ ] Icon prop renders icon before children
- [ ] Removable shows X button and calls onRemove
- [ ] asChild prop works for polymorphic rendering
- [ ] Dark mode styles applied correctly
- [ ] TypeScript compiles with no errors
- [ ] All tests passing
- [ ] Exported from index.ts

**Mobile Badge:**
- [ ] Component renders without errors
- [ ] All 6 variants functional
- [ ] Both sizes functional
- [ ] Icon prop renders icon
- [ ] Removable shows button with haptic feedback
- [ ] TypeScript compiles with no errors
- [ ] All tests passing
- [ ] Exported from index.ts

---

## Task 18: Mark Component as DONE

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Update spec marker**

Replace:
```
<!-- IN-PROGRESS:1.7-badge-chip -->
```

With:
```
<!-- DONE:1.7-badge-chip -->
```

**Step 2: Final commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark 1.7-badge-chip component as DONE"
```

---

## Summary

| Task | Platform | Description |
|------|----------|-------------|
| 1 | Web | Install shadcn/ui badge base |
| 2-7 | Web | Write failing tests (TDD RED phase) |
| 8 | Web | Implement Badge component (TDD GREEN phase) |
| 9 | Web | Export from index.ts |
| 10-13 | Mobile | Write failing tests (TDD RED phase) |
| 14 | Mobile | Implement Badge component (TDD GREEN phase) |
| 15 | Mobile | Export from index.ts |
| 16 | Both | Run full test suite |
| 17 | Both | Verification checklist |
| 18 | Docs | Mark component as DONE |

**Total Tasks:** 18
**Estimated Time:** 45-60 minutes

---

## Execution Options

**Plan complete and saved to `docs/screens/comp-plan/1.7-badge-implementation-plan.md`.**

**Two execution options:**

1. **Subagent-Driven (this session)** - Dispatch fresh subagent per task, review between tasks, fast iteration

2. **Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

**Which approach?**