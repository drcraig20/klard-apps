# 1.10 Spinner/Loading Component Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a production-ready Spinner/Loading component for both Web (Next.js + shadcn/ui) and Mobile (React Native + Expo) platforms with full TDD coverage.

**Architecture:** Web uses Lucide's LoaderIcon with animate-spin, matching shadcn/ui Spinner pattern. Mobile uses React Native's ActivityIndicator. Both support size variants, custom color, and optional label text.

**Tech Stack:**
- Web: Next.js 16, React 19, TypeScript strict, Tailwind CSS 4, lucide-react
- Mobile: React Native, Expo SDK 54, TypeScript strict, ActivityIndicator

---

## Pre-Implementation Checklist

Before starting, verify these skills are loaded:
- [ ] `superpowers:test-driven-development` - TDD workflow
- [ ] `superpowers:testing-anti-patterns` - Avoid common test mistakes
- [ ] `solid-design-principles` - SOLID compliance

---

## Component Specification

### Props Interface

```typescript
// Web - extends SVG props for flexibility
interface SpinnerProps extends React.ComponentProps<"svg"> {
  size?: 'sm' | 'md' | 'lg';
  label?: string;
}

// Mobile - custom props
interface SpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  color?: string;
  label?: string;
  testID?: string;
}
```

### Size Mapping

| Size | Web (Tailwind) | Mobile (ActivityIndicator) |
|------|----------------|---------------------------|
| sm | size-4 (16px) | "small" |
| md | size-6 (24px) | "small" |
| lg | size-8 (32px) | "large" |

### Default Colors

- Web: Uses `currentColor` (inherits from parent)
- Mobile: `#0D7C7A` (Klard primary teal)

---

## SOLID Compliance

| Principle | Implementation |
|-----------|----------------|
| **SRP** | Spinner only displays loading indicator - no business logic |
| **OCP** | Size/color variants via props, no modification needed |
| **LSP** | All size values produce valid spinners |
| **ISP** | Minimal interface with only necessary props |
| **DIP** | Component depends on abstract size type, not concrete dimensions |

---

## Investigation Findings

### Existing Web Code

File: `klard-web/src/components/ui/loading-spinner.tsx`

```tsx
// Current implementation uses CSS border-based spinner
// Need to replace with shadcn/ui pattern using LoaderIcon
```

**Decision:** Replace existing `LoadingSpinner` with shadcn/ui-style `Spinner` component using `LoaderIcon` from lucide-react. Keep the existing file but update to match spec.

### shadcn/ui Spinner Pattern (from Context7)

```tsx
import { LoaderIcon } from "lucide-react"
import { cn } from "@/lib/utils"

function Spinner({ className, ...props }: React.ComponentProps<"svg">) {
  return (
    <LoaderIcon
      role="status"
      aria-label="Loading"
      className={cn("size-4 animate-spin", className)}
      {...props}
    />
  )
}
```

### React Native ActivityIndicator (from Context7)

```tsx
import { ActivityIndicator } from 'react-native';

// Props: animating, color, size ('small' | 'large' | number), hidesWhenStopped (iOS)
<ActivityIndicator size="large" color="#0D7C7A" />
```

---

## Dependencies

### Web
- `lucide-react` - LoaderIcon (already installed)
- `@/lib/utils` - cn utility (already exists)

### Mobile
- `react-native` - ActivityIndicator (core component)
- No additional dependencies needed

---

# PART 1: WEB IMPLEMENTATION

## Task 1: Write Failing Tests for Spinner Rendering

**Files:**
- Create: `klard-web/src/__tests__/components/ui/spinner.test.tsx`

**Step 1: Create test file with rendering tests**

```tsx
/**
 * Tests for Spinner Component
 *
 * TDD: Write failing tests first, then implement to pass.
 * Tests verify: rendering, sizes, label, accessibility, custom className
 */

import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { Spinner } from '@/components/ui/spinner';

describe('Spinner', () => {
  describe('Rendering', () => {
    it('should render an SVG element', () => {
      render(<Spinner />);

      const spinner = screen.getByRole('status');
      expect(spinner.tagName.toLowerCase()).toBe('svg');
    });

    it('should have animate-spin class for animation', () => {
      render(<Spinner />);

      const spinner = screen.getByRole('status');
      expect(spinner.className).toContain('animate-spin');
    });

    it('should have aria-label for accessibility', () => {
      render(<Spinner />);

      const spinner = screen.getByRole('status');
      expect(spinner.getAttribute('aria-label')).toBe('Loading');
    });
  });
});
```

**Step 2: Run tests to verify they fail**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps
pnpm --filter klard-web test src/__tests__/components/ui/spinner.test.tsx --run
```

Expected: FAIL - Spinner component doesn't exist yet or doesn't match expected structure

---

## Task 2: Write Failing Tests for Size Variants

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/spinner.test.tsx`

**Step 1: Add size tests**

```tsx
  describe('Sizes', () => {
    it('should apply md size by default', () => {
      render(<Spinner />);

      const spinner = screen.getByRole('status');
      expect(spinner.className).toMatch(/size-6|h-6|w-6/);
    });

    it('should apply sm size when specified', () => {
      render(<Spinner size="sm" />);

      const spinner = screen.getByRole('status');
      expect(spinner.className).toMatch(/size-4|h-4|w-4/);
    });

    it('should apply lg size when specified', () => {
      render(<Spinner size="lg" />);

      const spinner = screen.getByRole('status');
      expect(spinner.className).toMatch(/size-8|h-8|w-8/);
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/spinner.test.tsx --run
```

Expected: FAIL - Size prop not implemented

---

## Task 3: Write Failing Tests for Label

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/spinner.test.tsx`

**Step 1: Add label tests**

```tsx
  describe('Label', () => {
    it('should render label text when provided', () => {
      render(<Spinner label="Loading..." />);

      expect(screen.getByText('Loading...')).toBeInTheDocument();
    });

    it('should not render label container when label not provided', () => {
      render(<Spinner />);

      // Only the spinner SVG should be rendered
      const container = screen.getByRole('status').parentElement;
      expect(container?.querySelectorAll('span').length).toBeLessThanOrEqual(1);
    });

    it('should render spinner and label in flex container when label provided', () => {
      render(<Spinner label="Please wait" />);

      const container = screen.getByText('Please wait').parentElement;
      expect(container?.className).toContain('flex');
      expect(container?.className).toContain('items-center');
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/spinner.test.tsx --run
```

Expected: FAIL - Label prop not implemented

---

## Task 4: Write Failing Tests for Custom className and Props

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/spinner.test.tsx`

**Step 1: Add className and props tests**

```tsx
  describe('Custom className', () => {
    it('should merge custom className with default classes', () => {
      render(<Spinner className="text-red-500" />);

      const spinner = screen.getByRole('status');
      expect(spinner.className).toContain('text-red-500');
      expect(spinner.className).toContain('animate-spin');
    });
  });

  describe('Props passthrough', () => {
    it('should pass through additional SVG props', () => {
      render(<Spinner data-testid="custom-spinner" />);

      expect(screen.getByTestId('custom-spinner')).toBeInTheDocument();
    });
  });
```

**Step 2: Run all tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/spinner.test.tsx --run
```

Expected: Multiple FAIL

---

## Task 5: Implement Spinner Component

**Files:**
- Create: `klard-web/src/components/ui/spinner.tsx`

**Step 1: Create the Spinner component**

```tsx
import { LoaderIcon } from "lucide-react"

import { cn } from "@/lib/utils"

const sizeMap = {
  sm: "size-4",
  md: "size-6",
  lg: "size-8",
} as const

export interface SpinnerProps extends React.ComponentProps<"svg"> {
  size?: keyof typeof sizeMap
  label?: string
}

function Spinner({
  className,
  size = "md",
  label,
  ...props
}: SpinnerProps) {
  const spinner = (
    <LoaderIcon
      role="status"
      aria-label="Loading"
      className={cn(sizeMap[size], "animate-spin", className)}
      {...props}
    />
  )

  if (label) {
    return (
      <div className="flex items-center gap-2">
        {spinner}
        <span className="text-sm text-slate-600 dark:text-slate-400">{label}</span>
      </div>
    )
  }

  return spinner
}

export { Spinner }
```

**Step 2: Run tests to verify they pass**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/spinner.test.tsx --run
```

Expected: All tests PASS

---

## Task 6: Update Existing LoadingSpinner for Backwards Compatibility

**Files:**
- Modify: `klard-web/src/components/ui/loading-spinner.tsx`

**Step 1: Update LoadingSpinner to use new Spinner internally**

```tsx
import { cn } from "@/lib/utils";
import { Spinner } from "./spinner";

interface LoadingSpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  variant?: 'primary' | 'white';
  className?: string;
}

/**
 * @deprecated Use Spinner from './spinner' instead
 */
export function LoadingSpinner({
  size = 'md',
  variant = 'primary',
  className = ''
}: LoadingSpinnerProps) {
  const colorClass = variant === 'white' ? 'text-white' : 'text-primary';

  return (
    <Spinner
      size={size}
      className={cn(colorClass, className)}
    />
  );
}
```

**Step 2: Verify existing code still works**

```bash
pnpm --filter klard-web exec tsc --noEmit
```

Expected: No TypeScript errors

---

## Task 7: Export Spinner from Index

**Files:**
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Add Spinner export**

Add this line to the exports:

```typescript
export { Spinner, type SpinnerProps } from './spinner';
```

**Step 2: Verify TypeScript compiles**

```bash
pnpm --filter klard-web exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit Web implementation**

```bash
git add klard-web/src/components/ui/spinner.tsx klard-web/src/components/ui/loading-spinner.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/spinner.test.tsx
git commit -m "feat(web): add Spinner component with TDD

- Add Spinner component using LoaderIcon from lucide-react
- Support sm/md/lg sizes and optional label
- Update LoadingSpinner to use Spinner internally (backwards compatible)
- Comprehensive test coverage"
```

---

# PART 2: MOBILE IMPLEMENTATION

## Task 8: Write Failing Tests for Mobile Spinner Rendering

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/Spinner.test.tsx`

**Step 1: Create test file with rendering tests**

```tsx
/**
 * Tests for Spinner Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */

import React from 'react';
import { render, screen } from '@testing-library/react-native';
import { Spinner } from '@/components/ui/Spinner';

describe('Spinner', () => {
  describe('Rendering', () => {
    it('should render an ActivityIndicator', () => {
      render(<Spinner testID="spinner" />);

      expect(screen.getByTestId('spinner')).toBeTruthy();
    });

    it('should have accessibility role', () => {
      render(<Spinner testID="spinner" />);

      // ActivityIndicator doesn't have a direct role, check it renders
      expect(screen.getByTestId('spinner')).toBeTruthy();
    });
  });
});
```

**Step 2: Run tests to verify they fail**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps
pnpm --filter klard-mobile test src/__tests__/components/ui/Spinner.test.tsx --run
```

Expected: FAIL - Spinner component doesn't exist

---

## Task 9: Write Failing Tests for Mobile Size Variants

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/Spinner.test.tsx`

**Step 1: Add size tests**

```tsx
  describe('Sizes', () => {
    it('should render with md size by default', () => {
      render(<Spinner testID="spinner" />);

      // md maps to 'small' ActivityIndicator
      expect(screen.getByTestId('spinner')).toBeTruthy();
    });

    it('should render with sm size when specified', () => {
      render(<Spinner size="sm" testID="spinner" />);

      expect(screen.getByTestId('spinner')).toBeTruthy();
    });

    it('should render with lg size when specified', () => {
      render(<Spinner size="lg" testID="spinner" />);

      // lg maps to 'large' ActivityIndicator
      expect(screen.getByTestId('spinner')).toBeTruthy();
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Spinner.test.tsx --run
```

Expected: FAIL - Size prop not implemented

---

## Task 10: Write Failing Tests for Mobile Label and Color

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/Spinner.test.tsx`

**Step 1: Add label and color tests**

```tsx
  describe('Label', () => {
    it('should render label text when provided', () => {
      render(<Spinner label="Loading..." />);

      expect(screen.getByText('Loading...')).toBeTruthy();
    });

    it('should not render label when not provided', () => {
      render(<Spinner testID="spinner" />);

      expect(screen.queryByText('Loading')).toBeNull();
    });
  });

  describe('Color', () => {
    it('should use default Klard teal color', () => {
      render(<Spinner testID="spinner" />);

      // Default color is #0D7C7A
      expect(screen.getByTestId('spinner')).toBeTruthy();
    });

    it('should accept custom color', () => {
      render(<Spinner color="#FF0000" testID="spinner" />);

      expect(screen.getByTestId('spinner')).toBeTruthy();
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Spinner.test.tsx --run
```

Expected: FAIL - Label and color not implemented

---

## Task 11: Implement Mobile Spinner Component

**Files:**
- Create: `klard-mobile/src/components/ui/Spinner.tsx`

**Step 1: Create the Spinner component**

```tsx
import React from 'react';
import {
  ActivityIndicator,
  View,
  Text,
  StyleSheet,
  type ViewStyle,
  type StyleProp,
} from 'react-native';

export interface SpinnerProps {
  size?: 'sm' | 'md' | 'lg';
  color?: string;
  label?: string;
  style?: StyleProp<ViewStyle>;
  testID?: string;
}

const sizeMap = {
  sm: 'small' as const,
  md: 'small' as const,
  lg: 'large' as const,
};

export function Spinner({
  size = 'md',
  color = '#0D7C7A',
  label,
  style,
  testID,
}: SpinnerProps) {
  const activityIndicatorSize = sizeMap[size];

  if (label) {
    return (
      <View style={[styles.container, style]}>
        <ActivityIndicator
          size={activityIndicatorSize}
          color={color}
          testID={testID}
        />
        <Text style={styles.label}>{label}</Text>
      </View>
    );
  }

  return (
    <ActivityIndicator
      size={activityIndicatorSize}
      color={color}
      testID={testID}
      style={style}
    />
  );
}

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 8,
  },
  label: {
    fontSize: 14,
    color: '#475569', // slate-600
  },
});
```

**Step 2: Run tests to verify they pass**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/Spinner.test.tsx --run
```

Expected: All tests PASS

---

## Task 12: Export Mobile Spinner from Index

**Files:**
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Add Spinner export**

Add this line to the exports:

```typescript
export { Spinner, type SpinnerProps } from './Spinner';
```

**Step 2: Verify TypeScript compiles**

```bash
pnpm --filter klard-mobile exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit Mobile implementation**

```bash
git add klard-mobile/src/components/ui/Spinner.tsx klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/Spinner.test.tsx
git commit -m "feat(mobile): add Spinner component with TDD

- Add Spinner component using ActivityIndicator
- Support sm/md/lg sizes, custom color, optional label
- Follows Klard design system colors
- Comprehensive test coverage"
```

---

# PART 3: VERIFICATION & COMPLETION

## Task 13: Run Full Test Suite

**Step 1: Run all web tests**

```bash
pnpm --filter klard-web test --run
```

Expected: All tests PASS

**Step 2: Run all mobile tests**

```bash
pnpm --filter klard-mobile test --run
```

Expected: All tests PASS

**Step 3: Run TypeScript check on both**

```bash
pnpm --filter klard-web exec tsc --noEmit && pnpm --filter klard-mobile exec tsc --noEmit
```

Expected: No TypeScript errors

---

## Task 14: Verification Checklist

Complete this checklist before marking component as DONE:

**Web Spinner:**
- [ ] Component renders without errors
- [ ] All 3 sizes functional (sm, md, lg)
- [ ] Label prop renders text with spinner
- [ ] Custom className merges correctly
- [ ] Props passthrough works (data-testid, etc.)
- [ ] Accessibility: role="status", aria-label="Loading"
- [ ] TypeScript compiles with no errors
- [ ] All tests passing
- [ ] Exported from index.ts
- [ ] LoadingSpinner backwards compatible

**Mobile Spinner:**
- [ ] Component renders without errors
- [ ] All 3 sizes functional (sm, md, lg)
- [ ] Custom color prop works
- [ ] Label prop renders text with spinner
- [ ] Default color is Klard teal (#0D7C7A)
- [ ] TypeScript compiles with no errors
- [ ] All tests passing
- [ ] Exported from index.ts

---

## Task 15: Mark Component as DONE

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Update spec marker**

Replace:
```
<!-- IN-PROGRESS:1.10-spinner-loading -->
```

With:
```
<!-- DONE:1.10-spinner-loading -->
```

**Step 2: Final commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark 1.10-spinner-loading component as DONE"
```

---

## Summary

| Task | Platform | Description |
|------|----------|-------------|
| 1-4 | Web | Write failing tests (TDD RED phase) |
| 5 | Web | Implement Spinner component (TDD GREEN phase) |
| 6 | Web | Update LoadingSpinner for backwards compatibility |
| 7 | Web | Export from index.ts |
| 8-10 | Mobile | Write failing tests (TDD RED phase) |
| 11 | Mobile | Implement Spinner component (TDD GREEN phase) |
| 12 | Mobile | Export from index.ts |
| 13 | Both | Run full test suite |
| 14 | Both | Verification checklist |
| 15 | Docs | Mark component as DONE |

**Total Tasks:** 15
**Estimated Time:** 30-45 minutes

---

## File Structure

### Web
```
klard-web/src/
├── components/ui/
│   ├── spinner.tsx           # New component
│   ├── loading-spinner.tsx   # Updated (uses Spinner)
│   └── index.ts              # Export added
└── __tests__/components/ui/
    └── spinner.test.tsx      # Test file
```

### Mobile
```
klard-mobile/src/
├── components/ui/
│   ├── Spinner.tsx           # New component
│   └── index.ts              # Export added
└── __tests__/components/ui/
    └── Spinner.test.tsx      # Test file
```

---

## Execution Options

**Plan complete and saved to `docs/screens/comp-plan/1.10-spinner-implementation-plan.md`.**

**Two execution options:**

1. **Subagent-Driven (this session)** - Dispatch fresh subagent per task, review between tasks, fast iteration

2. **Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

**Which approach?**