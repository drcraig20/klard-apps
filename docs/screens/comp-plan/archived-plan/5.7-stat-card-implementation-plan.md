# StatCard Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a StatCard component for web and mobile that surfaces key metrics with optional trend, icon, and click handling following Klard design tokens and accessibility rules.

**Architecture:** New UI primitives for both platforms with small, focused props; web uses shadcn Card + CVA-based variants for trend/state styling, mobile uses StyleSheet + `useThemeColors` with Ionicons. Shared behavior kept minimal and props-driven to satisfy SRP/OCP, with dependency injection for icons and callbacks. Exports wired through existing index barrels.

**Tech Stack:** Next.js 16 App Router, React 19, TypeScript (strict), Tailwind CSS 4 + shadcn/ui + CVA (web), Expo 54 + React Native + @expo/vector-icons Ionicons (mobile), Vitest + Testing Library (web), jest-expo + React Native Testing Library (mobile).

---

- **Component:** StatCard â€” displays label/value with optional trend and icon; clickable for drill-down.
- **Targets:** Web + Mobile.
- **Props:** 
  ```ts
  interface StatCardProps {
    label: string;
    value: string | number;
    trend?: { direction: 'up' | 'down' | 'neutral'; value: string };
    icon?: React.ReactNode;
    onClick?: () => void;
    size?: 'sm' | 'md' | 'lg'; // padding + icon/text scale
    muted?: boolean; // tone for non-primary stats
    className?/style?: overrides per platform;
  }
  ```
- **Visual States:** default, hover/focus (web), pressed/active, disabled (none needed), loading (n/a), error (n/a), muted (reduced contrast), trend variants (up/success, down/error, neutral/slate).
- **Size Variants (exact):** `sm` padding 12px (py-3 px-4 web / 12 RN), text 14px, icon 16px; `md` padding 16px, text 16px, icon 18px; `lg` padding 20px, text 18px, icon 20px.
- **Color Tokens:** Light: bg `#FFFFFF`, border `rgba(15,23,42,0.08)`, text `#0F172A`, muted text `#475569`, primary accent `#0D7C7A`, success `#059669`, error `#DC2626`; Dark: bg `#1E293B`, border `rgba(148,163,184,0.18)`, text `#F8FAFC`, muted `#CBD5E1`, primary accent `#15B5B0`, success `#10B981`, error `#EF4444`. Use subtle glass/backdrop blur for elevated feel on web.
- **Accessibility:** 
  - Web: role="button" when clickable, keyboard focus states, `aria-pressed` not needed, `aria-label` on trend icon via sr-only text, data-slot attributes for container/label/value/trend/icon.
  - Mobile: `accessible` + `accessibilityRole="button"` when onPress provided, `accessibilityLabel` combining label/value/trend; ensure touch target >= 44px height; RTL-safe layout.
- **Dependencies:** Web: shadcn Card primitives, `cn` util, `class-variance-authority`, lucide-react icons (ArrowUpRight, ArrowDownRight, Minus). Mobile: @expo/vector-icons/Ionicons, `useThemeColors` hook, `TouchableOpacity` wrapper for pressable variant.
- **SOLID Compliance**

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Web StatCard | Renders stat content & trend display only | Trend/size via CVA variants; new styles via props | Accepts any string/number values; neutral trend optional without breaking | Props interface scoped to rendering concerns | Depends on `cn`, `Card`, and icons via props imports |
| Mobile StatCard | Render stat/tap handling only | Colors/sizes driven by theme + size prop | Works with any label/value; trend optional | Props limited to rendering + onPress | Pulls colors from hook; icon injected via prop |

- **Parallel Sub-Agent Strategy:** If enabled, dedicate subagent for writing tests (web + mobile) while another prepares implementation scaffolds; run code-review subagent after each task block. No concurrent edits to same file.

- **Test Strategy (TDD first):**
  - Web: render label/value, default trend hidden when absent, trend direction icon + color mapping, neutral trend icon/text, size variant classes, muted style, click handler fires, data-slot presence, keyboard role on clickable cards.
  - Mobile: render label/value, trend icon/color per direction, neutral hides icon, size variant font/icon sizes, press handler invoked, accessibilityRole/button when onPress, style override merges.

---

### Task 1: Web StatCard tests

**Files:**
- Create: `klard-web/src/__tests__/components/ui/stat-card.test.tsx`

**Step 1: Write the failing test**
```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { StatCard } from '@/components/ui/stat-card';

describe('StatCard (web)', () => {
  it('renders label and value', () => { /* ... */ });
  it('renders upward trend with green icon/text', () => { /* ... */ });
  it('renders downward trend with red icon/text', () => { /* ... */ });
  it('renders neutral trend with muted tone and minus icon', () => { /* ... */ });
  it('handles click when onClick provided', () => { /* ... */ });
  it('applies size variants to padding/text', () => { /* ... */ });
  it('applies muted tone when muted prop set', () => { /* ... */ });
  it('sets role=button and tabIndex when clickable', () => { /* ... */ });
  it('exposes data-slot hooks', () => { /* ... */ });
});
```

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/stat-card.test.tsx --run`  
Expected: FAIL (StatCard not found/behaviors missing).

**Step 3: Write minimal implementation**  
Implement `klard-web/src/components/ui/stat-card.tsx` with CVA variants, data-slots, shadcn Card, lucide icons, click handling, size/muted classes, export in `klard-web/src/components/ui/index.ts`.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/stat-card.test.tsx --run`  
Expected: PASS.

**Step 5: Commit**  
```
git add klard-web/src/components/ui/stat-card.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/stat-card.test.tsx
git commit -m "feat(web): add StatCard component"
```

### Task 2: Mobile StatCard tests

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/StatCard.test.tsx`

**Step 1: Write the failing test**
```tsx
import { render, screen, fireEvent } from '@testing-library/react-native';
import { StatCard } from '@/components/ui/StatCard';

describe('StatCard (mobile)', () => {
  it('renders label and value', () => { /* ... */ });
  it('renders upward trend icon/color', () => { /* ... */ });
  it('renders downward trend icon/color', () => { /* ... */ });
  it('renders neutral trend without icon and muted text', () => { /* ... */ });
  it('fires onPress when provided', () => { /* ... */ });
  it('applies size variant styles', () => { /* ... */ });
  it('sets accessibilityRole/button when pressable', () => { /* ... */ });
  it('merges style prop', () => { /* ... */ });
});
```

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/StatCard.test.tsx --run`  
Expected: FAIL (component missing/behavior absent).

**Step 3: Write minimal implementation**  
Implement `klard-mobile/src/components/ui/StatCard.tsx` using `TouchableOpacity` when onPress exists, `useThemeColors`, Ionicons for trend, size styles via StyleSheet, export in `klard-mobile/src/components/ui/index.ts`.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/StatCard.test.tsx --run`  
Expected: PASS.

**Step 5: Commit**  
```
git add klard-mobile/src/components/ui/StatCard.tsx klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/StatCard.test.tsx
git commit -m "feat(mobile): add StatCard component"
```

### Task 3: Verification & spec update

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md` (mark DONE for 5.7-stat-card)

**Step 1: Run full relevant tests**  
`pnpm --filter klard-web test --run`  
`pnpm --filter klard-mobile test --run`

**Step 2: Type checks (scoped)**  
`pnpm --filter klard-web exec tsc --noEmit`  
`pnpm --filter klard-mobile exec tsc --noEmit`

**Step 3: Update spec marker**  
Replace `<!-- IN-PROGRESS:5.7-stat-card -->` with `<!-- DONE:5.7-stat-card -->`.

**Step 4: Commit**  
```
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "chore: finalize stat card spec status"
```

**Step 5: Final verification**  
Ensure exports present, components render without runtime errors, accessibility checks satisfied, colors align with design tokens; if using subagents, run klard-ui-verify screenshots as follow-up.
