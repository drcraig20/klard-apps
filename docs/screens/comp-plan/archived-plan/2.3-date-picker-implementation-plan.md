# 2.3 DatePicker Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a cross-platform DatePicker that lets users pick dates (and time/datetime modes), respects min/max bounds, shows label/error/placeholder states, and matches Klard’s design system on web (shadcn + Tailwind) and mobile (Expo native pickers).

**Architecture:** Web: client component using shadcn `Popover` + `Calendar` (react-day-picker) with `date-fns` formatting, wrapped in FormField-like structure for label/error, exporting through `@/components/ui`. Mobile: React Native component using Expo `@expo/ui` DateTimePicker (SwiftUI/Jetpack Compose) with fallback to community picker, haptic feedback, FormField styling, and accessibility props. Shared props surface ensures parity; min/max enforced in picker callbacks.

**Tech Stack:** Next.js 16 (client component), React 19, Tailwind 4, shadcn/radix-popover, react-day-picker, date-fns; Expo 54, React Native 0.81, @expo/ui (SwiftUI/Compose pickers), @react-native-community/datetimepicker fallback, expo-haptics, TypeScript strict.

---

- **Component:** `DatePicker` — controlled date/time input with label/error/help, min/max bounds, and placeholder.
- **Targets:** Web (Next.js/shadcn) and Mobile (Expo/React Native).
- **Props (shared intent):**
  - `value: Date | null`
  - `onChange: (date: Date | null) => void`
  - `label?: string`
  - `error?: string`
  - `minDate?: Date`
  - `maxDate?: Date`
  - `placeholder?: string`
  - `mode?: 'date' | 'time' | 'datetime'` (default `'date'`)
- **Visual states:** placeholder/empty, selected value, hover/focus (web), disabled days (min/max), error state, time-only display, datetime display, popover open/closed (web), modal picker open/closed (mobile).
- **Size variants:** Single default control height (web ~48px using existing input sizing; mobile 48px trigger). No additional sizes; extend via className/style in future.
- **Color tokens:** Primary (#0D7C7A / #15B5B0), border slate neutrals, error #EF4444/#DC2626, background #FFFFFF/#0F172A per theme. Use muted text for placeholder (#64748B), focus ring primary/30 on web.
- **Accessibility:** Web trigger role button/combobox semantics with `aria-expanded`, `aria-haspopup="dialog"`, `aria-invalid`, `aria-describedby` (error/helper), keyboard focusable; `data-slot="date-picker"`. Mobile: accessibilityRole `combobox`, `accessibilityLabel` from label, `accessibilityState` {expanded, disabled}, testIDs for trigger/modal, announce errors via `accessibilityRole="alert"` where applicable.
- **Dependencies:** Add to `klard-web`: `@radix-ui/react-popover`, `react-day-picker`, `date-fns` (and shadcn calendar/popover components). Mobile uses existing `@expo/ui` (SwiftUI/Compose DateTimePicker), `@react-native-community/datetimepicker`, `expo-haptics`.
- **SOLID Compliance:**

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Web DatePicker | Renders date/time input with popover calendar | Styles/config extend via props/className; min/max/date/time handled via props | Accepts any Date/null without stricter preconditions | Props only for display/selection; no unused methods | Depends on abstractions (props callbacks, shadcn primitives) not concrete data sources |
| Mobile DatePicker | Manages native pickers + trigger rendering | Picker modes extensible via props; styles via style props | Accepts shared props without narrowing | Props focused on selection UI; no extra controls | Uses injected props/haptics; depends on platform APIs via interfaces |

- **Parallel sub-agent strategy:** Execute tasks sequentially in this session (Task tool unavailable in Codex), but treat test-writing and implementation for web and mobile as separable batches with checkpoints between RED/GREEN runs.
- **Test strategy (write first):**
  - Web: render with placeholder/label, selected date formatting, min/max disabling, error aria-invalid and message, popover toggle presence, onChange invoked on day click, keyboard focusability.
  - Mobile: render trigger with placeholder/label, opens picker modal, onChange called on selection, haptic feedback invoked, respects min/max by blocking selection, error text shown with accessibilityRole alert.

---

### Task 1: Web tests for DatePicker (RED)

**Files:**
- Create: `klard-web/src/__tests__/components/ui/date-picker.test.tsx`

**Step 1: Write the failing test**  
Include cases: renders placeholder/label; formats selected date with `PPP`; marks error text + aria-invalid; applies min/max disabled (day button disabled attribute or class); opens popover on click; calls onChange with selected date; uses `aria-haspopup="dialog"` and `data-slot="date-picker"`; preserves placeholder text color class. Mock `ResizeObserver`/pointer capture as in select tests.

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/date-picker.test.tsx --run`  
Expected: FAIL (component not implemented/missing).

### Task 2: Web DatePicker implementation (GREEN)

**Files:**
- Create: `klard-web/src/components/ui/date-picker.tsx`
- Create: `klard-web/src/components/ui/calendar.tsx` (shadcn calendar wrapper)
- Create: `klard-web/src/components/ui/popover.tsx` (shadcn popover wrapper)
- Modify: `klard-web/src/components/ui/index.ts`

**Step 3: Write minimal implementation**  
Client component using `Popover` + `Calendar` + `Button`, `CalendarIcon`, `format` from `date-fns`; enforce min/max via `disabled` prop; show placeholder text; apply error/disabled styles; wire `aria-*`, `data-slot="date-picker"`, and `onChange` passthrough; support `mode` by displaying time/datetime (time portion via `format(value, mode === 'time' ? 'p' : 'PPP p')`); handle null selection; ensure classNames use design tokens and hover/focus states.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/date-picker.test.tsx --run`  
Expected: PASS.

### Task 3: Mobile tests for DatePicker (RED)

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/DatePicker.test.tsx`

**Step 1: Write the failing test**  
Cases: renders trigger with placeholder/label; opens picker modal (SwiftUI Host or fallback) on press; calls onChange with Date; invokes `expo-haptics` impact on selection; respects min/max by preventing earlier selection; shows error text with accessibilityRole alert; accessibilityRole combobox + label; close picker after selection.

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/DatePicker.test.tsx --run`  
Expected: FAIL (component not implemented/missing).

### Task 4: Mobile DatePicker implementation (GREEN)

**Files:**
- Create: `klard-mobile/src/components/ui/DatePicker.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 3: Write minimal implementation**  
Use `FormField` wrapper; trigger Pressable with placeholder/selected text; manage `showPicker` state; choose platform-specific picker (`SwiftUIDateTimePicker` inside `Host` for iOS, `JetpackDateTimePicker` for Android) with `displayedComponents` based on mode; fallback to `@react-native-community/datetimepicker` if platform components unavailable; apply min/max bounds to picker props; on selection convert string to Date, call onChange, close picker, fire haptic feedback; style trigger per design tokens; expose testIDs (`date-picker-trigger`, `date-picker-modal`).

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/DatePicker.test.tsx --run`  
Expected: PASS.

### Task 5: Type checks and exports

**Files:**
- Confirm: `klard-web/src/components/ui/index.ts` export `DatePicker`, `Calendar`, `Popover` as needed.
- Confirm: `klard-mobile/src/components/ui/index.ts` export `DatePicker`.

**Step 1: Run type checks**  
Run: `pnpm --filter klard-web exec tsc --noEmit`  
Run: `pnpm --filter klard-mobile exec tsc --noEmit`

**Step 2: Verify tests**  
Run: `pnpm --filter klard-web test --run`  
Run: `pnpm --filter klard-mobile test --run`

**Step 3: Mark spec DONE**  
Update `docs/screens/batch/Klard_Component_Specifications.md` replacing `IN-PROGRESS:2.3-date-picker` with `DONE:2.3-date-picker`.

**Step 5: Commit (after user approval)**  
`git add` relevant files; commit message suggestion: `feat(web): add date picker component` plus mobile scope if included.
