# StatCard Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a production-ready StatCard component for displaying key metrics with label, value, optional trend indicators, and icon support across web and mobile platforms.

**Architecture:** Card-based metric display using CVA for web variant management and StyleSheet for mobile. Follows existing Badge/Card patterns with Klard design system colors. Clickable variant supported via Pressable wrapper.

**Tech Stack:**
- Web: React, TypeScript, Tailwind CSS, CVA, Lucide icons
- Mobile: React Native, Expo SDK 54, expo-haptics, @expo/vector-icons

---

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| StatCard (Web) | Displays single metric | Extensible via props | Handles all value types | Minimal focused interface | Depends on cn utility abstraction |
| StatCard (Mobile) | Displays single metric | Extensible via props/styles | Handles all value types | Minimal focused interface | Depends on Haptics abstraction |

### Principle Applications

**SRP:** StatCard has single responsibility - display a metric with optional trend
**OCP:** Trend colors/icons configurable via props, no modification needed
**LSP:** All prop combinations produce valid output
**ISP:** Props interface focused: label, value, trend, icon, onClick
**DIP:** Depends on abstractions (cn utility, Haptics module)

---

## Props Interface

```typescript
// Shared interface for both platforms
export interface StatCardProps {
  /** Label describing the metric */
  label: string;
  /** The metric value to display */
  value: string | number;
  /** Optional trend indicator */
  trend?: {
    direction: 'up' | 'down' | 'neutral';
    value: string;
  };
  /** Optional icon to display */
  icon?: React.ReactNode;
  /** Click handler - makes card interactive */
  onClick?: () => void;
}
```

---

## Task 1: Web - Create failing tests

**Files:**
- Create: `klard-web/src/__tests__/components/ui/stat-card.test.tsx`

**Step 1: Write the failing test**

```tsx
/**
 * Tests for StatCard Component
 *
 * TDD: Write failing tests first, then implement to pass.
 * Tests verify: rendering, trend variants, icon support, click handling, accessibility
 */

import { describe, it, expect, vi } from "vitest"
import { render, screen, fireEvent } from "@testing-library/react"
import { StatCard } from "@/components/ui/stat-card"

describe("StatCard", () => {
  describe("Rendering", () => {
    it("should render label and value", () => {
      render(<StatCard label="Total Savings" value="$1,234" />)

      expect(screen.getByText("Total Savings")).toBeInTheDocument()
      expect(screen.getByText("$1,234")).toBeInTheDocument()
    })

    it("should have data-slot attribute", () => {
      render(<StatCard label="Metrics" value={100} />)

      const card = screen.getByText("Metrics").closest('[data-slot="stat-card"]')
      expect(card).toBeInTheDocument()
    })

    it("should render numeric value", () => {
      render(<StatCard label="Count" value={42} />)

      expect(screen.getByText("42")).toBeInTheDocument()
    })
  })

  describe("Trend Indicator", () => {
    it("should render up trend with green color", () => {
      render(
        <StatCard
          label="Growth"
          value="$500"
          trend={{ direction: "up", value: "+12%" }}
        />
      )

      const trendElement = screen.getByText("+12%")
      expect(trendElement).toBeInTheDocument()
      expect(trendElement.closest('[data-trend]')).toHaveAttribute('data-trend', 'up')
    })

    it("should render down trend with red color", () => {
      render(
        <StatCard
          label="Decline"
          value="$200"
          trend={{ direction: "down", value: "-8%" }}
        />
      )

      const trendElement = screen.getByText("-8%")
      expect(trendElement).toBeInTheDocument()
      expect(trendElement.closest('[data-trend]')).toHaveAttribute('data-trend', 'down')
    })

    it("should render neutral trend with slate color", () => {
      render(
        <StatCard
          label="Stable"
          value="$100"
          trend={{ direction: "neutral", value: "0%" }}
        />
      )

      const trendElement = screen.getByText("0%")
      expect(trendElement).toBeInTheDocument()
      expect(trendElement.closest('[data-trend]')).toHaveAttribute('data-trend', 'neutral')
    })

    it("should not render trend when not provided", () => {
      render(<StatCard label="No Trend" value="$50" />)

      expect(screen.queryByTestId("trend-indicator")).not.toBeInTheDocument()
    })
  })

  describe("Icon Support", () => {
    it("should render icon when provided", () => {
      const icon = <span data-testid="test-icon">ðŸ’°</span>
      render(<StatCard label="Savings" value="$100" icon={icon} />)

      expect(screen.getByTestId("test-icon")).toBeInTheDocument()
    })

    it("should not render icon container when icon not provided", () => {
      render(<StatCard label="No Icon" value="$100" />)

      expect(screen.queryByTestId("stat-card-icon")).not.toBeInTheDocument()
    })
  })

  describe("Click Handling", () => {
    it("should call onClick when clicked", () => {
      const handleClick = vi.fn()
      render(<StatCard label="Clickable" value="$100" onClick={handleClick} />)

      fireEvent.click(screen.getByText("Clickable").closest('[data-slot="stat-card"]')!)

      expect(handleClick).toHaveBeenCalledTimes(1)
    })

    it("should render as button when onClick provided", () => {
      const handleClick = vi.fn()
      render(<StatCard label="Button" value="100" onClick={handleClick} />)

      const card = screen.getByText("Button").closest('[data-slot="stat-card"]')
      expect(card?.tagName).toBe("BUTTON")
    })

    it("should render as div when onClick not provided", () => {
      render(<StatCard label="Static" value="100" />)

      const card = screen.getByText("Static").closest('[data-slot="stat-card"]')
      expect(card?.tagName).toBe("DIV")
    })

    it("should have interactive styles when clickable", () => {
      const handleClick = vi.fn()
      render(<StatCard label="Interactive" value="100" onClick={handleClick} />)

      const card = screen.getByText("Interactive").closest('[data-slot="stat-card"]')
      expect(card?.className).toMatch(/cursor-pointer|hover/)
    })
  })

  describe("Accessibility", () => {
    it("should have accessible role for clickable card", () => {
      const handleClick = vi.fn()
      render(<StatCard label="Accessible" value="100" onClick={handleClick} />)

      expect(screen.getByRole("button")).toBeInTheDocument()
    })
  })

  describe("Custom className", () => {
    it("should merge custom className", () => {
      render(<StatCard label="Custom" value="100" className="custom-class" />)

      const card = screen.getByText("Custom").closest('[data-slot="stat-card"]')
      expect(card?.className).toContain("custom-class")
    })
  })
})
```

**Step 2: Run test to verify it fails**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/stat-card.test.tsx --run
```

Expected: FAIL with "Cannot find module '@/components/ui/stat-card'"

---

## Task 2: Web - Implement StatCard component

**Files:**
- Create: `klard-web/src/components/ui/stat-card.tsx`
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Write implementation**

```tsx
"use client"

import * as React from "react"
import { TrendingUp, TrendingDown, Minus } from "lucide-react"

import { cn } from "@/lib/utils"

export interface StatCardProps extends React.HTMLAttributes<HTMLElement> {
  /** Label describing the metric */
  label: string
  /** The metric value to display */
  value: string | number
  /** Optional trend indicator */
  trend?: {
    direction: "up" | "down" | "neutral"
    value: string
  }
  /** Optional icon to display */
  icon?: React.ReactNode
  /** Click handler - makes card interactive */
  onClick?: () => void
}

const trendConfig = {
  up: {
    icon: TrendingUp,
    className: "text-green-600 dark:text-green-400",
  },
  down: {
    icon: TrendingDown,
    className: "text-red-600 dark:text-red-400",
  },
  neutral: {
    icon: Minus,
    className: "text-slate-500 dark:text-slate-400",
  },
} as const

function StatCard({
  label,
  value,
  trend,
  icon,
  onClick,
  className,
  ...props
}: StatCardProps) {
  const isClickable = !!onClick
  const Component = isClickable ? "button" : "div"

  return (
    <Component
      data-slot="stat-card"
      onClick={onClick}
      className={cn(
        "bg-card text-card-foreground flex items-center justify-between gap-4 rounded-xl border p-4 shadow-sm",
        isClickable && "cursor-pointer transition-all hover:border-teal-500 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2",
        className
      )}
      {...props}
    >
      <div className="flex flex-col gap-1">
        <span className="text-sm text-muted-foreground">{label}</span>
        <span className="text-2xl font-semibold tracking-tight">{value}</span>
        {trend && (
          <div
            data-trend={trend.direction}
            data-testid="trend-indicator"
            className={cn(
              "flex items-center gap-1 text-sm",
              trendConfig[trend.direction].className
            )}
          >
            {React.createElement(trendConfig[trend.direction].icon, {
              className: "h-4 w-4",
              "aria-hidden": true,
            })}
            <span>{trend.value}</span>
          </div>
        )}
      </div>
      {icon && (
        <div
          data-testid="stat-card-icon"
          className="flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-teal-100 text-teal-700 dark:bg-teal-900/50 dark:text-teal-300"
        >
          {icon}
        </div>
      )}
    </Component>
  )
}

export { StatCard }
```

**Step 2: Add export to index.ts**

Add to `klard-web/src/components/ui/index.ts`:

```typescript
export { StatCard, type StatCardProps } from './stat-card';
```

**Step 3: Run tests to verify they pass**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/stat-card.test.tsx --run
```

Expected: PASS

**Step 4: Run TypeScript check**

```bash
pnpm --filter klard-web exec tsc --noEmit
```

Expected: No errors

**Step 5: Commit**

```bash
git add klard-web/src/components/ui/stat-card.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/stat-card.test.tsx
git commit -m "feat(web): add StatCard component for metric display"
```

---

## Task 3: Mobile - Create failing tests

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/StatCard.test.tsx`

**Step 1: Write the failing test**

```tsx
/**
 * Tests for StatCard Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */

import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react-native';
import { Text } from 'react-native';
import { StatCard } from '@/components/ui/StatCard';
import * as Haptics from 'expo-haptics';

// Mock expo-haptics
jest.mock('expo-haptics', () => ({
  impactAsync: jest.fn(),
  ImpactFeedbackStyle: {
    Light: 'light',
    Medium: 'medium',
    Heavy: 'heavy',
  },
}));

// Mock vector icons
jest.mock('@expo/vector-icons', () => {
  const React = require('react');
  const { Text } = require('react-native');
  return {
    Ionicons: ({ name }: { name: string }) => (
      <Text testID="vector-icon">{name}</Text>
    ),
  };
});

describe('StatCard', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('Rendering', () => {
    it('should render label and value', () => {
      render(<StatCard label="Total Savings" value="$1,234" />);

      expect(screen.getByText('Total Savings')).toBeTruthy();
      expect(screen.getByText('$1,234')).toBeTruthy();
    });

    it('should render numeric value', () => {
      render(<StatCard label="Count" value={42} />);

      expect(screen.getByText('42')).toBeTruthy();
    });

    it('should have correct accessibility role', () => {
      render(<StatCard label="Metrics" value={100} testID="stat-card" />);

      expect(screen.getByTestId('stat-card')).toBeTruthy();
    });
  });

  describe('Trend Indicator', () => {
    it('should render up trend', () => {
      render(
        <StatCard
          label="Growth"
          value="$500"
          trend={{ direction: 'up', value: '+12%' }}
        />
      );

      expect(screen.getByText('+12%')).toBeTruthy();
      expect(screen.getByTestId('vector-icon')).toBeTruthy();
    });

    it('should render down trend', () => {
      render(
        <StatCard
          label="Decline"
          value="$200"
          trend={{ direction: 'down', value: '-8%' }}
        />
      );

      expect(screen.getByText('-8%')).toBeTruthy();
    });

    it('should render neutral trend', () => {
      render(
        <StatCard
          label="Stable"
          value="$100"
          trend={{ direction: 'neutral', value: '0%' }}
        />
      );

      expect(screen.getByText('0%')).toBeTruthy();
    });

    it('should not render trend when not provided', () => {
      render(<StatCard label="No Trend" value="$50" />);

      expect(screen.queryByTestId('trend-container')).toBeNull();
    });
  });

  describe('Icon Support', () => {
    it('should render icon when provided', () => {
      const icon = <Text testID="custom-icon">ðŸ’°</Text>;
      render(<StatCard label="Savings" value="$100" icon={icon} />);

      expect(screen.getByTestId('custom-icon')).toBeTruthy();
    });

    it('should not render icon container when icon not provided', () => {
      render(<StatCard label="No Icon" value="$100" testID="card" />);

      expect(screen.queryByTestId('icon-container')).toBeNull();
    });
  });

  describe('Click Handling', () => {
    it('should call onClick when pressed', async () => {
      const handleClick = jest.fn();
      render(
        <StatCard
          label="Clickable"
          value="$100"
          onClick={handleClick}
          testID="stat-card"
        />
      );

      fireEvent.press(screen.getByTestId('stat-card'));

      await waitFor(() => {
        expect(handleClick).toHaveBeenCalledTimes(1);
      });
    });

    it('should trigger haptic feedback when pressed', async () => {
      const handleClick = jest.fn();
      render(
        <StatCard
          label="Haptic"
          value="$100"
          onClick={handleClick}
          testID="stat-card"
        />
      );

      fireEvent.press(screen.getByTestId('stat-card'));

      await waitFor(() => {
        expect(Haptics.impactAsync).toHaveBeenCalledWith(
          Haptics.ImpactFeedbackStyle.Light
        );
      });
    });

    it('should not trigger haptic when not clickable', () => {
      render(<StatCard label="Static" value="$100" testID="stat-card" />);

      // Static card should not respond to press
      expect(screen.getByTestId('stat-card')).toBeTruthy();
    });
  });
});
```

**Step 2: Run test to verify it fails**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/StatCard.test.tsx --run
```

Expected: FAIL with "Cannot find module '@/components/ui/StatCard'"

---

## Task 4: Mobile - Implement StatCard component

**Files:**
- Create: `klard-mobile/src/components/ui/StatCard.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Write implementation**

```tsx
import React from 'react';
import {
  View,
  Text,
  Pressable,
  StyleSheet,
  type ViewStyle,
  type StyleProp,
} from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import * as Haptics from 'expo-haptics';

export interface StatCardProps {
  /** Label describing the metric */
  label: string;
  /** The metric value to display */
  value: string | number;
  /** Optional trend indicator */
  trend?: {
    direction: 'up' | 'down' | 'neutral';
    value: string;
  };
  /** Optional icon to display */
  icon?: React.ReactNode;
  /** Click handler - makes card interactive */
  onClick?: () => void;
  /** Custom styles */
  style?: StyleProp<ViewStyle>;
  /** Test ID for testing */
  testID?: string;
}

const trendConfig = {
  up: {
    iconName: 'trending-up' as const,
    color: '#059669', // green-600
  },
  down: {
    iconName: 'trending-down' as const,
    color: '#DC2626', // red-600
  },
  neutral: {
    iconName: 'remove' as const,
    color: '#64748B', // slate-500
  },
} as const;

export function StatCard({
  label,
  value,
  trend,
  icon,
  onClick,
  style,
  testID,
}: StatCardProps) {
  const isClickable = !!onClick;

  const handlePress = async () => {
    if (onClick) {
      await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
      onClick();
    }
  };

  const Container = isClickable ? Pressable : View;
  const containerProps = isClickable
    ? {
        onPress: handlePress,
        style: ({ pressed }: { pressed: boolean }) => [
          styles.container,
          pressed && styles.pressed,
          style,
        ],
      }
    : {
        style: [styles.container, style],
      };

  return (
    <Container testID={testID} accessibilityRole={isClickable ? 'button' : undefined} {...containerProps}>
      <View style={styles.content}>
        <Text style={styles.label}>{label}</Text>
        <Text style={styles.value}>{value}</Text>
        {trend && (
          <View style={styles.trendContainer} testID="trend-container">
            <Ionicons
              name={trendConfig[trend.direction].iconName}
              size={14}
              color={trendConfig[trend.direction].color}
            />
            <Text
              style={[
                styles.trendValue,
                { color: trendConfig[trend.direction].color },
              ]}
            >
              {trend.value}
            </Text>
          </View>
        )}
      </View>
      {icon && (
        <View style={styles.iconContainer} testID="icon-container">
          {icon}
        </View>
      )}
    </Container>
  );
}

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    gap: 16,
    padding: 16,
    backgroundColor: '#FFFFFF',
    borderRadius: 12,
    borderWidth: 1,
    borderColor: '#E2E8F0', // slate-200
    shadowColor: '#0F172A',
    shadowOffset: { width: 0, height: 1 },
    shadowOpacity: 0.05,
    shadowRadius: 2,
    elevation: 1,
  },
  pressed: {
    borderColor: '#0D7C7A', // primary
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 2,
  },
  content: {
    flex: 1,
    gap: 4,
  },
  label: {
    fontSize: 14,
    color: '#64748B', // slate-500
    fontWeight: '400',
  },
  value: {
    fontSize: 24,
    color: '#0F172A', // slate-900
    fontWeight: '600',
    letterSpacing: -0.5,
  },
  trendContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 4,
    marginTop: 4,
  },
  trendValue: {
    fontSize: 14,
    fontWeight: '500',
  },
  iconContainer: {
    width: 48,
    height: 48,
    borderRadius: 24,
    backgroundColor: '#CCFBF1', // teal-100
    alignItems: 'center',
    justifyContent: 'center',
  },
});
```

**Step 2: Add export to index.ts**

Add to `klard-mobile/src/components/ui/index.ts`:

```typescript
export { StatCard, type StatCardProps } from './StatCard';
```

**Step 3: Run tests to verify they pass**

```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/StatCard.test.tsx --run
```

Expected: PASS

**Step 4: Run TypeScript check**

```bash
pnpm --filter klard-mobile exec tsc --noEmit
```

Expected: No errors

**Step 5: Commit**

```bash
git add klard-mobile/src/components/ui/StatCard.tsx klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/StatCard.test.tsx
git commit -m "feat(mobile): add StatCard component for metric display"
```

---

## Task 5: Final verification and spec update

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Run all tests**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/stat-card.test.tsx --run
pnpm --filter klard-mobile test src/__tests__/components/ui/StatCard.test.tsx --run
```

Expected: All PASS

**Step 2: Run TypeScript checks**

```bash
pnpm --filter klard-web exec tsc --noEmit
pnpm --filter klard-mobile exec tsc --noEmit
```

Expected: No errors

**Step 3: Update spec marker to DONE**

Replace `<!-- IN-PROGRESS:5.7-stat-card -->` with `<!-- DONE:5.7-stat-card -->` in:
`docs/screens/batch/Klard_Component_Specifications.md`

**Step 4: Final commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark StatCard component as DONE"
```

---

## Verification Checklist

Before marking complete:

- [ ] Web component renders without errors
- [ ] Mobile component renders without errors
- [ ] All props implemented + typed (label, value, trend, icon, onClick)
- [ ] All visual states functional (default, clickable/pressed, trends)
- [ ] Trend indicators show correct colors (green up, red down, slate neutral)
- [ ] Accessibility attributes included (role="button" when clickable)
- [ ] TypeScript passes with no errors
- [ ] All tests passing for both web and mobile
- [ ] Haptic feedback on mobile press
- [ ] Exported from components/ui/index.ts on both platforms
- [ ] Spec marker updated to DONE

---

## Summary

| Task | Platform | Type | Files |
|------|----------|------|-------|
| 1 | Web | Test | stat-card.test.tsx |
| 2 | Web | Implementation | stat-card.tsx, index.ts |
| 3 | Mobile | Test | StatCard.test.tsx |
| 4 | Mobile | Implementation | StatCard.tsx, index.ts |
| 5 | Both | Verification | Klard_Component_Specifications.md |

**Total estimated tasks:** 5 bite-sized tasks
**TDD approach:** RED â†’ GREEN â†’ REFACTOR for each platform