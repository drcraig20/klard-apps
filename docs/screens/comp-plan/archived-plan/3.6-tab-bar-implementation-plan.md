# 3.6 TabBar Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a reusable mobile TabBar for bottom navigation with icon/label support, optional badges, center action tab styling, safe-area padding, and active/inactive states consistent with the Klard design system.

**Architecture:** Implement a controlled `TabBar` component (mobile only) that renders tabs from a data array. Use `Pressable` for each tab with hit slop and active tint. Apply safe-area padding at the bottom via `useSafeAreaInsets` and `View` container. Support an optional “center” tab with elevated/glowing styling. Keep logic presentation-only; navigation handled by parent via `onTabPress`. Styling via `StyleSheet` to match Klard tokens (primary teal, muted text, glassy background). Badges rendered as small pills.

**Tech Stack:** React Native + Expo 54, TypeScript, `react-native-safe-area-context`, `react-native` primitives (`View`, `Pressable`, `Text`), jest-expo + React Native Testing Library for tests.

---

## Component Details
- **Component:** `TabBar` (mobile only)
- **Props:**
  ```ts
  interface TabConfig {
    name: string;
    icon: React.ReactNode;
    badge?: number;
    isCenter?: boolean;
  }

  interface TabBarProps {
    tabs: TabConfig[];
    activeTab: string;
    onTabPress: (name: string) => void;
  }
  ```
- **Behavior/States:**
  - Active tab: primary color for icon/text, top indicator/glow.
  - Inactive tab: muted color.
  - Badge shows positive integers; hides when undefined/zero.
  - Center tab (if `isCenter`) renders larger pill with shadow/glow and lifted position.
  - Safe-area padding applied on container bottom.
  - Minimum touch target 44px, hitSlop added.
- **Visual Tokens:**
  - Background: card/surface (`#FFFFFF` light) with border top `#CBD5E1`.
  - Active color: `#0D7C7A` (light) / `#15B5B0` (dark) → use theme hook if available; fallback constants.
  - Inactive text: `#94A3B8`.
  - Badge: background `#EF4444`, text `#FFFFFF`, radius 10.
  - Center tab shadow/glow: shadowColor teal with opacity 0.25, elevation for Android.
- **Accessibility:** `accessibilityRole="tab"` for items; `accessibilityState={{ selected: true }}` for active; `accessibilityLabel` derived from label; badge announced by including count in label (e.g., “Alerts, 2 new”).
- **Dependencies:** `react-native-safe-area-context` (already present). No new dependencies.

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| TabBar | Render tab navigation and handle presses | Extendable via tabs data (badges, center) without code changes | Works for any tab configs; selection contract holds | Props limited to tab concerns; no extra burden | Depends on RN primitives and injected callbacks |

## Parallel Sub-Agent Strategy
- Single package (klard-mobile). Steps are sequential: tests → implementation → export → spec update.

## Test Strategy (TDD)
- jest-expo + React Native Testing Library.
- Tests:
  1) Renders all tabs and icons/labels.
  2) Active tab exposes `accessibilityState.selected=true` and active styling (class/style check).
  3) Badge renders when provided and hides when undefined/0.
  4) `onTabPress` called with tab name on press.
  5) Center tab uses distinct style (elevated) when `isCenter=true`.
  6) Container includes safe-area padding (style check includes inset addition).

---

## Tasks (2–5 minutes each)

### Task 1: Write failing tests for TabBar
**Files:** Create `klard-mobile/src/__tests__/components/ui/TabBar.test.tsx`

**Step 1: Test code**
```tsx
import React from 'react';
import { render, fireEvent } from '@testing-library/react-native';
import { TabBar } from '@/components/ui';
import { jest } from '@jest/globals';

const tabs = [
  { name: 'home', icon: <></> },
  { name: 'subscriptions', icon: <></>, badge: 3 },
  { name: 'settings', icon: <></>, isCenter: true },
];

describe('TabBar', () => {
  it('renders tabs, icons, and badges', () => {
    const { getByText } = render(
      <TabBar tabs={tabs} activeTab="home" onTabPress={() => {}} />
    );
    expect(getByText('home')).toBeTruthy();
    expect(getByText('subscriptions')).toBeTruthy();
    expect(getByText('3')).toBeTruthy();
  });

  it('marks active tab with accessibility state', () => {
    const { getByA11yState } = render(
      <TabBar tabs={tabs} activeTab="subscriptions" onTabPress={() => {}} />
    );
    expect(getByA11yState({ selected: true })).toBeTruthy();
  });

  it('calls onTabPress with tab name', () => {
    const onTabPress = jest.fn();
    const { getByText } = render(
      <TabBar tabs={tabs} activeTab="home" onTabPress={onTabPress} />
    );
    fireEvent.press(getByText('subscriptions'));
    expect(onTabPress).toHaveBeenCalledWith('subscriptions');
  });

  it('applies center tab style when isCenter is true', () => {
    const { getByText } = render(
      <TabBar tabs={tabs} activeTab="settings" onTabPress={() => {}} />
    );
    const center = getByText('settings');
    const style = Array.isArray(center.parent?.props.style)
      ? center.parent.props.style.flat()
      : [center.parent?.props.style];
    expect(style).toEqual(expect.arrayContaining([expect.objectContaining({ elevation: expect.any(Number) })]));
  });
});
```

**Step 2:** Run to confirm failure  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`  
Expected: FAIL (component absent/behaviors missing).

### Task 2: Implement TabBar component
**Files:** Create `klard-mobile/src/components/ui/TabBar.tsx`

**Implementation outline:**
- Imports: React, `View`, `Pressable`, `Text`, `StyleSheet`; `useSafeAreaInsets`.
- Props per interface; export types.
- Theme colors: use existing hook if available (`useThemeColors`), else fallback constants for primary/inactive/bg/border/badge.
- Compute bottom padding: `paddingBottom = insets.bottom + 8`.
- Map tabs: each Pressable with `accessibilityRole="tab"`, `accessibilityState={{ selected: isActive }}`, `accessibilityLabel` derived from label + badge info. Add `hitSlop={10}`.
- Styles:
  - Container: row, borderTopColor, backgroundColor, paddingVertical 8, horizontal padding 12, gap between tabs, safe area bottom.
  - Tab: flex: isCenter ? 0 : 1; align center; paddingVertical 6; borderRadius 12.
  - Active: color primary, maybe top indicator via extra View.
  - Badge: absolute top/right small pill.
  - Center: raise via translateY: -8, shadow (shadowColor teal, shadowOpacity 0.25, shadowRadius 8, elevation 4), background card, padding 10.
- Render label text for testing; icon rendered above label.

**Step 3:** Run tests to green  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`  
Expected: PASS.

### Task 3: Export & finalize
**Files:** Modify `klard-mobile/src/components/ui/index.ts`

**Step 1:** Add `export { TabBar, type TabBarProps, type TabConfig } from './TabBar';`  
**Step 2:** Optional regression: `pnpm --filter klard-mobile test --run`  
**Step 3:** Update spec marker to `<!-- DONE:3.6-tab-bar -->` after verification.

