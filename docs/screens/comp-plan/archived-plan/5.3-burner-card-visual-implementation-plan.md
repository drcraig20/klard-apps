# BurnerCardVisual Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a cross-platform BurnerCardVisual that displays a burner card with gradient background, badge for type, masked PAN, expiry, and spend progress with status-driven colors.

**Architecture:** Presentational components per platform with no data fetching; gradients keyed off status; size tokens drive spacing/typography; shared formatting helpers for spend progress and expiry. Web uses Tailwind/shadcn primitives with CSS gradients; mobile uses `expo-linear-gradient` plus RN primitives.

**Tech Stack:** Next.js App Router (React 19), Tailwind/shadcn/ui, class-variance-authority patterns, Vitest + RTL; Expo SDK 54, `expo-linear-gradient`, React Native Testing Library + Jest.

---

- **Component & Purpose:** `BurnerCardVisual` renders a stylized burner card for dashboards/onboarding, showing brand, type badge, masked last four, expiry, nickname, and spend progress.
- **Target Platforms:** Web (`klard-web`) and Mobile (`klard-mobile`) with parity; web first.
- **Props (shared intent, platform types vary):**
  - `nickname: string`
  - `type: 'single-use' | 'recurring'`
  - `status: 'active' | 'locked' | 'expired' | 'used'`
  - `lastFour: string`
  - `expiryMonth: string`
  - `expiryYear: string`
  - `spentAmount: number`
  - `spendLimit: number`
  - `size?: 'sm' | 'md' | 'lg'` (default `md`)
  - `className?/style?` overrides
- **Visual States:** Status gradients (active teal, locked amber, expired slate, used navy-muted); progress fill reflects spend ratio with capped 100%; disabled-ish tone for expired/used; size adjusts padding/radius/typography; optional low-opacity glow; focus outline on web for accessibility.
- **Size Variants:** `sm` (height ~160px, text-sm, padding 12px); `md` (default, height ~190px, text-base, padding 16px); `lg` (height ~220px, text-lg, padding 20px).
- **Color Tokens:** From design system (dark): primary #15B5B0/#0D7C7A, warning #F59E0B, error-ish lock #B45309, neutral #475569/#1E293B, text #F8FAFC. Progress track muted (#1E293B) with fill aligned to status color.
- **Accessibility:** Web `role="group"` with `aria-label` summarizing card; data-slot on root, badge, number, progress; focus ring for keyboard. Mobile `accessibilityRole="image"` and label summarizing card; ensures text + color for status (badge text).
- **Dependencies:** Web → `Card` (shadcn), `Badge`, `cn`; Mobile → `expo-linear-gradient`, `useThemeColors`; no external images.
- **SOLID Compliance**

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Web BurnerCardVisual | Renders burner card view only | Gradients/sizes/status via maps/props | Accepts props without stricter preconditions; handles zero spendLimit | Props only; no unused methods | Depends on props + utilities, not stores |
| Mobile BurnerCardVisual | Renders burner card view only | Style maps for status/size | Same contract as web props | Focused prop interface | Depends on theme hook + props, not global state |
| Formatting helpers | Format progress/expiry strings | Config-driven labels | Accepts strings/numbers | Minimal functions | Uses Intl/JS, no globals |

- **Parallel Sub-Agent Strategy:** Execute sequentially in-session (Task tool unavailable) but treat each task as isolated TDD loop with self-review; no concurrent edits on same files.
- **Test Strategy (TDD):** Write failing unit tests first for render, status gradients mapping, progress cap, size classes, accessibility labels. Web: Vitest + RTL. Mobile: Jest + @testing-library/react-native with `expo-linear-gradient` mock.

---

### Task 1: BurnerCardVisual (Web) - tests

**Files:**
- Create: `klard-web/src/__tests__/components/ui/burner-card-visual.test.tsx`

**Step 1: Write the failing test**

```tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { BurnerCardVisual, type BurnerCardVisualProps } from '@/components/ui/burner-card-visual';

const base: BurnerCardVisualProps = {
  nickname: 'Promo Trials',
  type: 'recurring',
  status: 'active',
  lastFour: '1234',
  expiryMonth: '08',
  expiryYear: '27',
  spentAmount: 25,
  spendLimit: 100,
};

describe('BurnerCardVisual (web)', () => {
  it('renders nickname, masked number, and expiry', () => {
    render(<BurnerCardVisual {...base} />);

    expect(screen.getByText('Promo Trials')).toBeInTheDocument();
    expect(screen.getByText(/•••• •••• •••• 1234/)).toBeInTheDocument();
    expect(screen.getByText('08/27')).toBeInTheDocument();
  });

  it('shows spend progress capped at 100%', () => {
    const { container } = render(<BurnerCardVisual {...base} spentAmount={150} spendLimit={100} />);
    const progress = container.querySelector('[data-slot="burner-progress-fill"]') as HTMLElement;
    expect(progress.style.width).toBe('100%');
  });

  it('applies status gradient for locked', () => {
    const { container } = render(<BurnerCardVisual {...base} status="locked" />);
    const root = container.querySelector('[data-slot="burner-card"]') as HTMLElement;
    expect(root.style.backgroundImage).toMatch(/linear-gradient/);
  });

  it('renders size variant classes', () => {
    const { container } = render(<BurnerCardVisual {...base} size="sm" />);
    const root = container.querySelector('[data-slot="burner-card"]') as HTMLElement;
    expect(root.className).toMatch(/h-40/);
  });

  it('sets aria-label for accessibility', () => {
    render(<BurnerCardVisual {...base} />);
    expect(screen.getByRole('group')).toHaveAttribute('aria-label', expect.stringContaining('Promo Trials'));
  });
});
```

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/burner-card-visual.test.tsx --run`  
Expected: FAIL (component missing).

---

### Task 2: BurnerCardVisual (Web) - implement

**Files:**
- Create: `klard-web/src/components/ui/burner-card-visual.tsx`
- Modify: `klard-web/src/components/ui/index.ts`

**Step 3: Write minimal implementation**

```tsx
import * as React from "react";
import { Badge } from "./badge";
import { Card } from "./card";
import { cn } from "@/lib/utils";

export type BurnerCardStatus = "active" | "locked" | "expired" | "used";
export type BurnerCardType = "single-use" | "recurring";
export type BurnerCardSize = "sm" | "md" | "lg";

export interface BurnerCardVisualProps extends React.ComponentProps<"div"> {
  nickname: string;
  type: BurnerCardType;
  status: BurnerCardStatus;
  lastFour: string;
  expiryMonth: string;
  expiryYear: string;
  spentAmount: number;
  spendLimit: number;
  size?: BurnerCardSize;
}

const statusGradients: Record<BurnerCardStatus, string[]> = {
  active: ["#15B5B0", "#0D7C7A"],
  locked: ["#F59E0B", "#B45309"],
  expired: ["#64748B", "#475569"],
  used: ["#475569", "#334155"],
};

const sizeMap: Record<BurnerCardSize, { height: string; padding: string; title: string; number: string }> = {
  sm: { height: "h-40", padding: "p-3", title: "text-sm", number: "text-base" },
  md: { height: "h-48", padding: "p-4", title: "text-base", number: "text-lg" },
  lg: { height: "h-56", padding: "p-5", title: "text-lg", number: "text-xl" },
};

function formatProgress(spent: number, limit: number) {
  if (limit <= 0) return "0%";
  return `${Math.min(100, Math.round((spent / limit) * 100))}%`;
}

export function BurnerCardVisual({
  nickname,
  type,
  status,
  lastFour,
  expiryMonth,
  expiryYear,
  spentAmount,
  spendLimit,
  size = "md",
  className,
  ...props
}: BurnerCardVisualProps) {
  const sizeStyles = sizeMap[size];
  const progressWidth = formatProgress(spentAmount, spendLimit);
  const gradient = statusGradients[status];

  return (
    <Card
      data-slot="burner-card"
      role="group"
      aria-label={`${nickname} burner card ending ${lastFour}`}
      className={cn(
        "relative overflow-hidden rounded-xl text-card-foreground shadow-md border-0",
        sizeStyles.height,
        className
      )}
      style={{ backgroundImage: `linear-gradient(135deg, ${gradient[0]}, ${gradient[1]})` }}
      {...props}
    >
      <div className={cn("flex h-full flex-col justify-between text-white", sizeStyles.padding)}>
        <div className="flex items-center justify-between">
          <span className="text-xs font-semibold uppercase tracking-[0.2em]">Klard</span>
          <Badge data-slot="burner-type" variant="outline" className="bg-white/10 text-white border-white/30">
            {type === "single-use" ? "Single-use" : "Recurring"}
          </Badge>
        </div>
        <div>
          <div data-slot="burner-number" className={cn("tracking-widest font-semibold", sizeStyles.number)}>
            •••• •••• •••• {lastFour}
          </div>
          <div className="mt-2 flex items-center justify-between text-sm opacity-90">
            <div className={cn("font-semibold", sizeStyles.title)}>{nickname}</div>
            <span data-slot="burner-expiry" className="font-mono text-xs">
              {expiryMonth}/{expiryYear}
            </span>
          </div>
        </div>
        <div className="space-y-2">
          <div className="flex items-center justify-between text-xs uppercase tracking-wide">
            <span className="opacity-80">Spent</span>
            <span data-slot="burner-spend" className="font-semibold">
              ${spentAmount.toFixed(0)} / ${spendLimit.toFixed(0)}
            </span>
          </div>
          <div className="bg-white/15 h-2 w-full rounded-full" aria-hidden="true">
            <div
              data-slot="burner-progress-fill"
              className="h-2 rounded-full bg-white/90"
              style={{ width: progressWidth }}
            />
          </div>
        </div>
      </div>
    </Card>
  );
}
```

Update export:

```ts
export { BurnerCardVisual, type BurnerCardVisualProps } from './burner-card-visual';
```

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/burner-card-visual.test.tsx --run`  
Expected: PASS.

**Step 5: Commit**  
`git add klard-web/src/components/ui/burner-card-visual.tsx klard-web/src/__tests__/components/ui/burner-card-visual.test.tsx klard-web/src/components/ui/index.ts`

---

### Task 3: BurnerCardVisual (Mobile) - tests

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/BurnerCardVisual.test.tsx`

**Step 1: Write the failing test**

```tsx
import React from 'react';
import { render, screen } from '@testing-library/react-native';
import { BurnerCardVisual, type BurnerCardVisualProps } from '@/components/ui/BurnerCardVisual';

jest.mock('expo-linear-gradient', () => ({
  LinearGradient: ({ children }: { children: React.ReactNode }) => children,
}));

const base: BurnerCardVisualProps = {
  nickname: 'Travel Card',
  type: 'single-use',
  status: 'active',
  lastFour: '9876',
  expiryMonth: '11',
  expiryYear: '26',
  spentAmount: 30,
  spendLimit: 200,
};

describe('BurnerCardVisual (mobile)', () => {
  it('renders nickname, masked number, and expiry', () => {
    render(<BurnerCardVisual {...base} />);
    expect(screen.getByText('Travel Card')).toBeTruthy();
    expect(screen.getByText(/•••• •••• •••• 9876/)).toBeTruthy();
    expect(screen.getByText('11/26')).toBeTruthy();
  });

  it('caps progress at 100%', () => {
    const { getByTestId } = render(<BurnerCardVisual {...base} spentAmount={250} />);
    expect(getByTestId('burner-progress-fill').props.style.width).toBe('100%');
  });

  it('applies size variant padding for sm', () => {
    const { getByTestId } = render(<BurnerCardVisual {...base} size="sm" />);
    expect(getByTestId('burner-card').props.style).toEqual(expect.arrayContaining([expect.objectContaining({ padding: 12 })]));
  });

  it('sets accessibility label', () => {
    const { getByTestId } = render(<BurnerCardVisual {...base} />);
    expect(getByTestId('burner-card').props.accessibilityLabel).toContain('Travel Card');
  });
});
```

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/BurnerCardVisual.test.tsx --run`  
Expected: FAIL (component missing).

---

### Task 4: BurnerCardVisual (Mobile) - implement

**Files:**
- Create: `klard-mobile/src/components/ui/BurnerCardVisual.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 3: Write minimal implementation**

```tsx
import React from 'react';
import { View, Text, StyleSheet } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { useThemeColors } from '@/hooks';

export type BurnerCardStatus = 'active' | 'locked' | 'expired' | 'used';
export type BurnerCardType = 'single-use' | 'recurring';
export type BurnerCardSize = 'sm' | 'md' | 'lg';

export interface BurnerCardVisualProps {
  nickname: string;
  type: BurnerCardType;
  status: BurnerCardStatus;
  lastFour: string;
  expiryMonth: string;
  expiryYear: string;
  spentAmount: number;
  spendLimit: number;
  size?: BurnerCardSize;
}

const statusGradients: Record<BurnerCardStatus, readonly [string, string]> = {
  active: ['#15B5B0', '#0D7C7A'],
  locked: ['#F59E0B', '#B45309'],
  expired: ['#64748B', '#475569'],
  used: ['#475569', '#334155'],
};

const sizeMap: Record<BurnerCardSize, { height: number; padding: number; title: number; number: number }> = {
  sm: { height: 160, padding: 12, title: 12, number: 16 },
  md: { height: 190, padding: 16, title: 14, number: 18 },
  lg: { height: 220, padding: 20, title: 16, number: 20 },
};

function formatProgress(spent: number, limit: number) {
  if (limit <= 0) return '0%';
  return `${Math.min(100, Math.round((spent / limit) * 100))}%`;
}

export function BurnerCardVisual({
  nickname,
  type,
  status,
  lastFour,
  expiryMonth,
  expiryYear,
  spentAmount,
  spendLimit,
  size = 'md',
}: BurnerCardVisualProps) {
  const colors = useThemeColors();
  const sizeStyles = sizeMap[size];
  const progressWidth = formatProgress(spentAmount, spendLimit);
  const gradient = statusGradients[status];

  return (
    <LinearGradient
      testID="burner-card"
      accessibilityLabel={`${nickname} burner card ending ${lastFour}`}
      accessibilityRole="image"
      colors={gradient as [string, string]}
      start={{ x: 0, y: 0 }}
      end={{ x: 1, y: 1 }}
      style={[
        styles.card,
        {
          height: sizeStyles.height,
          padding: sizeStyles.padding,
        },
      ]}
    >
      <View style={styles.header}>
        <Text style={[styles.brand, { color: colors.text }]}>Klard</Text>
        <View style={[styles.badge, { borderColor: colors.text }]}>
          <Text style={[styles.badgeText, { color: colors.text }]}>
            {type === 'single-use' ? 'Single-use' : 'Recurring'}
          </Text>
        </View>
      </View>

      <Text style={[styles.number, { fontSize: sizeStyles.number, color: colors.text }]}>
        •••• •••• •••• {lastFour}
      </Text>

      <View style={styles.footer}>
        <View>
          <Text style={[styles.nickname, { fontSize: sizeStyles.title, color: colors.text }]}>{nickname}</Text>
          <Text style={[styles.expiry, { color: colors.mutedForeground }]}>
            {expiryMonth}/{expiryYear}
          </Text>
        </View>
        <View>
          <Text style={[styles.spendLabel, { color: colors.mutedForeground }]}>Spent</Text>
          <Text style={[styles.spendAmount, { color: colors.text }]}>
            ${spentAmount.toFixed(0)} / ${spendLimit.toFixed(0)}
          </Text>
        </View>
      </View>

      <View style={[styles.track, { backgroundColor: colors.muted }]}>
        <View
          testID="burner-progress-fill"
          style={[
            styles.fill,
            { width: progressWidth, backgroundColor: colors.text },
          ]}
        />
      </View>
    </LinearGradient>
  );
}

const styles = StyleSheet.create({
  card: {
    borderRadius: 14,
    gap: 12,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  brand: {
    fontSize: 12,
    fontWeight: '700',
    letterSpacing: 2,
    textTransform: 'uppercase',
  },
  badge: {
    borderWidth: 1,
    borderRadius: 999,
    paddingHorizontal: 10,
    paddingVertical: 4,
    backgroundColor: 'rgba(255,255,255,0.1)',
  },
  badgeText: {
    fontSize: 12,
    fontWeight: '600',
  },
  number: {
    fontWeight: '700',
    letterSpacing: 2,
  },
  footer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  nickname: {
    fontWeight: '700',
  },
  expiry: {
    marginTop: 2,
    fontSize: 12,
  },
  spendLabel: {
    fontSize: 11,
    textTransform: 'uppercase',
  },
  spendAmount: {
    fontSize: 13,
    fontWeight: '700',
  },
  track: {
    height: 8,
    borderRadius: 999,
    overflow: 'hidden',
  },
  fill: {
    height: '100%',
    borderRadius: 999,
  },
});
```

Update export:

```ts
export { BurnerCardVisual, type BurnerCardVisualProps } from './BurnerCardVisual';
```

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/BurnerCardVisual.test.tsx --run`  
Expected: PASS.

**Step 5: Commit**  
`git add klard-mobile/src/components/ui/BurnerCardVisual.tsx klard-mobile/src/__tests__/components/ui/BurnerCardVisual.test.tsx klard-mobile/src/components/ui/index.ts`

---

### Task 5: Verification & spec update

**Files:** `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Run checks**  
- `pnpm --filter klard-web test src/__tests__/components/ui/burner-card-visual.test.tsx --run`  
- `pnpm --filter klard-mobile test src/__tests__/components/ui/BurnerCardVisual.test.tsx --run`  
- `pnpm --filter klard-web exec tsc --noEmit`  
- `pnpm --filter klard-mobile exec tsc --NoEmit`

**Step 2: Design verify**  
- Quick visual sanity in Story/Preview (manual) for gradients/spacing against design tokens.  
- Confirm data-slot/testID present.

**Step 3: Update spec marker**  
- Change `<!-- IN-PROGRESS:5.3-burner-card-visual -->` to `<!-- DONE:5.3-burner-card-visual -->`.

**Step 4: Commit**  
`git add docs/screens/batch/Klard_Component_Specifications.md`

**Step 5: Summarize**  
Prepare summary, tests run, follow-ups (e.g., integrate with actual card data source or ServiceLogo if needed).
