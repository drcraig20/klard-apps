# 4.3 EmptyState Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a reusable EmptyState experience on web and mobile that shows a friendly illustration, title, description, and primary/secondary actions for empty content areas.

**Architecture:** Web uses shadcn/ui-style Empty primitives plus a composed `EmptyState` wrapper for opinionated layout; mobile uses a single `EmptyState` component with expo-image for illustrations and shared Button actions. Both expose typed props for content/actions, optional illustration media, and data-slot/testID hooks for testing and theming.

**Tech Stack:** Web: React 19, TypeScript, Tailwind/shadcn/ui, CVA, Testing Library + Vitest. Mobile: React Native + Expo SDK 54 (`expo-image`), StyleSheet, Testing Library RN + Jest.

---

- **Component:** EmptyState (web + mobile) for showing empty content placeholders with actions.
- **Target Platforms:** Web (Next.js App Router) and Mobile (Expo).
- **Props (web):**
  - `title: string` (required)
  - `description?: string`
  - `illustration?: React.ReactNode` (rendered inside media area)
  - `primaryAction?: { label: string; onPress: () => void; variant?: "primary" | "secondary" | "outline" | "ghost" }`
  - `secondaryAction?: { label: string; onPress: () => void; variant?: "ghost" | "outline" }`
  - `className?: string`
  - `contentClassName?: string`
- **Props (mobile):**
  - `title: string`
  - `description?: string`
  - `illustration?: ImageSourcePropType`
  - `primaryAction?: { label: string; onPress: () => void }`
  - `secondaryAction?: { label: string; onPress: () => void }`
  - `testID?: string`
  - `style?: StyleProp<ViewStyle>`
- **Visual States:** default empty, with illustration, with primary action only, with both actions; disabled actions inherit from Button; layout supports responsive widths (web) and safe touch targets (mobile).
- **Size Variants:** web uses spacing tokens (gap-4/6, w-40/h-40 media); mobile uses StyleSheet paddings (24px), media size 160px.
- **Color Tokens:** web uses `bg-muted/40`, `border-dashed border-border`, text via foreground tokens; actions reuse Button variants (primary/ghost). Mobile uses Klard teal (#0D7C7A) and neutral text (#0F172A/#475569), actions reuse Button styling.
- **Accessibility:** web uses semantic heading (`h3`), description text, `aria-live="polite"` on container, data-slot attributes on root/media/header/content/actions; buttons inherit accessible labels. Mobile sets `accessibilityRole="summary"` on container, testIDs for image/root, and uses Button `accessibilityRole="button"`.
- **Dependencies:** Web: `@/components/ui/button`, `@/lib/utils`, `class-variance-authority` (for optional media sizing). Mobile: `expo-image`, `@/components/ui/Button`, `StyleSheet`.
- **SOLID Compliance:**

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Empty (web primitive) | Layout container only | Accepts className for extension | N/A | HTMLAttributes only | Depends on abstractions (props) |
| Empty subcomponents (Header/Title/Description/Media/Content) | Each renders one slot | Style via className | N/A | Segmented props | N/A |
| EmptyState (web) | Composes illustration/text/actions | Actions configurable via props | N/A | Single props interface | Depends on Button abstraction |
| EmptyState (mobile) | Renders empty layout with actions | Illustration/action optional | N/A | Single props interface | Depends on Button/Image abstractions |

### Parallel Sub-Agent Strategy
- Task 1 (web) and Task 2 (mobile) can run in parallel; exports touch different packages.
- Final verification (Task 3) runs after both implementations.

### Test Strategy (TDD)
- **Web:** render title/description, media rendering, primary/secondary actions trigger handlers, absence of optional props, className merge, data-slot presence.
- **Mobile:** render title/description, render illustration via expo-image, press handlers fire, optional actions hidden when absent, testID plumbing.

---

### Task 1: Web EmptyState (TDD)

**Files:**
- Create: `klard-web/src/__tests__/components/ui/empty-state.test.tsx`
- Create: `klard-web/src/components/ui/empty.tsx`
- Create: `klard-web/src/components/ui/empty-state.tsx`
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Write the failing test**
```tsx
/**
 * Tests for EmptyState Component (Web)
 *
 * TDD: Write failing tests first, then implement to pass.
 */
import { describe, expect, it, vi } from "vitest"
import { render, screen, fireEvent } from "@testing-library/react"

import { EmptyState } from "@/components/ui/empty-state"

describe("EmptyState (web)", () => {
  it("renders title and description", () => {
    render(
      <EmptyState
        title="No subscriptions yet"
        description="Add your first subscription to start tracking."
      />
    )

    expect(screen.getByRole("heading", { level: 3 })).toHaveTextContent(
      "No subscriptions yet"
    )
    expect(
      screen.getByText("Add your first subscription to start tracking.")
    ).toBeInTheDocument()
  })

  it("renders illustration when provided", () => {
    render(
      <EmptyState
        title="Nothing here"
        illustration={<div data-testid="illustration">ðŸŽ¨</div>}
      />
    )

    expect(screen.getByTestId("illustration")).toBeInTheDocument()
  })

  it("renders primary and secondary actions and triggers handlers", () => {
    const onPrimary = vi.fn()
    const onSecondary = vi.fn()

    render(
      <EmptyState
        title="No data"
        primaryAction={{ label: "Add item", onPress: onPrimary }}
        secondaryAction={{ label: "Maybe later", onPress: onSecondary }}
      />
    )

    fireEvent.click(screen.getByRole("button", { name: "Add item" }))
    fireEvent.click(screen.getByRole("button", { name: "Maybe later" }))
    expect(onPrimary).toHaveBeenCalled()
    expect(onSecondary).toHaveBeenCalled()
  })

  it("does not render action buttons when not provided", () => {
    render(<EmptyState title="No results" />)

    expect(screen.queryByRole("button")).toBeNull()
  })

  it("applies custom className and data-slot on root", () => {
    render(<EmptyState title="Styled" className="border-red-500" />)

    const container = document.querySelector('[data-slot="empty-state"]')
    expect(container).toBeInTheDocument()
    expect(container?.className).toContain("border-red-500")
  })
})
```

**Step 2: Run test to verify it fails**
Run: `pnpm --filter klard-web test src/__tests__/components/ui/empty-state.test.tsx --run`
Expected: FAIL (EmptyState not implemented).

**Step 3: Write minimal implementation**
- Implement shadcn-style primitives in `klard-web/src/components/ui/empty.tsx` (Empty, EmptyHeader, EmptyTitle, EmptyDescription, EmptyContent, EmptyMedia with `data-slot`).
- Implement `EmptyState` wrapper in `klard-web/src/components/ui/empty-state.tsx` composing primitives, optional illustration slot, buttons for actions, aria-live on root, className passthrough.
- Export `EmptyState` and primitives from `klard-web/src/components/ui/index.ts`.

**Step 4: Run test to verify it passes**
Run: `pnpm --filter klard-web test src/__tests__/components/ui/empty-state.test.tsx --run`
Expected: PASS.

**Step 5: Commit**
`git add klard-web/src/components/ui/empty.tsx klard-web/src/components/ui/empty-state.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/empty-state.test.tsx`
`git commit -m "feat(web): add empty state component"`

---

### Task 2: Mobile EmptyState (TDD)

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/EmptyState.test.tsx`
- Create: `klard-mobile/src/components/ui/EmptyState.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Write the failing test**
```tsx
/**
 * Tests for EmptyState Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */
import React from "react"
import { render, screen, fireEvent } from "@testing-library/react-native"

import { EmptyState } from "@/components/ui/EmptyState"

describe("EmptyState (mobile)", () => {
  it("renders title and description", () => {
    render(
      <EmptyState
        title="No subscriptions"
        description="Add your first subscription to start tracking."
      />
    )

    expect(screen.getByText("No subscriptions")).toBeTruthy()
    expect(
      screen.getByText("Add your first subscription to start tracking.")
    ).toBeTruthy()
  })

  it("renders illustration when provided", () => {
    render(
      <EmptyState
        title="Nothing here"
        illustration={{ uri: "https://example.com/illustration.png" }}
      />
    )

    expect(screen.getByTestId("empty-illustration")).toBeTruthy()
  })

  it("renders actions and triggers handlers", () => {
    const onPrimary = vi.fn()
    const onSecondary = vi.fn()

    render(
      <EmptyState
        title="No data"
        primaryAction={{ label: "Add item", onPress: onPrimary }}
        secondaryAction={{ label: "Maybe later", onPress: onSecondary }}
      />
    )

    fireEvent.press(screen.getByText("Add item"))
    fireEvent.press(screen.getByText("Maybe later"))
    expect(onPrimary).toHaveBeenCalled()
    expect(onSecondary).toHaveBeenCalled()
  })

  it("does not render action buttons when not provided", () => {
    render(<EmptyState title="Empty" />)

    expect(screen.queryByText("Add item")).toBeNull()
    expect(screen.queryByText("Maybe later")).toBeNull()
  })
})
```

**Step 2: Run test to verify it fails**
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/EmptyState.test.tsx --run`
Expected: FAIL (component missing).

**Step 3: Write minimal implementation**
- Implement `EmptyState` in `klard-mobile/src/components/ui/EmptyState.tsx` using `expo-image` for illustration (with `testID="empty-illustration"`), `Button` for actions, and StyleSheet layout with centered content/padding.
- Support optional `testID` on root, required title, optional description/actions, accessibilityRole set.
- Export component from `klard-mobile/src/components/ui/index.ts`.

**Step 4: Run test to verify it passes**
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/EmptyState.test.tsx --run`
Expected: PASS.

**Step 5: Commit**
`git add klard-mobile/src/components/ui/EmptyState.tsx klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/EmptyState.test.tsx`
`git commit -m "feat(mobile): add empty state component"`

---

### Task 3: Verification & Completion

**Files:** No new files; verify outputs and spec marker.

**Step 1: Run type checks for both packages**
Run: `pnpm --filter klard-web exec tsc --noEmit && pnpm --filter klard-mobile exec tsc --noEmit`
Expected: PASS.

**Step 2: Optional visual verify (if env ready)**
Run: `pnpm --filter klard-web dev` then `npm run verify` per klard-ui-verify to capture screenshots for EmptyState usage.
Expected: Screenshots align with design tokens (teal/navy, glassmorphism padding).

**Step 3: Update spec status**
- Replace `<!-- IN-PROGRESS:4.3-empty-state -->` with `<!-- DONE:4.3-empty-state -->` in `docs/screens/batch/Klard_Component_Specifications.md`.

**Step 4: Final commit**
`git add docs/screens/batch/Klard_Component_Specifications.md`
`git commit -m "chore: mark empty state spec done"`

