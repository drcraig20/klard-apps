# 3.1 Card Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build reusable Card components for web and mobile with variants (default, elevated, ghost, interactive), padding options, and optional press handling, aligned with Klard’s design system.

**Architecture:** Extend the existing shadcn Card on web with a variant system (CVA) and padding controls while preserving current data-slot structure. Implement a new mobile Card using React Native/Expo primitives with StyleSheet variants and Pressable for interactive/pressable use. Keep layout/styling concerns within the component; content remains children-only for SRP.

**Tech Stack:** Next.js 16, React 19, shadcn/ui Card, Tailwind/CVA, lucide design tokens; React Native + Expo 54 (Pressable, View, StyleSheet, Haptics optional?), jest-expo + RNTL; Vitest + Testing Library (web).

---

## Component Outline
- **Component:** Card (web + mobile)
- **Purpose:** Container with variant styling and optional interactivity.
- **Platforms:** Web and Mobile.
- **Props:**
  - `variant?: 'default' | 'elevated' | 'ghost' | 'interactive'` (default `default`)
  - `padding?: 'none' | 'sm' | 'md' | 'lg'` (default `md`)
  - `children: ReactNode`
  - `onPress?: () => void` (web uses `onClick`, mobile uses `Pressable`)
  - `className?` (web), `style?` (mobile) for extension
- **States:** default, hover/pressed (interactive/elevated), focus-visible when pressable, disabled not required (YAGNI).
- **Sizes/Padding:** map to Tailwind `p-0`, `p-3`, `p-4`, `p-6`; mobile to 0/12/16/24 px.
- **Color Tokens:** use existing card bg/foreground/border tokens (`bg-card`, `border-border`, `shadow-sm`), elevated uses stronger shadow, interactive uses teal border hover (#15B5B0) with subtle shadow.
- **Accessibility:** web uses semantic `div` by default, switches to `button` when `onPress`; ensure `type="button"`, `role="button"` only if needed, focus-visible rings; mobile uses `accessibilityRole="button"` when pressable, supports `accessible` prop and pressed feedback.
- **Dependencies:** Web: shadcn Card primitives + `cn` util + `class-variance-authority`; Mobile: React Native `Pressable`, `View`, `StyleSheet`.

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Card (web) | Render styled container with variants | Variants/padding via data config; extendable without modifying core | Accepts any ReactNode children and optional handlers | Props limited to card concerns | Depends on shadcn Card + callbacks injected |
| Card (mobile) | Same responsibility on RN surface | Style variants via StyleSheet + config | Works with any children/onPress | Focused prop surface | Depends on RN primitives + injected handlers |

## Parallel Sub-Agent Strategy
- Web tests/implementation and mobile tests/implementation are independent; can be executed sequentially with review between tasks.
- Export wiring and spec DONE marker as final task.

## Test Strategy (TDD)
- **Web (Vitest + RTL):** render default with base classes; variant class application; padding classes; onPress renders `button` and fires handler; interactive adds hover/focus classes; ensure data-slot preserved.
- **Mobile (jest-expo + RNTL):** default renders children; padding style mapping; variant styles applied; Pressable used when onPress; press invokes handler; interactive/elevated shadows/style assertions via style flattening.

## Tasks (2–5 min each)

### Task 1: Web tests for Card variants
**Files:**  
- Create: `klard-web/src/__tests__/components/ui/card.test.tsx`

**Step 1: Write the failing test**
```tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Card } from '@/components/ui/card';

describe('Card (web)', () => {
  it('renders default card with padding md and data slot', () => {
    render(<Card>Content</Card>);
    const card = screen.getByTestId('card');
    expect(card).toHaveAttribute('data-slot', 'card');
    expect(card.className).toMatch(/p-4|py-6/);
  });

  it('applies variant classes', () => {
    render(<Card variant="elevated">Content</Card>);
    const card = screen.getByTestId('card');
    expect(card.className).toMatch(/shadow/);
  });

  it('uses button when onPress provided and fires handler', () => {
    const handlePress = vi.fn();
    render(<Card onPress={handlePress}>Press me</Card>);
    const card = screen.getByRole('button');
    fireEvent.click(card);
    expect(handlePress).toHaveBeenCalledTimes(1);
  });

  it('honors padding prop', () => {
    render(<Card padding="sm">Content</Card>);
    const card = screen.getByTestId('card');
    expect(card.className).toMatch(/p-3/);
  });
});
```

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/card.test.tsx --run`  
Expected: FAIL (props/classes missing).

**Step 3: Write minimal implementation**  
Update `klard-web/src/components/ui/card.tsx` with CVA for variant/padding, add `data-testid="card"`, support `onPress` rendering button.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/card.test.tsx --run`  
Expected: PASS.

**Step 5: Commit**  
`git add klard-web/src/components/ui/card.tsx klard-web/src/__tests__/components/ui/card.test.tsx`  
`git commit -m "feat(web): add Card variants and padding"`

### Task 2: Mobile tests for Card
**Files:**  
- Create: `klard-mobile/src/__tests__/components/ui/Card.test.tsx`

**Step 1: Write the failing test**
```tsx
import React from 'react';
import { render, fireEvent } from '@testing-library/react-native';
import { Card } from '@/components/ui';

describe('Card (mobile)', () => {
  it('renders children', () => {
    const { getByText } = render(<Card>Content</Card>);
    expect(getByText('Content')).toBeTruthy();
  });

  it('applies padding option', () => {
    const { getByTestId } = render(<Card padding="lg">Content</Card>);
    const tree = getByTestId('card');
    const style = Array.isArray(tree.props.style) ? tree.props.style.flat() : [tree.props.style];
    expect(style).toEqual(expect.arrayContaining([expect.objectContaining({ padding: 24 })]));
  });

  it('uses Pressable when onPress provided', () => {
    const handlePress = jest.fn();
    const { getByA11yRole } = render(<Card onPress={handlePress}>Press</Card>);
    const btn = getByA11yRole('button');
    fireEvent.press(btn);
    expect(handlePress).toHaveBeenCalled();
  });

  it('applies elevated variant style', () => {
    const { getByTestId } = render(<Card variant="elevated">Content</Card>);
    const style = Array.isArray(getByTestId('card').props.style)
      ? getByTestId('card').props.style.flat()
      : [getByTestId('card').props.style];
    expect(style).toEqual(expect.arrayContaining([expect.objectContaining({ shadowOpacity: expect.any(Number) })]));
  });
});
```

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/Card.test.tsx --run`  
Expected: FAIL (component missing/props not handled).

**Step 3: Write minimal implementation**  
Create `klard-mobile/src/components/ui/Card.tsx` with variants/padding styles, Pressable when `onPress`, testID `card`.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/Card.test.tsx --run`  
Expected: PASS.

**Step 5: Commit**  
`git add klard-mobile/src/components/ui/Card.tsx klard-mobile/src/__tests__/components/ui/Card.test.tsx klard-mobile/src/components/ui/index.ts`  
`git commit -m "feat(mobile): add Card component"`

### Task 3: Export & finalize
**Files:**  
- Modify: `klard-web/src/components/ui/index.ts`  
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1:** Add exports for Card (mobile type), ensure data slots intact.  
**Step 2:** Run scoped tests (web + mobile) to confirm no regressions.  
**Step 3:** Mark spec DONE for 3.1-card.

