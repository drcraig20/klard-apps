# 5.5 PriceDisplay Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Provide a reusable PriceDisplay component that formats amounts with currency and billing cycle, optionally shows price change deltas with directional styling, and stays consistent across web and mobile surfaces.

**Architecture:** Stateless, controlled display-only component. Web uses a client component with Intl.NumberFormat, size variants via Tailwind classes, and optional change indicator with icons/colors from the design system. Mobile uses a React Native functional component with StyleSheet-driven sizes/colors and the same props surface. Both expose minimal logic (formatting + delta computation) and rely on props for data, keeping SRP.

**Tech Stack:** Next.js 16 + React 19 + Tailwind/shadcn utilities (web); Expo 54 + React Native 0.81 + TypeScript (mobile); Intl.NumberFormat for currency formatting; lucide-react icons (web) and Ionicons (mobile) for change arrows.

---

- **Component:** `PriceDisplay` — displays formatted price with optional billing cycle suffix and change indicator.
- **Targets:** Web (Next.js/shadcn) and Mobile (Expo/React Native).
- **Props interface:**
  - `amount: number`
  - `currency?: string` (default `'USD'`)
  - `billingCycle?: 'monthly' | 'yearly' | 'weekly' | 'one-time'`
  - `size?: 'sm' | 'md' | 'lg'` (defaults to `'md'`)
  - `showChange?: { from: number; direction: 'increase' | 'decrease' }`
- **Visual states:** default amount display, billing cycle suffix, change indicator with up/down icon and red/green text, size variants (sm/md/lg), resilient to large numbers, handles zero/negative amounts gracefully.
- **Size variants:** map to text sizes and gaps:
  - `sm`: amount text `text-base`, suffix `text-xs`, gap-1
  - `md`: amount text `text-xl`, suffix `text-sm`, gap-1.5
  - `lg`: amount text `text-2xl`, suffix `text-base`, gap-2
- **Color tokens:** Use primary/foreground text (`text-slate-900 dark:text-slate-100`), muted suffix (`text-slate-500 dark:text-slate-400`), increase → `text-green-600`, decrease → `text-red-500`; background transparent (inline element).
- **Accessibility requirements:** Semantic inline text; ensure icons have `aria-hidden`; provide `aria-label` for change description on wrapper (e.g., “$12.00 per month, increased by $3.00”); avoid hard-coded locale text.
- **Dependencies:** Web uses existing `cn` helper and lucide-react icons (ArrowUpRight, ArrowDownRight) already installed; no new dependencies. Mobile uses `Ionicons` from `@expo/vector-icons`.
- **SOLID compliance:**

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Web PriceDisplay | Format + render price/delta only | Extend via props (size/cycle/change) without modifying logic | Accepts any number/currency without stricter constraints | Props minimal; no extraneous requirements | Depends on abstractions (props, Intl) not external state |
| Mobile PriceDisplay | Same as web, RN rendering | Style/size via props; logic isolated | Substitutable with same props | Narrow prop interface | Uses props and Intl; icons injected from library |

- **Parallel sub-agent strategy:** Execute web and mobile tasks in separate RED/GREEN steps with checkpoints. (Task tool unavailable; will mimic sequential subagent flow with interim reviews.)
- **Test strategy (write first):**
  - Web: renders amount with default currency; applies billing cycle suffix; size variants alter classNames; showChange renders delta amount with correct sign/absolute value, icon direction, and color; aria-label includes delta description; accepts custom currency; handles decrease/increase separately.
  - Mobile: renders formatted amount text; billing cycle suffix; size styles differ (font sizes); change indicator shows arrow icon and colored text; accessibility label describes price and delta.

---

### Task 1: Web tests for PriceDisplay (RED)

**Files:**
- Create: `klard-web/src/__tests__/components/ui/price-display.test.tsx`

**Step 1: Write the failing test**  
Scenarios: default USD formatting; custom currency (EUR) uses `€`; billing cycle suffix rendered; size variants apply different text size classes; increase shows green text + up-right icon + delta = `abs(amount - from)`; decrease shows red text + down-right icon; aria-label summarizes amount and change.

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/price-display.test.tsx --run`  
Expected: FAIL (component missing).

### Task 2: Web PriceDisplay implementation (GREEN)

**Files:**
- Create: `klard-web/src/components/ui/price-display.tsx`
- Modify: `klard-web/src/components/ui/index.ts`

**Step 3: Write minimal implementation**  
Implement client component using Intl.NumberFormat; compute suffix map; sizeClasses map; delta computation uses `Math.abs(amount - from)`; conditionally render change block with icon and color class; set `aria-label` describing amount, cycle, and delta; expose `data-slot="price-display"`.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-web test src/__tests__/components/ui/price-display.test.tsx --run`  
Expected: PASS.

### Task 3: Mobile tests for PriceDisplay (RED)

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/PriceDisplay.test.tsx`

**Step 1: Write the failing test**  
Cases: default formatting; custom currency; billing cycle suffix text; size prop adjusts fontSize; increase shows green text + up icon; decrease shows red + down icon; accessibility label includes delta description.

**Step 2: Run test to verify it fails**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/PriceDisplay.test.tsx --run`  
Expected: FAIL.

### Task 4: Mobile PriceDisplay implementation (GREEN)

**Files:**
- Create: `klard-mobile/src/components/ui/PriceDisplay.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 3: Write minimal implementation**  
Use `Intl.NumberFormat`; suffix map; sizeStyles map; render row with Text nodes; change indicator with Ionicons arrow (up/down) and colored text; `accessibilityLabel` summarizing amount and delta; support `billingCycle`, `size`, `showChange`.

**Step 4: Run test to verify it passes**  
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/PriceDisplay.test.tsx --run`  
Expected: PASS.

### Task 5: Type checks and verification

**Files:**
- Confirm exports in both index files.

**Step 1: Run type checks**  
Run: `pnpm --filter klard-web exec tsc --noEmit`  
Run: `pnpm --filter klard-mobile exec tsc --noEmit`

**Step 2: Run full tests**  
Run: `pnpm --filter klard-web test --run`  
Run: `pnpm --filter klard-mobile test --run`

**Step 3: Mark spec DONE**  
Update `docs/screens/batch/Klard_Component_Specifications.md` replacing `IN-PROGRESS:5.5-price-display` with `DONE:5.5-price-display`.

**Step 4: Commit (after verification/user approval)**  
`git add` relevant files; commit suggestion: `feat(web): add price display component` + `feat(mobile): add price display component` if combined.
