# ServiceLogo Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a reusable ServiceLogo component for web and mobile that displays a service logo with graceful fallback and size variants aligned to Klard design tokens.

**Architecture:** Thin wrapper around existing Avatar primitives; derive fallback from service name; enforce circular shape and size-specific dimensions without modifying Avatar internals. Web uses shadcn/ui Avatar; mobile uses expo-image with blurhash placeholder and theme-aware fallback styling.

**Tech Stack:** React 19 + Next.js 16 (App Router), Tailwind/shadcn/ui, class-variance-authority (for potential size variants), React Native + Expo SDK 54 (expo-image), TypeScript strict, Vitest/RTL (web), Jest/RTL (mobile).

---

- **Component & Purpose:** `ServiceLogo` renders a service's logo URL or the first letter of the service name as fallback, always circular.
- **Targets:** Web (klard-web) and Mobile (klard-mobile).
- **Props (shared shape per platform):**
  - `service: { name: string; logoUrl?: string | null }`
  - `size: 'xs' | 'sm' | 'md' | 'lg'` (default `'md'`)
  - `className?/style?`: optional styling overrides per platform.
- **Visual States:** default image, fallback when no logo, fallback when image errors, accessibility labels; (no explicit loading indicator per spec).
- **Size Variants:** xs 24px, sm 32px, md 44px, lg 64px (apply exact dimensions via className/style overrides while reusing Avatar).
- **Color Tokens:** Fallback background teal-100 `#D5F5F4`, text teal-700 `#0D7C7A`; mobile uses theme muted background + teal text; preserve glass-safe contrast.
- **Accessibility:** `aria-label`/alt equals service name on web; `accessibilityLabel` and role=image on mobile; data-slot on root `service-logo`.
- **Dependencies:** Web `Avatar` from `@/components/ui/avatar`, `cn`; Mobile `expo-image`, existing `Avatar` styles/theme hook; optional blurhash constant.
- **SOLID Compliance:**
  | Component | SRP | OCP | LSP | ISP | DIP |
  |-----------|-----|-----|-----|-----|-----|
  | ServiceLogo (Web) | Single responsibility: render service logo/fallback | Extend via props (size/className) without modifying core | Accepts any service object with name/logoUrl | Minimal props interface | Depends on Avatar abstraction + utils |
  | ServiceLogo (Mobile) | Same single responsibility | Size/style overrides via props | Substitutable wherever Avatar-like logo needed | Minimal props interface | Depends on theme hook + expo-image abstraction |
- **Parallel Sub-Agent Strategy:** Execute tasks sequentially in this session (Task tool unavailable); simulate subagent-driven flow by reviewing after each task and keeping diffs minimal.
- **Test Strategy (TDD):** Add failing tests first for web and mobile covering: renders fallback initial, uses logo image when provided, falls back on error, respects size map dimensions, sets accessibility labels/roles, data-slot presence (web). Then implement to pass.

---

### Task 1: Add failing web tests for ServiceLogo

**Files:**
- Create: `klard-web/src/__tests__/components/ui/service-logo.test.tsx`

**Step 1: Write the failing test**
```tsx
// Tests: renders fallback initial letter, renders image when logoUrl provided, falls back on error, applies size dimensions (24/32/44/64), data-slot present, aria-label = service.name.
```

**Step 2: Run test to verify it fails**
Run: `pnpm --filter klard-web test src/__tests__/components/ui/service-logo.test.tsx --run`
Expected: FAIL (component not implemented/exported).

**Step 3: Write minimal implementation**
N/A in this task (test-only).

**Step 4: Run test to verify it passes**
N/A (will stay failing until Task 2).

**Step 5: Commit**
N/A (after implementation).

---

### Task 2: Implement web ServiceLogo component

**Files:**
- Create: `klard-web/src/components/ui/service-logo.tsx`
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Implement minimal code to satisfy tests**
- Wrapper over `Avatar`; map sizes to Avatar size tokens and override dimensions via `className` (`h-[24px] w-[24px]`, etc.).
- Fallback text: first letter uppercased; `data-slot="service-logo"`.
- Use `alt`/`aria-label` from service name; pass `src` only when logoUrl defined.

**Step 2: Run tests**
Run: `pnpm --filter klard-web test src/__tests__/components/ui/service-logo.test.tsx --run`
Expected: PASS.

**Step 3: Refactor if needed**
- Keep Avatar untouched; ensure cn merge order preserves overrides.

**Step 4: Commit**
`git add klard-web/src/components/ui/service-logo.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/service-logo.test.tsx`
`git commit -m "feat(web): add ServiceLogo component"`

---

### Task 3: Add failing mobile tests for ServiceLogo

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/ServiceLogo.test.tsx`

**Step 1: Write the failing test**
```tsx
// Tests: renders container and fallback letter, uses Image when logoUrl provided, falls back on error (simulate onError), applies size dimensions 24/32/44/64 with circle radius, accessibilityLabel = service name.
```

**Step 2: Run test to verify it fails**
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/ServiceLogo.test.tsx --run`
Expected: FAIL (component missing).

**Step 3: Write minimal implementation**
N/A (test-only).

**Step 4: Run test to verify it passes**
N/A (until Task 4).

**Step 5: Commit**
N/A (after implementation).

---

### Task 4: Implement mobile ServiceLogo component

**Files:**
- Create: `klard-mobile/src/components/ui/ServiceLogo/ServiceLogo.tsx`
- Create: `klard-mobile/src/components/ui/ServiceLogo/service-logo.styles.ts`
- Create: `klard-mobile/src/components/ui/ServiceLogo/index.ts`
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Implement minimal code to satisfy tests**
- Use `expo-image` with blurhash placeholder; `useState` to track load error; fallback View/Text with theme colors.
- Size map: inline dimensions (24/32/44/64) + radius = dimension/2; accessibilityLabel/role=image; testIDs for container/image/fallback.

**Step 2: Run tests**
Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/ServiceLogo.test.tsx --run`
Expected: PASS.

**Step 3: Refactor if needed**
- Keep logic minimal; share BLURHASH constant; StyleSheet in separate file.

**Step 4: Commit**
`git add klard-mobile/src/components/ui/ServiceLogo/**/* klard-mobile/src/components/ui/index.ts klard-mobile/src/__tests__/components/ui/ServiceLogo.test.tsx`
`git commit -m "feat(mobile): add ServiceLogo component"`

---

### Task 5: Verification and spec update

**Step 1: Run focused and type checks**
- `pnpm --filter klard-web test src/__tests__/components/ui/service-logo.test.tsx --run`
- `pnpm --filter klard-mobile test src/__tests__/components/ui/ServiceLogo.test.tsx --run`
- `pnpm --filter klard-web exec tsc --noEmit`
- `pnpm --filter klard-mobile exec tsc --noEmit`

**Step 2: Visual sanity (optional quick check)**
- Render story/page locally if available; otherwise rely on tests.

**Step 3: Update spec marker**
- Change `<!-- IN-PROGRESS:5.1-service-logo -->` to `<!-- DONE:5.1-service-logo -->`.

**Step 4: Commit**
`git add docs/screens/batch/Klard_Component_Specifications.md`
`git commit -m "chore: mark service-logo component done"`

**Step 5: Prepare PR notes**
- Summaries, commands run, any follow-ups.
