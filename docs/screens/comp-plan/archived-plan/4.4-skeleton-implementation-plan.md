# Skeleton Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Provide reusable Skeleton placeholders for loading states that mimic various content shapes with optional presets, supporting rectangular, circular, and text variants on web and mobile.

**Architecture:** Web wraps shadcn/ui `Skeleton` with variant-aware class merging and optional width/height props plus preset compositions (e.g., subscription card). Mobile uses Animated + LinearGradient shimmer with StyleSheet variants; controlled props define dimensions and variant, with optional preset containers for common layouts.

**Tech Stack:** Next.js 16 App Router, React 19, Tailwind 4, shadcn/ui Skeleton, cn helper, Vitest + Testing Library (web); React Native/Expo SDK 54, `expo-linear-gradient`, Animated API, React Native Testing Library (mobile).

---

- **Component:** Skeleton + preset skeletons (e.g., SubscriptionCardSkeleton) to mirror likely layouts.
- **Targets:** Web + Mobile (web first).
- **Props (TS):**
  ```ts
  type SkeletonVariant = 'rectangular' | 'circular' | 'text';
  interface SkeletonProps {
    variant?: SkeletonVariant;
    width?: number | string;
    height?: number | string;
    className?: string;
    style?: React.CSSProperties; // web inline width/height
  }
  ```
- **Visual states:** Base shimmer/animate; variants adjust radius/height; respects custom width/height; preset layouts combine multiple skeletons with spacing; no interactive states.
- **Size variants:** Not size enum; dimensions driven by props and preset shapes. Text variant defaults height ~16px with rounded corners; circular enforces full radius.
- **Colors/tokens:** Use gray surfaces (`bg-slate-200/80` light, `bg-slate-700/60` dark via existing tailwind tokens) with shimmer overlay using `after` gradient or keyframe animation; preserve design subtlety (no harsh contrast).
- **Accessibility:** `aria-hidden="true"` and `role="status"` with `aria-live="polite"` where applicable for groups; avoid announcing meaningless text; add `data-slot="skeleton"` to primitives and `data-slot="skeleton.subscription-card"` for preset wrapper.
- **Dependencies:** shadcn/ui Skeleton, `cn` util; mobile depends on `expo-linear-gradient`, Animated; ensure StyleSheet and useEffect/useRef.
- **SOLID compliance:**
  | Component | SRP | OCP | LSP | ISP | DIP |
  |-----------|-----|-----|-----|-----|-----|
  | Skeleton (web) | Render placeholder shape | Extend via className/presets | Substitutable via props | Minimal props used | Depends on shadcn Skeleton abstraction |
  | SubscriptionCardSkeleton (web) | Compose multiple placeholders | Swap child skeletons without modifying | Same interface as container | No extra props beyond layout | Depends on Skeleton component |
  | Skeleton (mobile) | Render animated placeholder | Styles via props/preset containers | Props contract consistent | Focused props | Depends on Animated/LinearGradient abstractions |
  | SubscriptionCardSkeleton (mobile) | Layout-only composition | Swap shapes via props | Works with any Skeleton variant | Minimal prop surface | Depends on Skeleton abstraction |
- **Parallel sub-agent strategy:** (emulated) Web tests + impl first; mobile after. Could spin a quick style check in parallel, but due to shared context proceed sequentially.
- **Test strategy (TDD):** Web tests verify variant class/radius, width/height applied, data-slot present, preset renders correct child counts/sizes, className merge, accessibility role/aria-hidden. Mobile tests verify renders with width/height, variant style adjustments, shimmer animation presence, preset layout children count, and `expo-linear-gradient` usage mocked.

### Task 1: Write failing web tests
**Files:**
- Create: `klard-web/src/__tests__/components/ui/skeleton.test.tsx`
- Test cmd: `pnpm --filter klard-web test src/__tests__/components/ui/skeleton.test.tsx --run`

**Step 1: Write the failing test**
- Cases: renders rectangular default with data-slot; circular sets full rounding; text sets text height class; inline width/height applied; custom class merged; preset `SubscriptionCardSkeleton` renders avatar/text/action skeleton counts; role/status + aria-hidden expectations.

**Step 2: Run test to verify it fails**
- Expect missing component errors.

### Task 2: Implement web Skeleton + preset
**Files:**
- Create: `klard-web/src/components/ui/skeleton.tsx`
- Modify: `klard-web/src/components/ui/index.ts`
- Test cmd: `pnpm --filter klard-web test src/__tests__/components/ui/skeleton.test.tsx --run`

**Step 1: Implement minimal code**
- Wrap shadcn Skeleton, apply variant classes via `cn`, pass width/height style, set data-slot, aria-hidden/role/status. Add `SubscriptionCardSkeleton` preset with layout matching spec.

**Step 2: Run test to verify it passes**
- Keep green; adjust if needed.

**Step 3: Refactor**
- Tidy types, reuse helper for preset skeleton item props.

### Task 3: Write failing mobile tests
**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/skeleton.test.tsx`
- Test cmd: `pnpm --filter klard-mobile test src/__tests__/components/ui/skeleton.test.tsx --run`

**Step 1: Write the failing test**
- Cases: renders view with expected width/height; circular uses borderRadius=height/2; text variant default height; shimmer gradient child present; preset subscription skeleton renders expected child counts; accessibility props (accessible={false}).

**Step 2: Run test to verify it fails**

### Task 4: Implement mobile Skeleton + preset
**Files:**
- Create: `klard-mobile/src/components/ui/skeleton.tsx`
- Modify: `klard-mobile/src/components/ui/index.ts`
- Test cmd: `pnpm --filter klard-mobile test src/__tests__/components/ui/skeleton.test.tsx --run`

**Step 1: Implement minimal code**
- Animated shimmer with LinearGradient; StyleSheet variants; props width/height; data-slot via testID; preset layout using Views with spacing.

**Step 2: Run test to verify it passes**
- Keep green; refactor if needed (memoizing styles).

### Task 5: Verification and spec update
**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md` (mark DONE)
- Commands: `pnpm --filter klard-web test src/__tests__/components/ui/skeleton.test.tsx --run`; `pnpm --filter klard-web exec tsc --noEmit`; `pnpm --filter klard-mobile test src/__tests__/components/ui/skeleton.test.tsx --run`; optional lint.

**Step 1:** Run verification commands and collect outputs.
**Step 2:** Update marker to `<!-- DONE:4.4-skeleton -->`.
**Step 3:** Prepare commit message suggestion `feat: add skeleton loaders`.
