# 1.5 Switch/Toggle - Implementation Plan

## Component Overview

| Property | Value |
|----------|-------|
| **Name** | Switch / SwitchField |
| **Purpose** | Boolean on/off control for settings and toggles |
| **Platforms** | Web + Mobile |
| **Used In** | Screens 6, 20, 22, 23, 31 |
| **Priority** | Phase 2 - Form Components |

## Props Interface

```typescript
interface SwitchProps {
  checked: boolean;
  onChange: (checked: boolean) => void;
  label?: string;
  description?: string;
  disabled?: boolean;
  size?: 'sm' | 'md';
  id?: string;
}
```

## Visual States

| State | Web Appearance | Mobile Appearance |
|-------|----------------|-------------------|
| **Unchecked** | Gray track (#E2E8F0), white thumb | Platform native gray |
| **Checked** | Teal track (#0D7C7A), white thumb | Platform native with teal tint |
| **Disabled Unchecked** | 50% opacity, gray track | Platform native disabled |
| **Disabled Checked** | 50% opacity, teal track | Platform native disabled |
| **Focus** | Ring outline (web only) | N/A (native handles) |

## Accessibility Requirements

- [ ] `role="switch"` for web (provided by Radix)
- [ ] `aria-checked` state matches `checked` prop
- [ ] `aria-disabled` when disabled
- [ ] `aria-describedby` linking to description when present
- [ ] Label association via `htmlFor`/`id` pairing
- [ ] Keyboard: Space/Enter to toggle
- [ ] Mobile: `accessibilityRole="switch"`
- [ ] Mobile: `accessibilityState={{ checked, disabled }}`

## Dependencies

### Web
- `@radix-ui/react-switch` (via shadcn/ui)
- `@/lib/utils` (cn utility)
- `lucide-react` (no icons needed for this component)

### Mobile
- `react-native` Switch component (core)
- `expo-haptics` for feedback
- No additional Expo packages needed (RN Switch is sufficient)

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Switch (web) | Toggle only | Styled via className | Standard Radix props | Minimal props interface | Radix abstraction |
| SwitchField (web) | Switch + label/desc layout | Composable | N/A | Focused interface | Depends on Switch abstraction |
| Switch (mobile) | Toggle only | Styled via style prop | Standard RN props | Minimal props interface | RN Switch abstraction |
| SwitchField (mobile) | Switch + label/desc layout | Composable | N/A | Focused interface | Depends on Switch abstraction |

### Principle Applications

- **SRP:** Two components - primitive Switch (toggle only) and SwitchField (layout wrapper)
- **OCP:** Extensible via className/style props without modification
- **LSP:** Both platforms accept same prop interface
- **ISP:** Clean 7-prop interface, all optional except checked/onChange
- **DIP:** Components depend on platform abstractions (Radix/RN Switch)

## Test Strategy (TDD)

### Web Tests (`klard-web/src/__tests__/components/ui/switch.test.tsx`)

#### Rendering Tests
- [ ] Renders switch element with switch role
- [ ] Renders with label when provided
- [ ] Renders with description when provided
- [ ] Renders without label when not provided
- [ ] Applies size='sm' styling correctly
- [ ] Applies size='md' styling correctly (default)

#### State Tests
- [ ] Reflects checked=true state visually
- [ ] Reflects checked=false state visually
- [ ] Shows disabled state with reduced opacity
- [ ] Combines disabled and checked states correctly

#### Interaction Tests
- [ ] Calls onChange with true when toggled from unchecked
- [ ] Calls onChange with false when toggled from checked
- [ ] Does not call onChange when disabled
- [ ] Supports keyboard toggle with Space key
- [ ] Supports keyboard toggle with Enter key

#### Accessibility Tests
- [ ] Has switch role
- [ ] Has correct aria-checked state
- [ ] Has aria-disabled when disabled
- [ ] Links label via htmlFor/id
- [ ] Links description via aria-describedby

#### Edge Cases
- [ ] Handles undefined label gracefully
- [ ] Handles undefined description gracefully
- [ ] Passes through additional className
- [ ] Generates unique id when not provided

### Mobile Tests (`klard-mobile/src/__tests__/components/ui/Switch.test.tsx`)

#### Rendering Tests
- [ ] Renders Switch component
- [ ] Renders with label when provided
- [ ] Renders with description when provided
- [ ] Renders without label when not provided
- [ ] Applies size='sm' styling correctly
- [ ] Applies size='md' styling correctly (default)

#### State Tests
- [ ] Reflects value=true state
- [ ] Reflects value=false state
- [ ] Shows disabled state correctly
- [ ] Applies correct track colors when checked
- [ ] Applies correct track colors when unchecked

#### Interaction Tests
- [ ] Calls onChange with new value when toggled
- [ ] Does not call onChange when disabled
- [ ] Triggers haptic feedback on toggle

#### Accessibility Tests
- [ ] Has accessibilityRole="switch"
- [ ] Has correct accessibilityState.checked
- [ ] Has accessibilityState.disabled when disabled
- [ ] Has accessibilityLabel from label prop

## Parallel Sub-Agent Strategy

### Primary Agent Responsibilities
- Write test files (both platforms)
- Implement component code
- Final verification and integration

### Sub-Agent Tasks (can run in parallel)
1. **Type-checking agent**: Run `npx tsc --noEmit` after implementation
2. **Code review agent**: Review implementation against SOLID principles
3. **Accessibility review agent**: Verify ARIA attributes and keyboard navigation

## Implementation Steps

### Phase 1: Web Implementation

#### Step 1.1: Install shadcn/ui Switch (if not present)
```bash
cd klard-web && npx shadcn@latest add switch
```

#### Step 1.2: Write failing tests for web Switch
- Create test file at `klard-web/src/__tests__/components/ui/switch.test.tsx`
- Write all tests from Test Strategy above
- Run tests: `pnpm test` - verify they FAIL

#### Step 1.3: Implement web Switch component
- Create `klard-web/src/components/ui/switch.tsx` (if shadcn didn't create it)
- Create `klard-web/src/components/ui/switch-field.tsx` for composed variant
- Follow shadcn/ui patterns with Klard customizations

#### Step 1.4: Verify web tests pass
- Run tests: `pnpm test`
- All tests should pass

### Phase 2: Mobile Implementation

#### Step 2.1: Write failing tests for mobile Switch
- Create test file at `klard-mobile/src/__tests__/components/ui/Switch.test.tsx`
- Write all tests from Test Strategy above
- Run tests: verify they FAIL

#### Step 2.2: Implement mobile Switch component
- Create `klard-mobile/src/components/ui/Switch.tsx`
- Use React Native core Switch with Klard styling
- Add haptic feedback via expo-haptics

#### Step 2.3: Verify mobile tests pass
- Run tests in mobile directory
- All tests should pass

### Phase 3: Verification

#### Step 3.1: Type checking
- Run `npx tsc --noEmit` in both packages
- Fix any type errors

#### Step 3.2: Lint
- Run `pnpm lint` in monorepo root
- Fix any lint errors

#### Step 3.3: Visual verification
- Test component in storybook/dev server (if available)
- Verify all states render correctly

## File Structure

```
klard-web/
├── src/
│   ├── components/
│   │   └── ui/
│   │       ├── switch.tsx          # Primitive switch (shadcn base)
│   │       └── switch-field.tsx    # Composed switch with label/description
│   └── __tests__/
│       └── components/
│           └── ui/
│               └── switch.test.tsx

klard-mobile/
├── src/
│   ├── components/
│   │   └── ui/
│   │       └── Switch.tsx          # Switch + SwitchField combined
│   └── __tests__/
│       └── components/
│           └── ui/
│               └── Switch.test.tsx
```

## Verification Checklist

- [ ] Component renders without errors (both platforms)
- [ ] All props implemented and typed
- [ ] All required states functional (checked, unchecked, disabled)
- [ ] Matches design specification visually (Klard teal #0D7C7A)
- [ ] Accessibility attributes included (ARIA, roles)
- [ ] TypeScript passes with no errors
- [ ] All tests passing (TDD cycle completed)
- [ ] Test coverage sufficient for all critical behaviors
- [ ] Works on specified platforms (Web + Mobile)

## Estimated Test Count

| Platform | Test Count |
|----------|------------|
| Web | ~18 tests |
| Mobile | ~14 tests |
| **Total** | ~32 tests |

## Notes

- Web uses shadcn/ui Switch (Radix primitive) for accessibility
- Mobile uses React Native core Switch for native feel
- Both share the same prop interface for consistency
- Haptic feedback only on mobile (natural for touch)
- Size variants: 'sm' and 'md' (default)