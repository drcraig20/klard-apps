# 3.4 Tabs Component Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a production-ready Tabs component for both Web (Next.js + shadcn/ui) and Mobile (React Native + Expo) platforms following TDD.

**Architecture:** The Tabs component provides tab-based content organization. Web uses shadcn/ui Tabs built on Radix UI primitives. Mobile uses a custom ScrollView-based TabBar with haptic feedback. Both platforms expose a unified `TabsContainer` API with `tabs` array and controlled `value`/`onChange` props.

**Tech Stack:**
- Web: Next.js 16, React 19, shadcn/ui Tabs (Radix UI), Tailwind CSS 4, CVA for variants
- Mobile: React Native 0.81, Expo SDK 54, expo-haptics, ScrollView-based implementation

---

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| Tabs (web) | Container + state management only | Extensible via variants | Handles all TabItem types | Single TabsProps interface | Depends on TabItem abstraction |
| TabsList (web) | Renders tab triggers only | Tab items via array | N/A | Minimal props | Depends on Tab interface |
| TabsTrigger (web) | Single tab button | Variants for styling | Standard button behavior | Trigger props only | N/A |
| TabsContent (web) | Panel wrapper only | Data-driven | N/A | Content props only | N/A |
| TabBar (mobile) | Renders scrollable tabs | Extensible styles | N/A | TabBarProps only | Depends on Tab interface |

### Principle Applications

**SRP:** Components split by responsibility - container (Tabs), list (TabsList), trigger (TabsTrigger), content (TabsContent)
**OCP:** Tabs are data-driven via `tabs` array - extend by adding items, not modifying code
**LSP:** All tab items follow TabItem interface
**ISP:** Separate interfaces for container, trigger, and content
**DIP:** Components depend on TabItem interface, not concrete implementations

---

## Shared Types (for reference)

```typescript
interface TabItem {
  value: string;
  label: string;
  badge?: number;
  icon?: ReactNode;
  disabled?: boolean;
}

interface TabsProps {
  value: string;
  onChange: (value: string) => void;
  tabs: TabItem[];
  children: ReactNode;
  className?: string;
}
```

---

## Part 1: Web Implementation (klard-web)

---

### Task 1: Install shadcn/ui Tabs component

**Files:**
- Modify: `klard-web/package.json` (auto-updated by shadcn CLI)
- Create: `klard-web/src/components/ui/tabs.tsx` (created by shadcn CLI)

**Step 1: Run shadcn CLI to add Tabs**

Run:
```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps/klard-web && npx shadcn@latest add tabs
```
Expected: CLI installs @radix-ui/react-tabs and creates tabs.tsx

**Step 2: Verify installation**

Run:
```bash
ls -la /Users/drcraig/Desktop/PersonalProjects/klard-apps/klard-web/src/components/ui/tabs.tsx
```
Expected: File exists

**Step 3: Commit**

```bash
git add klard-web/src/components/ui/tabs.tsx klard-web/package.json pnpm-lock.yaml
git commit -m "feat(web): add shadcn/ui tabs component"
```

---

### Task 2: Write failing tests for TabsContainer web component

**Files:**
- Create: `klard-web/src/__tests__/components/ui/tabs.test.tsx`

**Step 1: Write the failing test**

```tsx
/**
 * Tests for Tabs Component
 *
 * TDD: Write failing tests first, then implement to pass.
 * Tests verify: rendering, controlled state, tabs array, badges, icons, accessibility
 */

import { describe, it, expect, vi } from "vitest"
import { render, screen, fireEvent } from "@testing-library/react"
import { TabsContainer } from "@/components/ui/tabs"

describe("TabsContainer", () => {
  const defaultTabs = [
    { value: "tab1", label: "Tab 1" },
    { value: "tab2", label: "Tab 2" },
    { value: "tab3", label: "Tab 3" },
  ]

  describe("Rendering", () => {
    it("should render all tab triggers", () => {
      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.getByRole("tab", { name: "Tab 1" })).toBeInTheDocument()
      expect(screen.getByRole("tab", { name: "Tab 2" })).toBeInTheDocument()
      expect(screen.getByRole("tab", { name: "Tab 3" })).toBeInTheDocument()
    })

    it("should have data-slot attribute", () => {
      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(document.querySelector('[data-slot="tabs"]')).toBeInTheDocument()
    })

    it("should render children content", () => {
      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={defaultTabs}>
          <div data-testid="tab-content">Tab Content</div>
        </TabsContainer>
      )

      expect(screen.getByTestId("tab-content")).toBeInTheDocument()
    })
  })

  describe("Controlled State", () => {
    it("should highlight the active tab based on value prop", () => {
      render(
        <TabsContainer value="tab2" onChange={() => {}} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      const activeTab = screen.getByRole("tab", { name: "Tab 2" })
      expect(activeTab).toHaveAttribute("data-state", "active")
    })

    it("should call onChange when a tab is clicked", () => {
      const handleChange = vi.fn()
      render(
        <TabsContainer value="tab1" onChange={handleChange} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      fireEvent.click(screen.getByRole("tab", { name: "Tab 2" }))

      expect(handleChange).toHaveBeenCalledWith("tab2")
    })

    it("should not call onChange when clicking the already active tab", () => {
      const handleChange = vi.fn()
      render(
        <TabsContainer value="tab1" onChange={handleChange} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      fireEvent.click(screen.getByRole("tab", { name: "Tab 1" }))

      // Radix Tabs may or may not call onChange for already active - verify behavior
      // This test documents expected behavior
    })
  })

  describe("Badges", () => {
    it("should render badge when tab has badge prop", () => {
      const tabsWithBadge = [
        { value: "tab1", label: "Tab 1", badge: 5 },
        { value: "tab2", label: "Tab 2" },
      ]

      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={tabsWithBadge}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.getByText("5")).toBeInTheDocument()
    })

    it("should render badge with value 0", () => {
      const tabsWithZeroBadge = [
        { value: "tab1", label: "Tab 1", badge: 0 },
      ]

      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={tabsWithZeroBadge}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.getByText("0")).toBeInTheDocument()
    })

    it("should not render badge when badge prop is undefined", () => {
      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      // Ensure no badge elements exist
      const badges = document.querySelectorAll('[data-slot="badge"]')
      expect(badges.length).toBe(0)
    })
  })

  describe("Icons", () => {
    it("should render icon when tab has icon prop", () => {
      const tabsWithIcon = [
        { value: "tab1", label: "Tab 1", icon: <span data-testid="tab-icon">★</span> },
      ]

      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={tabsWithIcon}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.getByTestId("tab-icon")).toBeInTheDocument()
    })

    it("should render icon before label", () => {
      const tabsWithIcon = [
        { value: "tab1", label: "Tab 1", icon: <span data-testid="icon">I</span> },
      ]

      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={tabsWithIcon}>
          <div>Content</div>
        </TabsContainer>
      )

      const trigger = screen.getByRole("tab", { name: /Tab 1/i })
      const children = Array.from(trigger.childNodes)

      // Icon should come before text
      const iconIndex = children.findIndex(
        (child) =>
          (child as Element).querySelector?.('[data-testid="icon"]') ||
          (child as Element).getAttribute?.("data-testid") === "icon"
      )
      const textIndex = children.findIndex((child) =>
        child.textContent?.includes("Tab 1")
      )

      expect(iconIndex).toBeLessThan(textIndex)
    })
  })

  describe("Disabled State", () => {
    it("should disable tab when disabled prop is true", () => {
      const tabsWithDisabled = [
        { value: "tab1", label: "Tab 1" },
        { value: "tab2", label: "Tab 2", disabled: true },
      ]

      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={tabsWithDisabled}>
          <div>Content</div>
        </TabsContainer>
      )

      const disabledTab = screen.getByRole("tab", { name: "Tab 2" })
      expect(disabledTab).toBeDisabled()
    })

    it("should not call onChange when clicking disabled tab", () => {
      const handleChange = vi.fn()
      const tabsWithDisabled = [
        { value: "tab1", label: "Tab 1" },
        { value: "tab2", label: "Tab 2", disabled: true },
      ]

      render(
        <TabsContainer value="tab1" onChange={handleChange} tabs={tabsWithDisabled}>
          <div>Content</div>
        </TabsContainer>
      )

      fireEvent.click(screen.getByRole("tab", { name: "Tab 2" }))

      expect(handleChange).not.toHaveBeenCalled()
    })
  })

  describe("Accessibility", () => {
    it("should have proper ARIA roles", () => {
      render(
        <TabsContainer value="tab1" onChange={() => {}} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.getByRole("tablist")).toBeInTheDocument()
      expect(screen.getAllByRole("tab")).toHaveLength(3)
    })

    it("should have aria-selected on active tab", () => {
      render(
        <TabsContainer value="tab2" onChange={() => {}} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      const activeTab = screen.getByRole("tab", { name: "Tab 2" })
      expect(activeTab).toHaveAttribute("aria-selected", "true")
    })

    it("should support keyboard navigation", () => {
      const handleChange = vi.fn()
      render(
        <TabsContainer value="tab1" onChange={handleChange} tabs={defaultTabs}>
          <div>Content</div>
        </TabsContainer>
      )

      const firstTab = screen.getByRole("tab", { name: "Tab 1" })
      firstTab.focus()

      // Arrow right should move to next tab
      fireEvent.keyDown(firstTab, { key: "ArrowRight" })

      // Focus should move (Radix handles this)
      expect(document.activeElement).not.toBe(firstTab)
    })
  })

  describe("Custom className", () => {
    it("should merge custom className with default classes", () => {
      render(
        <TabsContainer
          value="tab1"
          onChange={() => {}}
          tabs={defaultTabs}
          className="custom-class"
        >
          <div>Content</div>
        </TabsContainer>
      )

      const tabsContainer = document.querySelector('[data-slot="tabs"]')
      expect(tabsContainer).toHaveClass("custom-class")
    })
  })

  describe("Edge Cases", () => {
    it("should handle empty tabs array", () => {
      render(
        <TabsContainer value="" onChange={() => {}} tabs={[]}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.queryAllByRole("tab")).toHaveLength(0)
    })

    it("should handle single tab", () => {
      const singleTab = [{ value: "only", label: "Only Tab" }]

      render(
        <TabsContainer value="only" onChange={() => {}} tabs={singleTab}>
          <div>Content</div>
        </TabsContainer>
      )

      expect(screen.getByRole("tab", { name: "Only Tab" })).toBeInTheDocument()
    })
  })
})
```

**Step 2: Run test to verify it fails**

Run:
```bash
pnpm --filter klard-web test src/__tests__/components/ui/tabs.test.tsx --run
```
Expected: FAIL with "TabsContainer is not defined" or similar import error

**Step 3: Commit test file**

```bash
git add klard-web/src/__tests__/components/ui/tabs.test.tsx
git commit -m "test(web): add failing tests for TabsContainer component"
```

---

### Task 3: Implement TabsContainer web component

**Files:**
- Modify: `klard-web/src/components/ui/tabs.tsx`

**Step 1: Read the current tabs.tsx file created by shadcn CLI**

Read the file to understand what shadcn generated.

**Step 2: Implement TabsContainer**

Add to the existing tabs.tsx file:

```tsx
// Add these imports at the top
import { Badge } from "@/components/ui/badge"

// Add the TabItem interface
export interface TabItem {
  value: string
  label: string
  badge?: number
  icon?: React.ReactNode
  disabled?: boolean
}

// Add TabsContainerProps interface
export interface TabsContainerProps {
  value: string
  onChange: (value: string) => void
  tabs: TabItem[]
  children: React.ReactNode
  className?: string
}

// Add TabsContainer component
function TabsContainer({
  value,
  onChange,
  tabs,
  children,
  className,
}: TabsContainerProps) {
  return (
    <Tabs
      data-slot="tabs"
      value={value}
      onValueChange={onChange}
      className={className}
    >
      <TabsList>
        {tabs.map((tab) => (
          <TabsTrigger
            key={tab.value}
            value={tab.value}
            disabled={tab.disabled}
            className="gap-2"
          >
            {tab.icon}
            {tab.label}
            {tab.badge !== undefined && (
              <Badge variant="secondary" size="sm" className="ml-1">
                {tab.badge}
              </Badge>
            )}
          </TabsTrigger>
        ))}
      </TabsList>
      {children}
    </Tabs>
  )
}

// Update the export at the bottom
export { Tabs, TabsList, TabsTrigger, TabsContent, TabsContainer }
```

**Step 3: Run test to verify it passes**

Run:
```bash
pnpm --filter klard-web test src/__tests__/components/ui/tabs.test.tsx --run
```
Expected: PASS

**Step 4: Commit**

```bash
git add klard-web/src/components/ui/tabs.tsx
git commit -m "feat(web): implement TabsContainer component with badges and icons"
```

---

### Task 4: Export TabsContainer from ui index

**Files:**
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Add export**

Add to index.ts:
```typescript
export {
  Tabs,
  TabsList,
  TabsTrigger,
  TabsContent,
  TabsContainer,
  type TabItem,
  type TabsContainerProps,
} from './tabs';
```

**Step 2: Verify TypeScript compiles**

Run:
```bash
pnpm --filter klard-web exec tsc --noEmit
```
Expected: No errors

**Step 3: Commit**

```bash
git add klard-web/src/components/ui/index.ts
git commit -m "feat(web): export tabs components from ui index"
```

---

### Task 5: Run all web tests to verify no regressions

**Files:** None (verification only)

**Step 1: Run full test suite**

Run:
```bash
pnpm --filter klard-web test --run
```
Expected: All tests pass

**Step 2: Run TypeScript check**

Run:
```bash
pnpm --filter klard-web exec tsc --noEmit
```
Expected: No errors

---

## Part 2: Mobile Implementation (klard-mobile)

---

### Task 6: Write failing tests for TabBar mobile component

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/TabBar.test.tsx`

**Step 1: Write the failing test**

```tsx
/**
 * Tests for TabBar Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */

import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react-native';
import { Text } from 'react-native';
import { TabBar } from '@/components/ui/TabBar';
import * as Haptics from 'expo-haptics';

// Mock expo-haptics
jest.mock('expo-haptics', () => ({
  impactAsync: jest.fn(),
  ImpactFeedbackStyle: {
    Light: 'light',
    Medium: 'medium',
    Heavy: 'heavy',
  },
}));

// Mock vector icons
jest.mock('@expo/vector-icons', () => {
  const React = require('react');
  const { Text } = require('react-native');
  return {
    Ionicons: ({ name, testID }: { name: string; testID?: string }) => (
      <Text testID={testID || 'vector-icon'}>{name}</Text>
    ),
  };
});

describe('TabBar', () => {
  const defaultTabs = [
    { value: 'tab1', label: 'Tab 1' },
    { value: 'tab2', label: 'Tab 2' },
    { value: 'tab3', label: 'Tab 3' },
  ];

  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('Rendering', () => {
    it('should render all tab labels', () => {
      render(
        <TabBar value="tab1" onChange={() => {}} tabs={defaultTabs} />
      );

      expect(screen.getByText('Tab 1')).toBeTruthy();
      expect(screen.getByText('Tab 2')).toBeTruthy();
      expect(screen.getByText('Tab 3')).toBeTruthy();
    });

    it('should render with correct accessibility role', () => {
      render(
        <TabBar value="tab1" onChange={() => {}} tabs={defaultTabs} />
      );

      // TabBar should have tablist role
      expect(screen.getByRole('tablist')).toBeTruthy();
    });

    it('should render individual tabs with tab role', () => {
      render(
        <TabBar value="tab1" onChange={() => {}} tabs={defaultTabs} />
      );

      // Each tab should be accessible
      defaultTabs.forEach((tab) => {
        expect(screen.getByText(tab.label)).toBeTruthy();
      });
    });
  });

  describe('Controlled State', () => {
    it('should apply active styles to selected tab', () => {
      const { getByTestId } = render(
        <TabBar value="tab2" onChange={() => {}} tabs={defaultTabs} />
      );

      const activeTab = getByTestId('tab-tab2');
      // Active tab should have different styling (verified via testID)
      expect(activeTab).toBeTruthy();
    });

    it('should call onChange when a tab is pressed', async () => {
      const handleChange = jest.fn();
      render(
        <TabBar value="tab1" onChange={handleChange} tabs={defaultTabs} />
      );

      fireEvent.press(screen.getByText('Tab 2'));

      await waitFor(() => {
        expect(handleChange).toHaveBeenCalledWith('tab2');
      });
    });

    it('should trigger haptic feedback when tab is pressed', async () => {
      const handleChange = jest.fn();
      render(
        <TabBar value="tab1" onChange={handleChange} tabs={defaultTabs} />
      );

      fireEvent.press(screen.getByText('Tab 2'));

      await waitFor(() => {
        expect(Haptics.impactAsync).toHaveBeenCalledWith(
          Haptics.ImpactFeedbackStyle.Light
        );
      });
    });
  });

  describe('Badges', () => {
    it('should render badge when tab has badge prop', () => {
      const tabsWithBadge = [
        { value: 'tab1', label: 'Tab 1', badge: 5 },
        { value: 'tab2', label: 'Tab 2' },
      ];

      render(
        <TabBar value="tab1" onChange={() => {}} tabs={tabsWithBadge} />
      );

      expect(screen.getByText('5')).toBeTruthy();
    });

    it('should render badge with value 0', () => {
      const tabsWithZeroBadge = [
        { value: 'tab1', label: 'Tab 1', badge: 0 },
      ];

      render(
        <TabBar value="tab1" onChange={() => {}} tabs={tabsWithZeroBadge} />
      );

      expect(screen.getByText('0')).toBeTruthy();
    });
  });

  describe('Icons', () => {
    it('should render icon when tab has icon prop', () => {
      const tabsWithIcon = [
        { value: 'tab1', label: 'Tab 1', icon: <Text testID="tab-icon">★</Text> },
      ];

      render(
        <TabBar value="tab1" onChange={() => {}} tabs={tabsWithIcon} />
      );

      expect(screen.getByTestId('tab-icon')).toBeTruthy();
    });

    it('should render both icon and text', () => {
      const tabsWithIcon = [
        { value: 'tab1', label: 'Tab 1', icon: <Text testID="icon">I</Text> },
      ];

      render(
        <TabBar value="tab1" onChange={() => {}} tabs={tabsWithIcon} />
      );

      expect(screen.getByTestId('icon')).toBeTruthy();
      expect(screen.getByText('Tab 1')).toBeTruthy();
    });
  });

  describe('Disabled State', () => {
    it('should render disabled tab with reduced opacity', () => {
      const tabsWithDisabled = [
        { value: 'tab1', label: 'Tab 1' },
        { value: 'tab2', label: 'Tab 2', disabled: true },
      ];

      const { getByTestId } = render(
        <TabBar value="tab1" onChange={() => {}} tabs={tabsWithDisabled} />
      );

      // Disabled tab should be identifiable
      const disabledTab = getByTestId('tab-tab2');
      expect(disabledTab).toBeTruthy();
    });

    it('should not call onChange when pressing disabled tab', async () => {
      const handleChange = jest.fn();
      const tabsWithDisabled = [
        { value: 'tab1', label: 'Tab 1' },
        { value: 'tab2', label: 'Tab 2', disabled: true },
      ];

      render(
        <TabBar value="tab1" onChange={handleChange} tabs={tabsWithDisabled} />
      );

      fireEvent.press(screen.getByText('Tab 2'));

      await waitFor(() => {
        expect(handleChange).not.toHaveBeenCalled();
      });
    });

    it('should not trigger haptic feedback for disabled tab', async () => {
      const tabsWithDisabled = [
        { value: 'tab1', label: 'Tab 1' },
        { value: 'tab2', label: 'Tab 2', disabled: true },
      ];

      render(
        <TabBar value="tab1" onChange={() => {}} tabs={tabsWithDisabled} />
      );

      fireEvent.press(screen.getByText('Tab 2'));

      await waitFor(() => {
        expect(Haptics.impactAsync).not.toHaveBeenCalled();
      });
    });
  });

  describe('Horizontal Scroll', () => {
    it('should render in a horizontal ScrollView', () => {
      render(
        <TabBar value="tab1" onChange={() => {}} tabs={defaultTabs} />
      );

      // ScrollView should exist
      expect(screen.getByTestId('tab-bar-scroll')).toBeTruthy();
    });
  });

  describe('Edge Cases', () => {
    it('should handle empty tabs array', () => {
      render(
        <TabBar value="" onChange={() => {}} tabs={[]} />
      );

      // Should render without crashing
      expect(screen.getByTestId('tab-bar-scroll')).toBeTruthy();
    });

    it('should handle single tab', () => {
      const singleTab = [{ value: 'only', label: 'Only Tab' }];

      render(
        <TabBar value="only" onChange={() => {}} tabs={singleTab} />
      );

      expect(screen.getByText('Only Tab')).toBeTruthy();
    });
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run
```
Expected: FAIL with "TabBar is not defined" or similar import error

**Step 3: Commit test file**

```bash
git add klard-mobile/src/__tests__/components/ui/TabBar.test.tsx
git commit -m "test(mobile): add failing tests for TabBar component"
```

---

### Task 7: Implement TabBar mobile component

**Files:**
- Create: `klard-mobile/src/components/ui/TabBar.tsx`

**Step 1: Write the implementation**

```tsx
import React from 'react';
import {
  View,
  ScrollView,
  Pressable,
  Text,
  StyleSheet,
  type ViewStyle,
  type TextStyle,
} from 'react-native';
import * as Haptics from 'expo-haptics';

export interface TabItem {
  value: string;
  label: string;
  badge?: number;
  icon?: React.ReactNode;
  disabled?: boolean;
}

export interface TabBarProps {
  value: string;
  onChange: (value: string) => void;
  tabs: TabItem[];
  style?: ViewStyle;
}

export function TabBar({ value, onChange, tabs, style }: TabBarProps) {
  const handlePress = async (tab: TabItem) => {
    if (tab.disabled) return;

    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    onChange(tab.value);
  };

  return (
    <ScrollView
      testID="tab-bar-scroll"
      horizontal
      showsHorizontalScrollIndicator={false}
      style={[styles.scrollView, style]}
      contentContainerStyle={styles.contentContainer}
      accessibilityRole="tablist"
    >
      {tabs.map((tab) => {
        const isActive = value === tab.value;
        const isDisabled = tab.disabled;

        return (
          <Pressable
            key={tab.value}
            testID={`tab-${tab.value}`}
            onPress={() => handlePress(tab)}
            disabled={isDisabled}
            accessibilityRole="tab"
            accessibilityState={{ selected: isActive, disabled: isDisabled }}
            style={({ pressed }) => [
              styles.tab,
              isActive && styles.activeTab,
              isDisabled && styles.disabledTab,
              pressed && !isDisabled && styles.pressedTab,
            ]}
          >
            {tab.icon && <View style={styles.iconContainer}>{tab.icon}</View>}
            <Text
              style={[
                styles.tabLabel,
                isActive && styles.activeTabLabel,
                isDisabled && styles.disabledTabLabel,
              ]}
            >
              {tab.label}
            </Text>
            {tab.badge !== undefined && (
              <View style={styles.badge}>
                <Text style={styles.badgeText}>{tab.badge}</Text>
              </View>
            )}
          </Pressable>
        );
      })}
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  scrollView: {
    flexGrow: 0,
  } as ViewStyle,
  contentContainer: {
    paddingHorizontal: 16,
    gap: 8,
  } as ViewStyle,
  tab: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 8,
    paddingHorizontal: 16,
    borderRadius: 8,
    backgroundColor: 'transparent',
    gap: 8,
  } as ViewStyle,
  activeTab: {
    backgroundColor: '#F1F5F9', // slate-100
    borderBottomWidth: 2,
    borderBottomColor: '#0D7C7A', // primary teal
  } as ViewStyle,
  disabledTab: {
    opacity: 0.5,
  } as ViewStyle,
  pressedTab: {
    opacity: 0.7,
  } as ViewStyle,
  iconContainer: {
    marginRight: 4,
  } as ViewStyle,
  tabLabel: {
    fontSize: 14,
    fontWeight: '500',
    color: '#64748B', // slate-500
  } as TextStyle,
  activeTabLabel: {
    color: '#0D7C7A', // primary teal
    fontWeight: '600',
  } as TextStyle,
  disabledTabLabel: {
    color: '#94A3B8', // slate-400
  } as TextStyle,
  badge: {
    backgroundColor: '#F1F5F9', // slate-100
    borderRadius: 9999,
    paddingHorizontal: 6,
    paddingVertical: 2,
    marginLeft: 4,
  } as ViewStyle,
  badgeText: {
    fontSize: 12,
    fontWeight: '500',
    color: '#64748B', // slate-500
  } as TextStyle,
});
```

**Step 2: Run test to verify it passes**

Run:
```bash
pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run
```
Expected: PASS

**Step 3: Commit**

```bash
git add klard-mobile/src/components/ui/TabBar.tsx
git commit -m "feat(mobile): implement TabBar component with haptic feedback"
```

---

### Task 8: Export TabBar from mobile ui index

**Files:**
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Add export**

Add to index.ts:
```typescript
export { TabBar, type TabBarProps, type TabItem } from './TabBar';
```

**Step 2: Verify TypeScript compiles**

Run:
```bash
pnpm --filter klard-mobile exec tsc --noEmit
```
Expected: No errors

**Step 3: Commit**

```bash
git add klard-mobile/src/components/ui/index.ts
git commit -m "feat(mobile): export TabBar component from ui index"
```

---

### Task 9: Run all mobile tests to verify no regressions

**Files:** None (verification only)

**Step 1: Run full test suite**

Run:
```bash
pnpm --filter klard-mobile test --run
```
Expected: All tests pass

**Step 2: Run TypeScript check**

Run:
```bash
pnpm --filter klard-mobile exec tsc --noEmit
```
Expected: No errors

---

## Part 3: Finalization

---

### Task 10: Mark specification as DONE

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Update status marker**

Replace:
```
<!-- IN-PROGRESS:3.4-tabs -->
```

With:
```
<!-- DONE:3.4-tabs -->
```

**Step 2: Commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark 3.4-tabs component as done"
```

---

### Task 11: Final verification

**Files:** None (verification only)

**Step 1: Run full monorepo build**

Run:
```bash
pnpm build
```
Expected: Build succeeds

**Step 2: Run all tests**

Run:
```bash
pnpm test --run
```
Expected: All tests pass

**Step 3: Run lint**

Run:
```bash
pnpm lint
```
Expected: No errors

---

## Summary Checklist

| Stage | Status |
|-------|--------|
| Install shadcn/ui tabs | Pending |
| Web tests written | Pending |
| Web TabsContainer implemented | Pending |
| Web exports added | Pending |
| Mobile tests written | Pending |
| Mobile TabBar implemented | Pending |
| Mobile exports added | Pending |
| Spec marked DONE | Pending |
| Full verification | Pending |

---

## Test Commands Reference

```bash
# Web tests
pnpm --filter klard-web test src/__tests__/components/ui/tabs.test.tsx --run

# Mobile tests
pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run

# TypeScript check
pnpm --filter klard-web exec tsc --noEmit
pnpm --filter klard-mobile exec tsc --noEmit

# Full test suite
pnpm test --run

# Build
pnpm build
```
