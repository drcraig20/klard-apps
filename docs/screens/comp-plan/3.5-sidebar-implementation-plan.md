# 3.5 Sidebar Component Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a production-ready Sidebar navigation component for the Klard web application using shadcn/ui primitives.

**Architecture:** Web uses shadcn/ui Sidebar with Radix UI primitives. The component provides collapsible navigation with icons, labels, badges, and active state highlighting. Integrates with Next.js App Router via `next/link`.

**Tech Stack:**
- Web: Next.js 16, React 19, TypeScript strict, Tailwind CSS 4, shadcn/ui Sidebar

---

## Pre-Implementation Checklist

Before starting, verify these skills are loaded:
- [ ] `superpowers:test-driven-development` - TDD workflow
- [ ] `superpowers:testing-anti-patterns` - Avoid common test mistakes
- [ ] `solid-design-principles` - SOLID compliance

---

## Component Specification

### Props Interface

```typescript
// Web - AppSidebar
interface SidebarNavItem {
  id: string;
  label: string;
  href: string;
  icon: LucideIcon;
  badge?: number;
  disabled?: boolean;
}

interface AppSidebarProps {
  items: SidebarNavItem[];
  activeItem?: string;
  groupLabel?: string;
  header?: React.ReactNode;
  footer?: React.ReactNode;
  className?: string;
  collapsible?: 'offcanvas' | 'icon' | 'none';
}
```

### Visual Elements

- **Sidebar Container**: Fixed-width navigation panel
- **Header**: Optional logo/branding area
- **Group Label**: Section title for navigation items
- **Menu Items**: Clickable navigation links with icons
- **Badges**: Optional notification counts
- **Footer**: Optional bottom content area
- **Trigger**: Mobile toggle button

### Klard Design System Colors

| Element | Light Mode | Dark Mode |
|---------|------------|-----------|
| Background | #FFFFFF | #0F172A (slate-900) |
| Text | #0F172A (slate-900) | #F8FAFC (slate-50) |
| Active Item BG | #EFFCFB (teal-50) | #042F2E (teal-950) |
| Active Item Text | #0D7C7A (teal-600) | #5EEAD4 (teal-300) |
| Badge | #0D7C7A (teal-600) | #15B5B0 (teal-500) |
| Hover | #F1F5F9 (slate-100) | #1E293B (slate-800) |

---

## SOLID Compliance

| Principle | Implementation |
|-----------|----------------|
| **SRP** | AppSidebar only composes navigation UI - no business logic |
| **OCP** | Extended via items prop, className, header/footer slots |
| **LSP** | All prop combinations produce valid sidebars |
| **ISP** | Minimal interface with only necessary props |
| **DIP** | Component depends on abstractions (SidebarNavItem interface) |

---

## Dependencies

### Web
- `@radix-ui/react-slot` - Slot primitives (auto-installed with sidebar)
- `@/lib/utils` - cn utility (already exists)
- `lucide-react` - Icons (already installed)
- `next/link` - Navigation (already available)

---

# WEB IMPLEMENTATION

## Task 1: Install shadcn/ui Sidebar

**Files:**
- Create: `klard-web/src/components/ui/sidebar.tsx` (via CLI)

**Step 1: Run shadcn CLI to add sidebar**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps/klard-web
npx shadcn@latest add sidebar
```

**Step 2: Verify installation**

```bash
ls -la /Users/drcraig/Desktop/PersonalProjects/klard-apps/klard-web/src/components/ui/sidebar.tsx
```

Expected: File exists

---

## Task 2: Write Failing Tests for AppSidebar Rendering

**Files:**
- Create: `klard-web/src/__tests__/components/ui/app-sidebar.test.tsx`

**Step 1: Create test file with rendering tests**

```tsx
/**
 * Tests for AppSidebar Component
 *
 * TDD: Write failing tests first, then implement to pass.
 * Tests verify: rendering, navigation items, active state, badges, accessibility
 */

import { describe, it, expect, vi } from 'vitest';
import { render, screen } from '@testing-library/react';
import { AppSidebar, type SidebarNavItem } from '@/components/ui/app-sidebar';
import { Home, CreditCard, Bell, Settings } from 'lucide-react';

// Mock next/link
vi.mock('next/link', () => ({
  default: ({ children, href, ...props }: { children: React.ReactNode; href: string }) => (
    <a href={href} {...props}>
      {children}
    </a>
  ),
}));

const mockItems: SidebarNavItem[] = [
  { id: 'dashboard', label: 'Dashboard', href: '/dashboard', icon: Home },
  { id: 'subscriptions', label: 'Subscriptions', href: '/subscriptions', icon: CreditCard },
  { id: 'alerts', label: 'Alerts', href: '/alerts', icon: Bell, badge: 3 },
  { id: 'settings', label: 'Settings', href: '/settings', icon: Settings },
];

describe('AppSidebar', () => {
  describe('Rendering', () => {
    it('should render sidebar element', () => {
      render(<AppSidebar items={mockItems} />);

      expect(screen.getByTestId('app-sidebar')).toBeInTheDocument();
    });

    it('should render all navigation items', () => {
      render(<AppSidebar items={mockItems} />);

      expect(screen.getByText('Dashboard')).toBeInTheDocument();
      expect(screen.getByText('Subscriptions')).toBeInTheDocument();
      expect(screen.getByText('Alerts')).toBeInTheDocument();
      expect(screen.getByText('Settings')).toBeInTheDocument();
    });

    it('should render links with correct href', () => {
      render(<AppSidebar items={mockItems} />);

      const dashboardLink = screen.getByRole('link', { name: /dashboard/i });
      expect(dashboardLink).toHaveAttribute('href', '/dashboard');
    });
  });
});
```

**Step 2: Run tests to verify they fail**

```bash
cd /Users/drcraig/Desktop/PersonalProjects/klard-apps
pnpm --filter klard-web test src/__tests__/components/ui/app-sidebar.test.tsx --run
```

Expected: FAIL - AppSidebar component doesn't exist

---

## Task 3: Write Failing Tests for Active State and Badges

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/app-sidebar.test.tsx`

**Step 1: Add active state and badge tests**

```tsx
  describe('Active State', () => {
    it('should apply active styles to active item', () => {
      render(<AppSidebar items={mockItems} activeItem="dashboard" />);

      const dashboardButton = screen.getByRole('link', { name: /dashboard/i });
      expect(dashboardButton).toHaveAttribute('data-active', 'true');
    });

    it('should not apply active styles to inactive items', () => {
      render(<AppSidebar items={mockItems} activeItem="dashboard" />);

      const settingsButton = screen.getByRole('link', { name: /settings/i });
      expect(settingsButton).not.toHaveAttribute('data-active', 'true');
    });
  });

  describe('Badges', () => {
    it('should render badge when provided', () => {
      render(<AppSidebar items={mockItems} />);

      expect(screen.getByText('3')).toBeInTheDocument();
    });

    it('should not render badge for items without badge', () => {
      render(<AppSidebar items={mockItems} />);

      // Dashboard should not have a badge
      const dashboardItem = screen.getByRole('link', { name: /dashboard/i }).closest('[data-slot="menu-item"]');
      const badge = dashboardItem?.querySelector('[data-slot="badge"]');
      expect(badge).toBeNull();
    });
  });
```

**Step 2: Run tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/app-sidebar.test.tsx --run
```

Expected: FAIL - Props not implemented

---

## Task 4: Write Failing Tests for Header, Footer, and Group Label

**Files:**
- Modify: `klard-web/src/__tests__/components/ui/app-sidebar.test.tsx`

**Step 1: Add header, footer, and group label tests**

```tsx
  describe('Header and Footer', () => {
    it('should render header content when provided', () => {
      render(
        <AppSidebar
          items={mockItems}
          header={<div data-testid="sidebar-header">Header Content</div>}
        />
      );

      expect(screen.getByTestId('sidebar-header')).toBeInTheDocument();
    });

    it('should render footer content when provided', () => {
      render(
        <AppSidebar
          items={mockItems}
          footer={<div data-testid="sidebar-footer">Footer Content</div>}
        />
      );

      expect(screen.getByTestId('sidebar-footer')).toBeInTheDocument();
    });
  });

  describe('Group Label', () => {
    it('should render group label when provided', () => {
      render(<AppSidebar items={mockItems} groupLabel="Navigation" />);

      expect(screen.getByText('Navigation')).toBeInTheDocument();
    });

    it('should render default group label when not provided', () => {
      render(<AppSidebar items={mockItems} />);

      expect(screen.getByText('Application')).toBeInTheDocument();
    });
  });

  describe('Custom className', () => {
    it('should merge custom className', () => {
      render(<AppSidebar items={mockItems} className="custom-class" />);

      const sidebar = screen.getByTestId('app-sidebar');
      expect(sidebar).toHaveClass('custom-class');
    });
  });
```

**Step 2: Run all tests to verify they fail**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/app-sidebar.test.tsx --run
```

Expected: Multiple FAIL

---

## Task 5: Implement AppSidebar Component

**Files:**
- Create: `klard-web/src/components/ui/app-sidebar.tsx`

**Step 1: Create the AppSidebar component**

```tsx
'use client';

import * as React from 'react';
import Link from 'next/link';
import { type LucideIcon } from 'lucide-react';

import { cn } from '@/lib/utils';
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarProvider,
} from '@/components/ui/sidebar';

/**
 * Navigation item for the sidebar
 */
export interface SidebarNavItem {
  /** Unique identifier for the item */
  id: string;
  /** Display label */
  label: string;
  /** Navigation href */
  href: string;
  /** Lucide icon component */
  icon: LucideIcon;
  /** Optional badge count */
  badge?: number;
  /** Whether the item is disabled */
  disabled?: boolean;
}

/**
 * Props for AppSidebar component
 */
export interface AppSidebarProps {
  /** Navigation items to render */
  items: SidebarNavItem[];
  /** Currently active item id */
  activeItem?: string;
  /** Optional group label */
  groupLabel?: string;
  /** Optional header content */
  header?: React.ReactNode;
  /** Optional footer content */
  footer?: React.ReactNode;
  /** Additional className for sidebar */
  className?: string;
  /** Collapsible mode */
  collapsible?: 'offcanvas' | 'icon' | 'none';
}

/**
 * AppSidebar - Primary navigation sidebar for Klard web application
 *
 * Built on shadcn/ui Sidebar primitives, this component provides:
 * - Navigation menu with icons and labels
 * - Active item highlighting with Klard teal color
 * - Badge support for notifications
 * - Collapsible behavior
 * - Header and footer slots
 */
function AppSidebar({
  items,
  activeItem,
  groupLabel = 'Application',
  header,
  footer,
  className,
  collapsible = 'offcanvas',
}: AppSidebarProps) {
  return (
    <SidebarProvider>
      <Sidebar
        collapsible={collapsible}
        className={cn(className)}
        data-testid="app-sidebar"
        data-slot="app-sidebar"
      >
        {header && <SidebarHeader>{header}</SidebarHeader>}

        <SidebarContent>
          <SidebarGroup>
            <SidebarGroupLabel>{groupLabel}</SidebarGroupLabel>
            <SidebarGroupContent>
              <SidebarMenu>
                {items.map((item) => {
                  const isActive = activeItem === item.id;
                  const Icon = item.icon;

                  return (
                    <SidebarMenuItem key={item.id} data-slot="menu-item">
                      <SidebarMenuButton
                        asChild
                        isActive={isActive}
                        disabled={item.disabled}
                        className={cn(
                          isActive && 'bg-teal-50 text-teal-700 dark:bg-teal-950 dark:text-teal-300'
                        )}
                      >
                        <Link
                          href={item.href}
                          data-active={isActive ? 'true' : undefined}
                        >
                          <Icon className="h-4 w-4" />
                          <span>{item.label}</span>
                        </Link>
                      </SidebarMenuButton>
                      {item.badge !== undefined && item.badge > 0 && (
                        <SidebarMenuBadge data-slot="badge">
                          {item.badge}
                        </SidebarMenuBadge>
                      )}
                    </SidebarMenuItem>
                  );
                })}
              </SidebarMenu>
            </SidebarGroupContent>
          </SidebarGroup>
        </SidebarContent>

        {footer && <SidebarFooter>{footer}</SidebarFooter>}
      </Sidebar>
    </SidebarProvider>
  );
}

export { AppSidebar };
```

**Step 2: Run tests to verify they pass**

```bash
pnpm --filter klard-web test src/__tests__/components/ui/app-sidebar.test.tsx --run
```

Expected: All tests PASS

---

## Task 6: Export AppSidebar from Index

**Files:**
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Add AppSidebar export**

Add this line to the exports:

```typescript
export { AppSidebar, type AppSidebarProps, type SidebarNavItem } from './app-sidebar';
```

**Step 2: Verify TypeScript compiles**

```bash
pnpm --filter klard-web exec tsc --noEmit
```

Expected: No TypeScript errors

**Step 3: Commit implementation**

```bash
git add klard-web/src/components/ui/sidebar.tsx klard-web/src/components/ui/app-sidebar.tsx klard-web/src/components/ui/index.ts klard-web/src/__tests__/components/ui/app-sidebar.test.tsx
git commit -m "feat(web): add AppSidebar navigation component

- Install shadcn/ui sidebar primitive
- Create AppSidebar with navigation items, active state, badges
- Klard teal colors for active item highlighting
- Support header/footer slots and group labels
- Comprehensive test coverage"
```

---

# VERIFICATION & COMPLETION

## Task 7: Run Full Test Suite

**Step 1: Run all web tests**

```bash
pnpm --filter klard-web test --run
```

Expected: All tests PASS

**Step 2: Run TypeScript check**

```bash
pnpm --filter klard-web exec tsc --noEmit
```

Expected: No TypeScript errors

---

## Task 8: Verification Checklist

Complete this checklist before marking component as DONE:

**AppSidebar:**
- [ ] Component renders without errors
- [ ] All navigation items render with icons and labels
- [ ] Links have correct href attributes
- [ ] Active item has data-active="true" and Klard teal styling
- [ ] Badges render when provided (count > 0)
- [ ] Header slot renders when provided
- [ ] Footer slot renders when provided
- [ ] Group label renders (custom or default "Application")
- [ ] Custom className merges correctly
- [ ] Collapsible behavior works (offcanvas, icon, none)
- [ ] TypeScript compiles with no errors
- [ ] All tests passing
- [ ] Exported from index.ts

---

## Task 9: Mark Component as DONE

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Update spec marker**

Replace:
```
<!-- IN-PROGRESS:3.5-sidebar -->
```

With:
```
<!-- DONE:3.5-sidebar -->
```

**Step 2: Final commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark 3.5-sidebar component as DONE"
```

---

## Summary

| Task | Description |
|------|-------------|
| 1 | Install shadcn/ui sidebar |
| 2-4 | Write failing tests (TDD RED phase) |
| 5 | Implement AppSidebar component (TDD GREEN phase) |
| 6 | Export from index.ts |
| 7 | Run full test suite |
| 8 | Verification checklist |
| 9 | Mark component as DONE |

**Total Tasks:** 9
**Platform:** Web Only

---

## File Structure

### Web
```
klard-web/src/
├── components/ui/
│   ├── sidebar.tsx        # shadcn base (from CLI)
│   ├── app-sidebar.tsx    # Klard component
│   └── index.ts           # Export added
└── __tests__/components/ui/
    └── app-sidebar.test.tsx  # Test file
```

---

## Execution Options

**Plan complete and saved to `docs/screens/comp-plan/3.5-sidebar-implementation-plan.md`.**

**Two execution options:**

1. **Subagent-Driven (this session)** - Dispatch fresh subagent per task, review between tasks, fast iteration

2. **Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

**Which approach?**