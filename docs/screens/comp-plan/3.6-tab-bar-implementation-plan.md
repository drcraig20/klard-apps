# 3.6 TabBar Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a custom TabBar component for mobile bottom navigation with haptic feedback, badges, center action button support, and safe area handling.

**Architecture:** The TabBar is a standalone reusable UI component that renders bottom navigation tabs. It uses `useSafeAreaInsets` for notch/home indicator handling, `expo-haptics` for tactile feedback, and supports flexible tab configurations including badges and a floating center action button. The component follows existing Badge/Button patterns in the codebase.

**Tech Stack:** React Native, Expo SDK 54, expo-haptics, react-native-safe-area-context, @expo/vector-icons (Ionicons)

---

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| TabBar | Renders bottom navigation only | Extensible via tabs prop | Handles all tab configurations | Single TabBarProps interface | Depends on Tab type abstraction |
| TabItem | Renders single tab item only | Icon/badge via props | N/A (leaf component) | TabItemProps interface | Receives handlers via props |
| CenterButton | Renders center FAB only | Action via onPress | N/A (leaf component) | Minimal prop interface | Icon injected via prop |

### Principle Applications

**SRP:** 3 focused sub-components - TabBar (container), TabItem (individual tab), CenterButton (FAB)
**OCP:** All content via data props - extend by adding tabs to array
**LSP:** TabItem handles all tab types uniformly
**ISP:** 3 segregated interfaces per component need
**DIP:** Components depend on type abstractions, handlers injected

---

## Props Interface

```typescript
// Types for TabBar component
export interface Tab {
  name: string;
  icon: string;
  badge?: number;
  isCenter?: boolean;
}

export interface TabBarProps {
  tabs: Tab[];
  activeTab: string;
  onTabPress: (name: string) => void;
  testID?: string;
}
```

---

## Visual States

| State | Description |
|-------|-------------|
| Default | Inactive tab with muted icon/label |
| Active | Selected tab with primary color |
| With Badge | Tab displays notification count |
| Center Button | Floating action button style |
| Safe Area | Bottom padding for home indicator |

---

## Color Tokens (Klard Design System)

| Token | Light Value | Usage |
|-------|-------------|-------|
| Primary | `#0D7C7A` | Active tab icon/label |
| Muted | `#64748B` | Inactive tab icon/label |
| Background | `#FFFFFF` | Tab bar background |
| Center Button BG | `#0D7C7A` | FAB background |
| Center Button Icon | `#FFFFFF` | FAB icon |
| Badge BG | `#DC2626` | Badge background |
| Badge Text | `#FFFFFF` | Badge text |

---

## Dependencies

- `expo-haptics` (already in project)
- `react-native-safe-area-context` (already in project)
- `@expo/vector-icons` (already in project - Ionicons)

---

## Test Strategy (TDD)

1. **Rendering tests** - Component renders, tabs display, accessibility
2. **Variant tests** - Active state, inactive state, badge display
3. **Interaction tests** - Tab press calls handler, haptic feedback triggers
4. **Center button tests** - Center tab renders as FAB
5. **Edge cases** - Badge overflow (99+), empty badge, no tabs

---

## Task Breakdown

### Task 1: Create TabBar Test File with Rendering Tests

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/TabBar.test.tsx`

**Step 1: Write the failing test**

```typescript
/**
 * Tests for TabBar Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */

import React from 'react';
import { render, screen, fireEvent, waitFor } from '@testing-library/react-native';
import { TabBar } from '@/components/ui/TabBar';
import * as Haptics from 'expo-haptics';

// Mock expo-haptics
jest.mock('expo-haptics', () => ({
  impactAsync: jest.fn(),
  ImpactFeedbackStyle: {
    Light: 'light',
    Medium: 'medium',
    Heavy: 'heavy',
  },
}));

// Mock react-native-safe-area-context
jest.mock('react-native-safe-area-context', () => ({
  useSafeAreaInsets: () => ({ top: 0, right: 0, bottom: 34, left: 0 }),
}));

// Mock vector icons
jest.mock('@expo/vector-icons', () => {
  const React = require('react');
  const { Text } = require('react-native');
  return {
    Ionicons: ({ name, testID }: { name: string; testID?: string }) => (
      <Text testID={testID || `icon-${name}`}>{name}</Text>
    ),
  };
});

const mockTabs = [
  { name: 'Dashboard', icon: 'home' },
  { name: 'Subscriptions', icon: 'card' },
  { name: 'Settings', icon: 'settings' },
];

describe('TabBar', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('Rendering', () => {
    it('should render all tabs', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
          testID="tab-bar"
        />
      );

      expect(screen.getByText('Dashboard')).toBeTruthy();
      expect(screen.getByText('Subscriptions')).toBeTruthy();
      expect(screen.getByText('Settings')).toBeTruthy();
    });

    it('should render with testID', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
          testID="tab-bar"
        />
      );

      expect(screen.getByTestId('tab-bar')).toBeTruthy();
    });

    it('should have correct accessibility role', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
          testID="tab-bar"
        />
      );

      // Tab bar should be accessible as tablist
      const tabBar = screen.getByTestId('tab-bar');
      expect(tabBar.props.accessibilityRole).toBe('tablist');
    });
  });
});
```

**Step 2: Run test to verify it fails**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: FAIL with "Cannot find module '@/components/ui/TabBar'"

**Step 3: Write minimal implementation**

Create `klard-mobile/src/components/ui/TabBar.tsx`:

```typescript
import React from 'react';
import { View, Pressable, Text, StyleSheet } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useSafeAreaInsets } from 'react-native-safe-area-context';

export interface Tab {
  name: string;
  icon: string;
  badge?: number;
  isCenter?: boolean;
}

export interface TabBarProps {
  tabs: Tab[];
  activeTab: string;
  onTabPress: (name: string) => void;
  testID?: string;
}

export function TabBar({ tabs, activeTab, onTabPress, testID }: TabBarProps) {
  const insets = useSafeAreaInsets();

  return (
    <View
      style={[styles.container, { paddingBottom: insets.bottom }]}
      testID={testID}
      accessibilityRole="tablist"
    >
      {tabs.map((tab) => (
        <Pressable
          key={tab.name}
          onPress={() => onTabPress(tab.name)}
          style={styles.tab}
          accessibilityRole="tab"
          accessibilityState={{ selected: activeTab === tab.name }}
        >
          <Ionicons
            name={tab.icon as keyof typeof Ionicons.glyphMap}
            size={24}
            color={activeTab === tab.name ? '#0D7C7A' : '#64748B'}
          />
          <Text
            style={[
              styles.label,
              activeTab === tab.name && styles.activeLabel,
            ]}
          >
            {tab.name}
          </Text>
        </Pressable>
      ))}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    backgroundColor: '#FFFFFF',
    borderTopWidth: 1,
    borderTopColor: '#E2E8F0',
    paddingTop: 8,
  },
  tab: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 4,
  },
  label: {
    fontSize: 12,
    marginTop: 4,
    color: '#64748B',
  },
  activeLabel: {
    color: '#0D7C7A',
    fontWeight: '600',
  },
});
```

**Step 4: Run test to verify it passes**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: PASS

**Step 5: Commit**

```bash
git add klard-mobile/src/__tests__/components/ui/TabBar.test.tsx klard-mobile/src/components/ui/TabBar.tsx
git commit -m "feat(mobile): add TabBar component with basic rendering"
```

---

### Task 2: Add Active State and Interaction Tests

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/TabBar.test.tsx`
- Modify: `klard-mobile/src/components/ui/TabBar.tsx`

**Step 1: Write the failing test**

Add to `TabBar.test.tsx`:

```typescript
  describe('Active State', () => {
    it('should highlight the active tab', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Subscriptions"
          onTabPress={onTabPress}
        />
      );

      // Check that the active tab has selected state
      const subscriptionsTab = screen.getByText('Subscriptions').parent?.parent;
      expect(subscriptionsTab?.props.accessibilityState?.selected).toBe(true);
    });

    it('should not highlight inactive tabs', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      const settingsTab = screen.getByText('Settings').parent?.parent;
      expect(settingsTab?.props.accessibilityState?.selected).toBe(false);
    });
  });

  describe('Interactions', () => {
    it('should call onTabPress when tab is pressed', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      fireEvent.press(screen.getByText('Settings'));

      expect(onTabPress).toHaveBeenCalledWith('Settings');
      expect(onTabPress).toHaveBeenCalledTimes(1);
    });

    it('should trigger haptic feedback on tab press', async () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      fireEvent.press(screen.getByText('Subscriptions'));

      await waitFor(() => {
        expect(Haptics.impactAsync).toHaveBeenCalledWith(
          Haptics.ImpactFeedbackStyle.Light
        );
      });
    });
  });
```

**Step 2: Run test to verify it fails**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: FAIL - haptic feedback not implemented

**Step 3: Write minimal implementation**

Update `TabBar.tsx` to add haptic feedback:

```typescript
import React from 'react';
import { View, Pressable, Text, StyleSheet } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import * as Haptics from 'expo-haptics';

export interface Tab {
  name: string;
  icon: string;
  badge?: number;
  isCenter?: boolean;
}

export interface TabBarProps {
  tabs: Tab[];
  activeTab: string;
  onTabPress: (name: string) => void;
  testID?: string;
}

export function TabBar({ tabs, activeTab, onTabPress, testID }: TabBarProps) {
  const insets = useSafeAreaInsets();

  const handleTabPress = async (tabName: string) => {
    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    onTabPress(tabName);
  };

  return (
    <View
      style={[styles.container, { paddingBottom: insets.bottom }]}
      testID={testID}
      accessibilityRole="tablist"
    >
      {tabs.map((tab) => (
        <Pressable
          key={tab.name}
          onPress={() => handleTabPress(tab.name)}
          style={styles.tab}
          accessibilityRole="tab"
          accessibilityState={{ selected: activeTab === tab.name }}
        >
          <Ionicons
            name={tab.icon as keyof typeof Ionicons.glyphMap}
            size={24}
            color={activeTab === tab.name ? '#0D7C7A' : '#64748B'}
          />
          <Text
            style={[
              styles.label,
              activeTab === tab.name && styles.activeLabel,
            ]}
          >
            {tab.name}
          </Text>
        </Pressable>
      ))}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    backgroundColor: '#FFFFFF',
    borderTopWidth: 1,
    borderTopColor: '#E2E8F0',
    paddingTop: 8,
  },
  tab: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 4,
  },
  label: {
    fontSize: 12,
    marginTop: 4,
    color: '#64748B',
  },
  activeLabel: {
    color: '#0D7C7A',
    fontWeight: '600',
  },
});
```

**Step 4: Run test to verify it passes**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: PASS

**Step 5: Commit**

```bash
git add klard-mobile/src/__tests__/components/ui/TabBar.test.tsx klard-mobile/src/components/ui/TabBar.tsx
git commit -m "feat(mobile): add haptic feedback and active state to TabBar"
```

---

### Task 3: Add Badge Support Tests

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/TabBar.test.tsx`
- Modify: `klard-mobile/src/components/ui/TabBar.tsx`

**Step 1: Write the failing test**

Add to `TabBar.test.tsx`:

```typescript
  describe('Badge Support', () => {
    const tabsWithBadge = [
      { name: 'Dashboard', icon: 'home' },
      { name: 'Alerts', icon: 'bell', badge: 5 },
      { name: 'Settings', icon: 'settings' },
    ];

    it('should display badge when badge prop is provided', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithBadge}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      expect(screen.getByText('5')).toBeTruthy();
    });

    it('should not display badge when badge is 0', () => {
      const tabsWithZeroBadge = [
        { name: 'Dashboard', icon: 'home' },
        { name: 'Alerts', icon: 'bell', badge: 0 },
      ];
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithZeroBadge}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      expect(screen.queryByTestId('badge-Alerts')).toBeNull();
    });

    it('should display 99+ when badge exceeds 99', () => {
      const tabsWithLargeBadge = [
        { name: 'Dashboard', icon: 'home' },
        { name: 'Alerts', icon: 'bell', badge: 150 },
      ];
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithLargeBadge}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      expect(screen.getByText('99+')).toBeTruthy();
    });

    it('should not display badge when badge prop is undefined', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={mockTabs}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      expect(screen.queryByTestId('badge-Dashboard')).toBeNull();
      expect(screen.queryByTestId('badge-Subscriptions')).toBeNull();
      expect(screen.queryByTestId('badge-Settings')).toBeNull();
    });
  });
```

**Step 2: Run test to verify it fails**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: FAIL - badge not implemented

**Step 3: Write minimal implementation**

Update `TabBar.tsx` to add badge support:

```typescript
import React from 'react';
import { View, Pressable, Text, StyleSheet } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import * as Haptics from 'expo-haptics';

export interface Tab {
  name: string;
  icon: string;
  badge?: number;
  isCenter?: boolean;
}

export interface TabBarProps {
  tabs: Tab[];
  activeTab: string;
  onTabPress: (name: string) => void;
  testID?: string;
}

export function TabBar({ tabs, activeTab, onTabPress, testID }: TabBarProps) {
  const insets = useSafeAreaInsets();

  const handleTabPress = async (tabName: string) => {
    await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
    onTabPress(tabName);
  };

  const formatBadge = (badge: number): string => {
    return badge > 99 ? '99+' : String(badge);
  };

  return (
    <View
      style={[styles.container, { paddingBottom: insets.bottom }]}
      testID={testID}
      accessibilityRole="tablist"
    >
      {tabs.map((tab) => (
        <Pressable
          key={tab.name}
          onPress={() => handleTabPress(tab.name)}
          style={styles.tab}
          accessibilityRole="tab"
          accessibilityState={{ selected: activeTab === tab.name }}
        >
          <View style={styles.iconContainer}>
            <Ionicons
              name={tab.icon as keyof typeof Ionicons.glyphMap}
              size={24}
              color={activeTab === tab.name ? '#0D7C7A' : '#64748B'}
            />
            {tab.badge !== undefined && tab.badge > 0 && (
              <View style={styles.badge} testID={`badge-${tab.name}`}>
                <Text style={styles.badgeText}>{formatBadge(tab.badge)}</Text>
              </View>
            )}
          </View>
          <Text
            style={[
              styles.label,
              activeTab === tab.name && styles.activeLabel,
            ]}
          >
            {tab.name}
          </Text>
        </Pressable>
      ))}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    backgroundColor: '#FFFFFF',
    borderTopWidth: 1,
    borderTopColor: '#E2E8F0',
    paddingTop: 8,
  },
  tab: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 4,
  },
  iconContainer: {
    position: 'relative',
  },
  label: {
    fontSize: 12,
    marginTop: 4,
    color: '#64748B',
  },
  activeLabel: {
    color: '#0D7C7A',
    fontWeight: '600',
  },
  badge: {
    position: 'absolute',
    top: -4,
    right: -10,
    backgroundColor: '#DC2626',
    borderRadius: 10,
    minWidth: 18,
    height: 18,
    alignItems: 'center',
    justifyContent: 'center',
    paddingHorizontal: 4,
  },
  badgeText: {
    color: '#FFFFFF',
    fontSize: 10,
    fontWeight: '600',
  },
});
```

**Step 4: Run test to verify it passes**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: PASS

**Step 5: Commit**

```bash
git add klard-mobile/src/__tests__/components/ui/TabBar.test.tsx klard-mobile/src/components/ui/TabBar.tsx
git commit -m "feat(mobile): add badge support to TabBar"
```

---

### Task 4: Add Center Button (FAB) Support Tests

**Files:**
- Modify: `klard-mobile/src/__tests__/components/ui/TabBar.test.tsx`
- Modify: `klard-mobile/src/components/ui/TabBar.tsx`

**Step 1: Write the failing test**

Add to `TabBar.test.tsx`:

```typescript
  describe('Center Button', () => {
    const tabsWithCenter = [
      { name: 'Dashboard', icon: 'home' },
      { name: 'Add', icon: 'add', isCenter: true },
      { name: 'Settings', icon: 'settings' },
    ];

    it('should render center button with FAB style', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithCenter}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      expect(screen.getByTestId('center-button')).toBeTruthy();
    });

    it('should not render label for center button', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithCenter}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      // Center button should not have a text label
      expect(screen.queryByText('Add')).toBeNull();
    });

    it('should call onTabPress when center button is pressed', () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithCenter}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      fireEvent.press(screen.getByTestId('center-button'));

      expect(onTabPress).toHaveBeenCalledWith('Add');
    });

    it('should trigger medium haptic feedback for center button', async () => {
      const onTabPress = jest.fn();
      render(
        <TabBar
          tabs={tabsWithCenter}
          activeTab="Dashboard"
          onTabPress={onTabPress}
        />
      );

      fireEvent.press(screen.getByTestId('center-button'));

      await waitFor(() => {
        expect(Haptics.impactAsync).toHaveBeenCalledWith(
          Haptics.ImpactFeedbackStyle.Medium
        );
      });
    });
  });
```

**Step 2: Run test to verify it fails**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: FAIL - center button not implemented

**Step 3: Write minimal implementation**

Update `TabBar.tsx` to add center button support:

```typescript
import React from 'react';
import { View, Pressable, Text, StyleSheet } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import * as Haptics from 'expo-haptics';

export interface Tab {
  name: string;
  icon: string;
  badge?: number;
  isCenter?: boolean;
}

export interface TabBarProps {
  tabs: Tab[];
  activeTab: string;
  onTabPress: (name: string) => void;
  testID?: string;
}

export function TabBar({ tabs, activeTab, onTabPress, testID }: TabBarProps) {
  const insets = useSafeAreaInsets();

  const handleTabPress = async (tab: Tab) => {
    const feedbackStyle = tab.isCenter
      ? Haptics.ImpactFeedbackStyle.Medium
      : Haptics.ImpactFeedbackStyle.Light;
    await Haptics.impactAsync(feedbackStyle);
    onTabPress(tab.name);
  };

  const formatBadge = (badge: number): string => {
    return badge > 99 ? '99+' : String(badge);
  };

  const renderTab = (tab: Tab) => {
    if (tab.isCenter) {
      return (
        <Pressable
          key={tab.name}
          onPress={() => handleTabPress(tab)}
          style={styles.tab}
          accessibilityRole="button"
          accessibilityLabel={tab.name}
          testID="center-button"
        >
          <View style={styles.centerButton}>
            <Ionicons
              name={tab.icon as keyof typeof Ionicons.glyphMap}
              size={28}
              color="#FFFFFF"
            />
          </View>
        </Pressable>
      );
    }

    return (
      <Pressable
        key={tab.name}
        onPress={() => handleTabPress(tab)}
        style={styles.tab}
        accessibilityRole="tab"
        accessibilityState={{ selected: activeTab === tab.name }}
      >
        <View style={styles.iconContainer}>
          <Ionicons
            name={tab.icon as keyof typeof Ionicons.glyphMap}
            size={24}
            color={activeTab === tab.name ? '#0D7C7A' : '#64748B'}
          />
          {tab.badge !== undefined && tab.badge > 0 && (
            <View style={styles.badge} testID={`badge-${tab.name}`}>
              <Text style={styles.badgeText}>{formatBadge(tab.badge)}</Text>
            </View>
          )}
        </View>
        <Text
          style={[
            styles.label,
            activeTab === tab.name && styles.activeLabel,
          ]}
        >
          {tab.name}
        </Text>
      </Pressable>
    );
  };

  return (
    <View
      style={[styles.container, { paddingBottom: insets.bottom }]}
      testID={testID}
      accessibilityRole="tablist"
    >
      {tabs.map(renderTab)}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flexDirection: 'row',
    backgroundColor: '#FFFFFF',
    borderTopWidth: 1,
    borderTopColor: '#E2E8F0',
    paddingTop: 8,
  },
  tab: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 4,
  },
  iconContainer: {
    position: 'relative',
  },
  label: {
    fontSize: 12,
    marginTop: 4,
    color: '#64748B',
  },
  activeLabel: {
    color: '#0D7C7A',
    fontWeight: '600',
  },
  badge: {
    position: 'absolute',
    top: -4,
    right: -10,
    backgroundColor: '#DC2626',
    borderRadius: 10,
    minWidth: 18,
    height: 18,
    alignItems: 'center',
    justifyContent: 'center',
    paddingHorizontal: 4,
  },
  badgeText: {
    color: '#FFFFFF',
    fontSize: 10,
    fontWeight: '600',
  },
  centerButton: {
    width: 56,
    height: 56,
    borderRadius: 28,
    backgroundColor: '#0D7C7A',
    alignItems: 'center',
    justifyContent: 'center',
    marginTop: -20,
    shadowColor: '#0D7C7A',
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.3,
    shadowRadius: 8,
    elevation: 8,
  },
});
```

**Step 4: Run test to verify it passes**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: PASS

**Step 5: Commit**

```bash
git add klard-mobile/src/__tests__/components/ui/TabBar.test.tsx klard-mobile/src/components/ui/TabBar.tsx
git commit -m "feat(mobile): add center button (FAB) support to TabBar"
```

---

### Task 5: Add Export and TypeScript Verification

**Files:**
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Write the failing test (export verification)**

This is a structural verification - we'll check TypeScript compiles correctly.

**Step 2: Run TypeScript check**

Run: `pnpm --filter klard-mobile exec tsc --noEmit`
Expected: Should pass without errors

**Step 3: Add export to index.ts**

Add to `klard-mobile/src/components/ui/index.ts`:

```typescript
export { TabBar, type TabBarProps, type Tab } from './TabBar';
```

**Step 4: Run TypeScript check again**

Run: `pnpm --filter klard-mobile exec tsc --noEmit`
Expected: PASS

**Step 5: Commit**

```bash
git add klard-mobile/src/components/ui/index.ts
git commit -m "feat(mobile): export TabBar from components/ui index"
```

---

### Task 6: Run Full Test Suite and Verify

**Files:**
- All TabBar files

**Step 1: Run all TabBar tests**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/TabBar.test.tsx --run`
Expected: All tests PASS

**Step 2: Run TypeScript check**

Run: `pnpm --filter klard-mobile exec tsc --noEmit`
Expected: PASS with no errors

**Step 3: Run lint**

Run: `pnpm lint`
Expected: PASS

**Step 4: Final commit (if any fixes needed)**

```bash
git add -A
git commit -m "fix(mobile): address linting issues in TabBar"
```

---

## Verification Checklist

- [ ] Component renders without errors
- [ ] All props implemented + typed (tabs, activeTab, onTabPress, testID)
- [ ] All required states functional (active, inactive, badge, center button)
- [ ] Safe area insets handled correctly
- [ ] Haptic feedback works (Light for tabs, Medium for center)
- [ ] Accessibility attributes included (tablist role, tab roles, selected state)
- [ ] TypeScript passes with no errors
- [ ] All tests written and passing
- [ ] Exported from components/ui/index.ts
- [ ] Works on iOS and Android

---

## Summary

| Task | Description | Files |
|------|-------------|-------|
| 1 | Basic rendering tests + implementation | Test + Component |
| 2 | Active state + haptic interaction | Test + Component |
| 3 | Badge support | Test + Component |
| 4 | Center button (FAB) | Test + Component |
| 5 | Export + TypeScript | Index |
| 6 | Full verification | All |

**Estimated Tasks:** 6
**TDD Approach:** RED-GREEN-REFACTOR for each task