# 5.1 ServiceLogo Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a reusable ServiceLogo component that displays subscription service logos with fallback support for both Web (Next.js) and Mobile (Expo).

**Architecture:** ServiceLogo is a thin wrapper around the existing Avatar component, specialized for displaying service logos. It accepts a `service` object (with `name` and optional `logoUrl`) and a `size` prop. On both platforms, it leverages the existing Avatar implementation but always uses `circle` shape and generates fallback text from the service name's first character. The component enforces circular shape and size-specific dimensions without modifying Avatar internals.

**Tech Stack:**
- Web: Next.js 16 + React 19 + Tailwind CSS + shadcn/ui + Radix UI Avatar (via existing Avatar component) + Vitest/RTL
- Mobile: React Native + Expo SDK 54 + expo-image (via existing Avatar component) + Jest/RTL
- TypeScript strict mode on both platforms

---

## Visual States

- Default image (when logoUrl provided and loads successfully)
- Fallback text (when no logoUrl or image fails to load)
- Accessibility labels (aria-label/alt on web, accessibilityLabel on mobile)
- No explicit loading indicator (per spec)

## Color Tokens

**Web:**
- Fallback background: `teal-100` (#D5F5F4)
- Fallback text: `teal-700` (#0D7C7A)

**Mobile:**
- Fallback background: Theme muted color
- Fallback text: Teal primary (#0D7C7A)

---

## SOLID Compliance

| Component | SRP | OCP | LSP | ISP | DIP |
|-----------|-----|-----|-----|-----|-----|
| ServiceLogo (Web) | Single purpose: render service logo | Extensible via size prop | Handles all service objects consistently | Minimal props interface | Depends on Avatar abstraction |
| ServiceLogo (Mobile) | Single purpose: render service logo | Extensible via size prop | Handles all service objects consistently | Minimal props interface | Depends on Avatar abstraction |

### Principle Applications

**SRP:** ServiceLogo does ONE thing - displays a service logo with fallback. Avatar handles the actual rendering.
**OCP:** New sizes can be added without modifying ServiceLogo (inherited from Avatar).
**LSP:** ServiceLogo can substitute wherever Avatar is used for service logos.
**ISP:** Interface has only essential props: `service` and `size`.
**DIP:** Depends on Avatar component abstraction, not implementation details.

---

## Props Interface

```typescript
interface Service {
  name: string;
  logoUrl?: string;
}

type ServiceLogoSize = 'xs' | 'sm' | 'md' | 'lg';

interface ServiceLogoProps {
  service: Service;
  size: ServiceLogoSize;
  className?: string;  // Web only
  style?: StyleProp<ViewStyle>;  // Mobile only
}
```

**Size Mappings:**
- `xs`: 24px (h-6 w-6)
- `sm`: 32px (h-8 w-8)
- `md`: 40px (h-10 w-10)
- `lg`: 48px (h-12 w-12)

---

## Dependencies

**Web:**
- Existing `Avatar` component from `@/components/ui/avatar`
- `cn` utility from `@/lib/utils`
- Radix UI Avatar (already installed via shadcn/ui)

**Mobile:**
- Existing `Avatar` component
- `expo-image` (already installed)
- Theme hook (useThemeColors)
- Optional blurhash constant for placeholder

---

## Implementation Tasks

### Task 1: Create Web ServiceLogo Test File (TDD - RED)

**Files:**
- Create: `klard-web/src/__tests__/components/ui/service-logo.test.tsx`

**Step 1: Write the failing test**

```tsx
/**
 * Tests for ServiceLogo Component
 *
 * TDD: Write failing tests first, then implement to pass.
 * Tests verify: rendering, sizes, fallback text, logo display
 */

import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { ServiceLogo } from '@/components/ui/service-logo';

describe('ServiceLogo', () => {
  const mockService = {
    name: 'Netflix',
    logoUrl: 'https://example.com/netflix-logo.png',
  };

  const mockServiceNoLogo = {
    name: 'Spotify',
  };

  describe('Rendering', () => {
    it('should render with data-slot attribute', () => {
      const { container } = render(
        <ServiceLogo service={mockServiceNoLogo} size="md" />
      );

      const logo = container.querySelector('[data-slot="service-logo"]');
      expect(logo).toBeInTheDocument();
    });

    it('should render fallback with first character of service name when no logo', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="md" />);

      expect(screen.getByText('S')).toBeInTheDocument();
    });

    it('should render image when service has logoUrl', () => {
      render(<ServiceLogo service={mockService} size="md" />);

      const img = screen.getByRole('img');
      expect(img).toHaveAttribute('alt', 'Netflix');
    });
  });

  describe('Sizes', () => {
    it('should apply xs size classes (h-6 w-6)', () => {
      const { container } = render(
        <ServiceLogo service={mockServiceNoLogo} size="xs" />
      );

      const avatar = container.querySelector('[data-slot="avatar"]');
      expect(avatar?.className).toMatch(/h-6/);
      expect(avatar?.className).toMatch(/w-6/);
    });

    it('should apply sm size classes (h-8 w-8)', () => {
      const { container } = render(
        <ServiceLogo service={mockServiceNoLogo} size="sm" />
      );

      const avatar = container.querySelector('[data-slot="avatar"]');
      expect(avatar?.className).toMatch(/h-8/);
      expect(avatar?.className).toMatch(/w-8/);
    });

    it('should apply md size classes (h-10 w-10)', () => {
      const { container } = render(
        <ServiceLogo service={mockServiceNoLogo} size="md" />
      );

      const avatar = container.querySelector('[data-slot="avatar"]');
      expect(avatar?.className).toMatch(/h-10/);
      expect(avatar?.className).toMatch(/w-10/);
    });

    it('should apply lg size classes (h-12 w-12)', () => {
      const { container } = render(
        <ServiceLogo service={mockServiceNoLogo} size="lg" />
      );

      const avatar = container.querySelector('[data-slot="avatar"]');
      expect(avatar?.className).toMatch(/h-12/);
      expect(avatar?.className).toMatch(/w-12/);
    });
  });

  describe('Fallback Generation', () => {
    it('should uppercase the first character for fallback', () => {
      render(
        <ServiceLogo service={{ name: 'hulu' }} size="md" />
      );

      expect(screen.getByText('H')).toBeInTheDocument();
    });

    it('should handle service names starting with lowercase', () => {
      render(
        <ServiceLogo service={{ name: 'disney+' }} size="md" />
      );

      expect(screen.getByText('D')).toBeInTheDocument();
    });
  });

  describe('Shape', () => {
    it('should always render as circle shape', () => {
      const { container } = render(
        <ServiceLogo service={mockServiceNoLogo} size="md" />
      );

      const avatar = container.querySelector('[data-slot="avatar"]');
      expect(avatar?.className).toContain('rounded-full');
    });
  });

  describe('Custom className', () => {
    it('should merge custom className with wrapper', () => {
      const { container } = render(
        <ServiceLogo
          service={mockServiceNoLogo}
          size="md"
          className="custom-class"
        />
      );

      const wrapper = container.querySelector('[data-slot="service-logo"]');
      expect(wrapper?.className).toContain('custom-class');
    });
  });
});
```

**Step 2: Run test to verify it fails**

Run: `pnpm --filter klard-web test src/__tests__/components/ui/service-logo.test.tsx --run`
Expected: FAIL with "Cannot find module '@/components/ui/service-logo'"

---

### Task 2: Create Web ServiceLogo Component (TDD - GREEN)

**Files:**
- Create: `klard-web/src/components/ui/service-logo.tsx`

**Step 1: Implement the component**

```tsx
'use client';

import * as React from 'react';
import { Avatar, type AvatarSize } from './avatar';
import { cn } from '@/lib/utils';

export interface Service {
  name: string;
  logoUrl?: string;
}

export type ServiceLogoSize = Extract<AvatarSize, 'xs' | 'sm' | 'md' | 'lg'>;

export interface ServiceLogoProps {
  service: Service;
  size: ServiceLogoSize;
  className?: string;
}

function ServiceLogo({ service, size, className }: ServiceLogoProps) {
  const fallback = service.name.charAt(0).toUpperCase();

  return (
    <div data-slot="service-logo" className={cn(className)}>
      <Avatar
        src={service.logoUrl}
        alt={service.name}
        fallback={fallback}
        size={size}
        shape="circle"
      />
    </div>
  );
}

export { ServiceLogo };
```

**Step 2: Run test to verify it passes**

Run: `pnpm --filter klard-web test src/__tests__/components/ui/service-logo.test.tsx --run`
Expected: PASS

---

### Task 3: Export Web ServiceLogo from Index (TDD - GREEN)

**Files:**
- Modify: `klard-web/src/components/ui/index.ts`

**Step 1: Add export**

Add to the end of the file:
```tsx
export { ServiceLogo, type ServiceLogoProps, type Service, type ServiceLogoSize } from './service-logo';
```

**Step 2: Run TypeScript check**

Run: `pnpm --filter klard-web exec tsc --noEmit`
Expected: No errors

**Step 3: Commit**

```bash
git add klard-web/src/components/ui/service-logo.tsx klard-web/src/__tests__/components/ui/service-logo.test.tsx klard-web/src/components/ui/index.ts
git commit -m "feat(web): add ServiceLogo component with tests"
```

---

### Task 4: Create Mobile ServiceLogo Test File (TDD - RED)

**Files:**
- Create: `klard-mobile/src/__tests__/components/ui/ServiceLogo.test.tsx`

**Step 1: Write the failing test**

```tsx
/**
 * Tests for ServiceLogo Component (Mobile)
 *
 * TDD: Write failing tests first, then implement to pass.
 */

import React from 'react';
import { render, screen } from '@testing-library/react-native';
import { ServiceLogo } from '@/components/ui/ServiceLogo';

// Mock expo-image
jest.mock('expo-image', () => ({
  Image: jest.fn(({ testID, style, accessibilityLabel }) => {
    const React = require('react');
    const { View } = require('react-native');
    return <View testID={testID} style={style} accessibilityLabel={accessibilityLabel} />;
  }),
}));

// Mock hooks
jest.mock('@/hooks', () => ({
  useThemeColors: () => ({
    primary: '#0D7C7A',
    muted: '#F1F5F9',
  }),
}));

describe('ServiceLogo', () => {
  const mockService = {
    name: 'Netflix',
    logoUrl: 'https://example.com/netflix-logo.png',
  };

  const mockServiceNoLogo = {
    name: 'Spotify',
  };

  describe('Rendering', () => {
    it('should render service logo container', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="md" />);

      expect(screen.getByTestId('service-logo-container')).toBeTruthy();
    });

    it('should render fallback with first character of service name when no logo', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="md" />);

      expect(screen.getByText('S')).toBeTruthy();
    });

    it('should have accessibility label with service name', () => {
      render(<ServiceLogo service={mockService} size="md" />);

      const container = screen.getByTestId('service-logo-container');
      expect(container.props.accessibilityLabel).toBe('Netflix logo');
    });

    it('should have image accessibility role', () => {
      render(<ServiceLogo service={mockService} size="md" />);

      const container = screen.getByTestId('service-logo-container');
      expect(container.props.accessibilityRole).toBe('image');
    });
  });

  describe('Sizes', () => {
    it('should apply xs dimensions (24px)', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="xs" />);

      const container = screen.getByTestId('avatar-container');
      expect(container.props.style).toMatchObject({
        width: 24,
        height: 24,
      });
    });

    it('should apply sm dimensions (32px)', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="sm" />);

      const container = screen.getByTestId('avatar-container');
      expect(container.props.style).toMatchObject({
        width: 32,
        height: 32,
      });
    });

    it('should apply md dimensions (40px)', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="md" />);

      const container = screen.getByTestId('avatar-container');
      expect(container.props.style).toMatchObject({
        width: 40,
        height: 40,
      });
    });

    it('should apply lg dimensions (48px)', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="lg" />);

      const container = screen.getByTestId('avatar-container');
      expect(container.props.style).toMatchObject({
        width: 48,
        height: 48,
      });
    });
  });

  describe('Fallback Generation', () => {
    it('should uppercase the first character for fallback', () => {
      render(<ServiceLogo service={{ name: 'hulu' }} size="md" />);

      expect(screen.getByText('H')).toBeTruthy();
    });
  });

  describe('Shape', () => {
    it('should always render as circle (borderRadius = dimension / 2)', () => {
      render(<ServiceLogo service={mockServiceNoLogo} size="md" />);

      const container = screen.getByTestId('avatar-container');
      // md = 40px, so borderRadius should be 20
      expect(container.props.style.borderRadius).toBe(20);
    });
  });

  describe('Image', () => {
    it('should render image when service has logoUrl', () => {
      render(<ServiceLogo service={mockService} size="md" />);

      expect(screen.getByTestId('avatar-image')).toBeTruthy();
    });

    it('should not render fallback when logoUrl is provided', () => {
      render(<ServiceLogo service={mockService} size="md" />);

      expect(screen.queryByText('N')).toBeNull();
    });
  });
});
```

**Step 2: Run test to verify it fails**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/ServiceLogo.test.tsx --run`
Expected: FAIL with "Cannot find module '@/components/ui/ServiceLogo'"

---

### Task 5: Create Mobile ServiceLogo Component (TDD - GREEN)

**Files:**
- Create: `klard-mobile/src/components/ui/ServiceLogo/ServiceLogo.tsx`
- Create: `klard-mobile/src/components/ui/ServiceLogo/index.ts`

**Step 1: Create component file**

```tsx
// ServiceLogo.tsx
import { View, type StyleProp, type ViewStyle } from 'react-native';
import { Avatar, type AvatarSize } from '../Avatar';

export interface Service {
  name: string;
  logoUrl?: string;
}

export type ServiceLogoSize = Extract<AvatarSize, 'xs' | 'sm' | 'md' | 'lg'>;

export interface ServiceLogoProps {
  service: Service;
  size: ServiceLogoSize;
  style?: StyleProp<ViewStyle>;
}

export function ServiceLogo({ service, size, style }: ServiceLogoProps) {
  const fallback = service.name.charAt(0).toUpperCase();

  return (
    <View
      testID="service-logo-container"
      accessibilityLabel={`${service.name} logo`}
      accessibilityRole="image"
      style={style}
    >
      <Avatar
        src={service.logoUrl}
        alt={service.name}
        fallback={fallback}
        size={size}
        shape="circle"
      />
    </View>
  );
}
```

**Step 2: Create index file**

```tsx
// index.ts
export { ServiceLogo, type ServiceLogoProps, type Service, type ServiceLogoSize } from './ServiceLogo';
```

**Step 3: Run test to verify it passes**

Run: `pnpm --filter klard-mobile test src/__tests__/components/ui/ServiceLogo.test.tsx --run`
Expected: PASS

---

### Task 6: Export Mobile ServiceLogo from Index (TDD - GREEN)

**Files:**
- Modify: `klard-mobile/src/components/ui/index.ts`

**Step 1: Add export**

Add to the end of the file:
```tsx
export { ServiceLogo, type ServiceLogoProps, type Service, type ServiceLogoSize } from './ServiceLogo';
```

**Step 2: Run TypeScript check**

Run: `pnpm --filter klard-mobile exec tsc --noEmit`
Expected: No errors

**Step 3: Commit**

```bash
git add klard-mobile/src/components/ui/ServiceLogo klard-mobile/src/__tests__/components/ui/ServiceLogo.test.tsx klard-mobile/src/components/ui/index.ts
git commit -m "feat(mobile): add ServiceLogo component with tests"
```

---

### Task 7: Run All Tests and TypeScript Checks

**Step 1: Run web tests**

Run: `pnpm --filter klard-web test --run`
Expected: All tests pass

**Step 2: Run mobile tests**

Run: `pnpm --filter klard-mobile test --run`
Expected: All tests pass

**Step 3: Run TypeScript checks**

Run: `pnpm --filter klard-web exec tsc --noEmit && pnpm --filter klard-mobile exec tsc --noEmit`
Expected: No errors

---

### Task 8: Mark Component as DONE in Spec

**Files:**
- Modify: `docs/screens/batch/Klard_Component_Specifications.md`

**Step 1: Update spec marker**

Replace `<!-- IN-PROGRESS:5.1-service-logo -->` with `<!-- DONE:5.1-service-logo -->`

**Step 2: Commit**

```bash
git add docs/screens/batch/Klard_Component_Specifications.md
git commit -m "docs: mark 5.1-service-logo component as done"
```

---

## Verification Checklist

Before marking complete, verify:

- [ ] Web component renders without errors
- [ ] Mobile component renders without errors
- [ ] All props implemented and typed (service, size, className/style)
- [ ] All sizes functional (xs=24px, sm=32px, md=40px, lg=48px)
- [ ] Fallback text shows first character of service name (uppercase)
- [ ] Image displays when logoUrl is provided
- [ ] Shape is always circle
- [ ] Accessibility attributes included (alt, accessibilityLabel, accessibilityRole)
- [ ] data-slot="service-logo" present on web wrapper
- [ ] TypeScript passes with no errors
- [ ] All tests passing
- [ ] Exported from components/ui/index.ts on both platforms
- [ ] Spec marker updated to DONE

---

## Usage Examples

**Web:**
```tsx
import { ServiceLogo } from '@/components/ui';

<ServiceLogo
  service={{ name: 'Netflix', logoUrl: 'https://logos.com/netflix.png' }}
  size="md"
/>

<ServiceLogo
  service={{ name: 'Spotify' }}
  size="lg"
/>
```

**Mobile:**
```tsx
import { ServiceLogo } from '@/components/ui';

<ServiceLogo
  service={{ name: 'Netflix', logoUrl: 'https://logos.com/netflix.png' }}
  size="md"
/>

<ServiceLogo
  service={{ name: 'Spotify' }}
  size="lg"
/>
```